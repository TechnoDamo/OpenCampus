import{r as h,m as tr,k as eh,j as a,t as th,x as bl,y as fr,z as nh,A as xl,B as Hn,C as It,E as ln,P as He,V as sh,F as rh,G as de,I as _n,J as ah,K as ih,L as oh,M as lh,R as D,b as M,N as ch,O as wn,T as Ee,e as _e,f as Te,Q as Xi,S as dh,U as uh,W as hh,X as fh,Y as ph,$ as Wi,a0 as mh,a1 as bh,a2 as xh,D as Ne,a3 as gl,a4 as vl,a5 as gh,a6 as vh,u as Nh}from"./index-DlN4GKyY.js";import{_ as yh,i as Eh,j as Nl,k as yl,l as _h,m as Th,n as wh,o as Ch,F as Ih,p as jh,q as El,r as Sh,s as _l,g as se,t as Ir,v as Jn,h as ie,G as jr,w as Sa,x as kh,y as bt,I as Ie,z as Dn,A as Sr,B as kr,E as ri,H as Lr,S as Rt,J as ai,u as et,K as ii,L as Lh,M as Tl,V as Ah,N as Gs,X as Rn,Q as sn,U as ka,W as Dh,Y as Rh,Z as Ar,$ as oi,a0 as Mh,a1 as Oh,b as Ph,P as Fh,c as wl,a2 as Uh,a3 as Bh,T as Cl,D as Il,O as jl,a4 as $h,a5 as Vh,a6 as Gh,a7 as zh,a8 as Kh,a9 as Xh,aa as Sl,ab as Wh,ac as Hh,ad as qh,ae as Yh,af as Qh,ag as Jh,ah as Zh,ai as ef,aj as tf,ak as nf,al as sf,am as rf,an as af,ao as of,ap as lf,aq as cf,C as df,ar as uf,as as hf,at as ff}from"./create-relationship-node-vT0p223z.js";import{u as pf,D as hn,g as fn,h as pn,i as Zn,j as At,k as Dt,m as it,n as mf,o as ir,v as bf,p as pr,A as Dr,q as rn,r as an,s as on,w as xf,x as gf,y as kl,z as vf,B as Hi,E as Nf,F as yf,G as Ef,H as _f,I as Tf,J as Ll,K as Al,T as wf,L as Cf,N as qi,O as Yi,P as If,Q as jf}from"./code-editor-DhNGJuNO.js";import{B as K,L as Je,S as es,b as La,l as Sf}from"./label-CZlEQKST.js";import{u as Rr,a as zs,b as cn,G as ts,P as ns,c as Ks,T as Mr,e as kf,d as Lf,K as Dl,M as Af,f as li,E as Df,H as Rl,A as Ml,W as Ol,S as Pl,g as Qi}from"./canvas-DF7MVb8y.js";import{c as Fe,a as ci,u as di,k as Vn,K as Gn}from"./theme-provider-Bq6UCzHI.js";import{u as Or,C as Rf,a as Mf,b as Nn}from"./databases-CkBSmLA1.js";import{B as Of}from"./badge-ijTOJij9.js";import{a as Pf}from"./use-storage-CXywz0c4.js";const Ff=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Uf=Fe("book-open",Ff);const Bf=[["path",{d:"M8 3H7a2 2 0 0 0-2 2v5a2 2 0 0 1-2 2 2 2 0 0 1 2 2v5c0 1.1.9 2 2 2h1",key:"ezmyqa"}],["path",{d:"M16 21h1a2 2 0 0 0 2-2v-5c0-1.1.9-2 2-2a2 2 0 0 1-2-2V5a2 2 0 0 0-2-2h-1",key:"e1hn23"}]],$f=Fe("braces",Bf);const Vf=[["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"m17 7 5 5-5 5",key:"1xlxn0"}],["path",{d:"m7 7-5 5 5 5",key:"19njba"}],["path",{d:"M8 12h.01",key:"czm47f"}]],Gf=Fe("chevrons-left-right-ellipsis",Vf);const zf=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],Kf=Fe("chevrons-up-down",zf);const Xf=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],Wf=Fe("code-xml",Xf);const Hf=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ss=Fe("ellipsis-vertical",Hf);const qf=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v6",key:"rc0qvx"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"4",cy:"16",r:"2",key:"1ehqvc"}],["path",{d:"m10 10-4.5 4.5",key:"7fwrp6"}],["path",{d:"m9 11 1 1",key:"wa6s5q"}]],Aa=Fe("file-key-2",qf);const Yf=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 13v-1h6v1",key:"1bb014"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"M11 18h2",key:"12mj7e"}]],Qf=Fe("file-type",Yf);const Jf=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Zf=Fe("folder-open",Jf);const ep=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],tp=Fe("globe",ep);const np=[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]],sp=Fe("list-checks",np);const rp=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"m3 10 3-3-3-3",key:"i7pm08"}],["path",{d:"m3 20 3-3-3-3",key:"20gx1n"}]],ap=Fe("list-collapse",rp);const ip=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],op=Fe("pause",ip);const lp=[["path",{d:"m10 10-6.157 6.162a2 2 0 0 0-.5.833l-1.322 4.36a.5.5 0 0 0 .622.624l4.358-1.323a2 2 0 0 0 .83-.5L14 13.982",key:"bjo8r8"}],["path",{d:"m12.829 7.172 4.359-4.346a1 1 0 1 1 3.986 3.986l-4.353 4.353",key:"16h5ne"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],cp=Fe("pencil-off",lp);const dp=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Lt=Fe("plus",dp);const up=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M7 12h.01",key:"eqddd0"}]],hp=Fe("rectangle-ellipsis",up);const fp=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],pp=Fe("undo-2",fp);function Fl(e){var t=h.useRef(e);return t.current=e,t}var mp=function(e){var t=Fl(e);h.useEffect(function(){return function(){t.current()}},[])},oa,Ji;function Ul(){if(Ji)return oa;Ji=1;function e(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}return oa=e,oa}var la,Zi;function bp(){if(Zi)return la;Zi=1;var e=typeof tr=="object"&&tr&&tr.Object===Object&&tr;return la=e,la}var ca,eo;function Bl(){if(eo)return ca;eo=1;var e=bp(),t=typeof self=="object"&&self&&self.Object===Object&&self,n=e||t||Function("return this")();return ca=n,ca}var da,to;function xp(){if(to)return da;to=1;var e=Bl(),t=function(){return e.Date.now()};return da=t,da}var ua,no;function gp(){if(no)return ua;no=1;var e=/\s/;function t(n){for(var s=n.length;s--&&e.test(n.charAt(s)););return s}return ua=t,ua}var ha,so;function vp(){if(so)return ha;so=1;var e=gp(),t=/^\s+/;function n(s){return s&&s.slice(0,e(s)+1).replace(t,"")}return ha=n,ha}var fa,ro;function $l(){if(ro)return fa;ro=1;var e=Bl(),t=e.Symbol;return fa=t,fa}var pa,ao;function Np(){if(ao)return pa;ao=1;var e=$l(),t=Object.prototype,n=t.hasOwnProperty,s=t.toString,r=e?e.toStringTag:void 0;function i(o){var l=n.call(o,r),c=o[r];try{o[r]=void 0;var d=!0}catch{}var u=s.call(o);return d&&(l?o[r]=c:delete o[r]),u}return pa=i,pa}var ma,io;function yp(){if(io)return ma;io=1;var e=Object.prototype,t=e.toString;function n(s){return t.call(s)}return ma=n,ma}var ba,oo;function Ep(){if(oo)return ba;oo=1;var e=$l(),t=Np(),n=yp(),s="[object Null]",r="[object Undefined]",i=e?e.toStringTag:void 0;function o(l){return l==null?l===void 0?r:s:i&&i in Object(l)?t(l):n(l)}return ba=o,ba}var xa,lo;function _p(){if(lo)return xa;lo=1;function e(t){return t!=null&&typeof t=="object"}return xa=e,xa}var ga,co;function Tp(){if(co)return ga;co=1;var e=Ep(),t=_p(),n="[object Symbol]";function s(r){return typeof r=="symbol"||t(r)&&e(r)==n}return ga=s,ga}var va,uo;function wp(){if(uo)return va;uo=1;var e=vp(),t=Ul(),n=Tp(),s=NaN,r=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;function c(d){if(typeof d=="number")return d;if(n(d))return s;if(t(d)){var u=typeof d.valueOf=="function"?d.valueOf():d;d=t(u)?u+"":u}if(typeof d!="string")return d===0?d:+d;d=e(d);var f=i.test(d);return f||o.test(d)?l(d.slice(2),f?2:8):r.test(d)?s:+d}return va=c,va}var Na,ho;function Cp(){if(ho)return Na;ho=1;var e=Ul(),t=xp(),n=wp(),s="Expected a function",r=Math.max,i=Math.min;function o(l,c,d){var u,f,p,x,b,m,g=0,T=!1,y=!1,v=!0;if(typeof l!="function")throw new TypeError(s);c=n(c)||0,e(d)&&(T=!!d.leading,y="maxWait"in d,p=y?r(n(d.maxWait)||0,c):p,v="trailing"in d?!!d.trailing:v);function S(P){var F=u,Q=f;return u=f=void 0,g=P,x=l.apply(Q,F),x}function I(P){return g=P,b=setTimeout(_,c),T?S(P):x}function k(P){var F=P-m,Q=P-g,J=c-F;return y?i(J,p-Q):J}function C(P){var F=P-m,Q=P-g;return m===void 0||F>=c||F<0||y&&Q>=p}function _(){var P=t();if(C(P))return j(P);b=setTimeout(_,k(P))}function j(P){return b=void 0,v&&u?S(P):(u=f=void 0,x)}function R(){b!==void 0&&clearTimeout(b),g=0,u=m=f=b=void 0}function L(){return b===void 0?x:j(t())}function X(){var P=t(),F=C(P);if(u=arguments,f=this,m=P,F){if(b===void 0)return I(m);if(y)return clearTimeout(b),b=setTimeout(_,c),S(m)}return b===void 0&&(b=setTimeout(_,c)),x}return X.cancel=R,X.flush=L,X}return Na=o,Na}var Ip=Cp();const jp=eh(Ip);function Sp(){var e=(typeof global>"u"?"undefined":typeof global)=="object"&&global&&global.Object===Object&&global,t=typeof self=="object"&&self&&self.Object===Object&&self;return e||t}Sp()||(global.Date=Date);function kp(e,t){var n,s=Fl(e),r=(n=t?.wait)!==null&&n!==void 0?n:1e3,i=h.useMemo(function(){return jp(function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return s.current.apply(s,yh([],Eh(o),!1))},r,t)},[]);return mp(function(){i.cancel()}),{run:i,cancel:i.cancel,flush:i.flush}}function fo(e,[t,n]){return Math.min(n,Math.max(t,e))}function Lp(e){const t=Ap(e),n=h.forwardRef((s,r)=>{const{children:i,...o}=s,l=h.Children.toArray(i),c=l.find(Rp);if(c){const d=c.props.children,u=l.map(f=>f===c?h.Children.count(d)>1?h.Children.only(null):h.isValidElement(d)?d.props.children:null:f);return a.jsx(t,{...o,ref:r,children:h.isValidElement(d)?h.cloneElement(d,void 0,u):null})}return a.jsx(t,{...o,ref:r,children:i})});return n.displayName=`${e}.Slot`,n}function Ap(e){const t=h.forwardRef((n,s)=>{const{children:r,...i}=n;if(h.isValidElement(r)){const o=Op(r),l=Mp(i,r.props);return r.type!==h.Fragment&&(l.ref=s?th(s,o):o),h.cloneElement(r,l)}return h.Children.count(r)>1?h.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Dp=Symbol("radix.slottable");function Rp(e){return h.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Dp}function Mp(e,t){const n={...t};for(const s in t){const r=e[s],i=t[s];/^on[A-Z]/.test(s)?r&&i?n[s]=(...l)=>{const c=i(...l);return r(...l),c}:r&&(n[s]=r):s==="style"?n[s]={...r,...i}:s==="className"&&(n[s]=[r,i].filter(Boolean).join(" "))}return{...e,...n}}function Op(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=Object.getOwnPropertyDescriptor(e,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Pp=[" ","Enter","ArrowUp","ArrowDown"],Fp=[" ","Enter"],Cn="Select",[Pr,Fr,Up]=yl(Cn),[rs]=xl(Cn,[Up,bl]),Ur=bl(),[Bp,mn]=rs(Cn),[$p,Vp]=rs(Cn),Vl=e=>{const{__scopeSelect:t,children:n,open:s,defaultOpen:r,onOpenChange:i,value:o,defaultValue:l,onValueChange:c,dir:d,name:u,autoComplete:f,disabled:p,required:x,form:b}=e,m=Ur(t),[g,T]=h.useState(null),[y,v]=h.useState(null),[S,I]=h.useState(!1),k=Nl(d),[C,_]=fr({prop:s,defaultProp:r??!1,onChange:i,caller:Cn}),[j,R]=fr({prop:o,defaultProp:l,onChange:c,caller:Cn}),L=h.useRef(null),X=g?b||!!g.closest("form"):!0,[P,F]=h.useState(new Set),Q=Array.from(P).map(J=>J.props.value).join(";");return a.jsx(nh,{...m,children:a.jsxs(Bp,{required:x,scope:t,trigger:g,onTriggerChange:T,valueNode:y,onValueNodeChange:v,valueNodeHasChildren:S,onValueNodeHasChildrenChange:I,contentId:Hn(),value:j,onValueChange:R,open:C,onOpenChange:_,dir:k,triggerPointerDownPosRef:L,disabled:p,children:[a.jsx(Pr.Provider,{scope:t,children:a.jsx($p,{scope:e.__scopeSelect,onNativeOptionAdd:h.useCallback(J=>{F(te=>new Set(te).add(J))},[]),onNativeOptionRemove:h.useCallback(J=>{F(te=>{const je=new Set(te);return je.delete(J),je})},[]),children:n})}),X?a.jsxs(fc,{"aria-hidden":!0,required:x,tabIndex:-1,name:u,autoComplete:f,value:j,onChange:J=>R(J.target.value),disabled:p,form:b,children:[j===void 0?a.jsx("option",{value:""}):null,Array.from(P)]},Q):null]})})};Vl.displayName=Cn;var Gl="SelectTrigger",zl=h.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:s=!1,...r}=e,i=Ur(n),o=mn(Gl,n),l=o.disabled||s,c=It(t,o.onTriggerChange),d=Fr(n),u=h.useRef("touch"),[f,p,x]=mc(m=>{const g=d().filter(v=>!v.disabled),T=g.find(v=>v.value===o.value),y=bc(g,m,T);y!==void 0&&o.onValueChange(y.value)}),b=m=>{l||(o.onOpenChange(!0),x()),m&&(o.triggerPointerDownPosRef.current={x:Math.round(m.pageX),y:Math.round(m.pageY)})};return a.jsx(rh,{asChild:!0,...i,children:a.jsx(He.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":pc(o.value)?"":void 0,...r,ref:c,onClick:de(r.onClick,m=>{m.currentTarget.focus(),u.current!=="mouse"&&b(m)}),onPointerDown:de(r.onPointerDown,m=>{u.current=m.pointerType;const g=m.target;g.hasPointerCapture(m.pointerId)&&g.releasePointerCapture(m.pointerId),m.button===0&&m.ctrlKey===!1&&m.pointerType==="mouse"&&(b(m),m.preventDefault())}),onKeyDown:de(r.onKeyDown,m=>{const g=f.current!=="";!(m.ctrlKey||m.altKey||m.metaKey)&&m.key.length===1&&p(m.key),!(g&&m.key===" ")&&Pp.includes(m.key)&&(b(),m.preventDefault())})})})});zl.displayName=Gl;var Kl="SelectValue",Xl=h.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:r,children:i,placeholder:o="",...l}=e,c=mn(Kl,n),{onValueNodeHasChildrenChange:d}=c,u=i!==void 0,f=It(t,c.onValueNodeChange);return ln(()=>{d(u)},[d,u]),a.jsx(He.span,{...l,ref:f,style:{pointerEvents:"none"},children:pc(c.value)?a.jsx(a.Fragment,{children:o}):i})});Xl.displayName=Kl;var Gp="SelectIcon",Wl=h.forwardRef((e,t)=>{const{__scopeSelect:n,children:s,...r}=e;return a.jsx(He.span,{"aria-hidden":!0,...r,ref:t,children:s||"â–¼"})});Wl.displayName=Gp;var zp="SelectPortal",Hl=e=>a.jsx(_h,{asChild:!0,...e});Hl.displayName=zp;var In="SelectContent",ql=h.forwardRef((e,t)=>{const n=mn(In,e.__scopeSelect),[s,r]=h.useState();if(ln(()=>{r(new DocumentFragment)},[]),!n.open){const i=s;return i?_n.createPortal(a.jsx(Yl,{scope:e.__scopeSelect,children:a.jsx(Pr.Slot,{scope:e.__scopeSelect,children:a.jsx("div",{children:e.children})})}),i):null}return a.jsx(Ql,{...e,ref:t})});ql.displayName=In;var vt=10,[Yl,bn]=rs(In),Kp="SelectContentImpl",Xp=Lp("SelectContent.RemoveScroll"),Ql=h.forwardRef((e,t)=>{const{__scopeSelect:n,position:s="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:i,onPointerDownOutside:o,side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:p,collisionPadding:x,sticky:b,hideWhenDetached:m,avoidCollisions:g,...T}=e,y=mn(In,n),[v,S]=h.useState(null),[I,k]=h.useState(null),C=It(t,V=>S(V)),[_,j]=h.useState(null),[R,L]=h.useState(null),X=Fr(n),[P,F]=h.useState(!1),Q=h.useRef(!1);h.useEffect(()=>{if(v)return Th(v)},[v]),wh();const J=h.useCallback(V=>{const[Y,...oe]=X().map(H=>H.ref.current),[B]=oe.slice(-1),W=document.activeElement;for(const H of V)if(H===W||(H?.scrollIntoView({block:"nearest"}),H===Y&&I&&(I.scrollTop=0),H===B&&I&&(I.scrollTop=I.scrollHeight),H?.focus(),document.activeElement!==W))return},[X,I]),te=h.useCallback(()=>J([_,v]),[J,_,v]);h.useEffect(()=>{P&&te()},[P,te]);const{onOpenChange:je,triggerPointerDownPosRef:me}=y;h.useEffect(()=>{if(v){let V={x:0,y:0};const Y=B=>{V={x:Math.abs(Math.round(B.pageX)-(me.current?.x??0)),y:Math.abs(Math.round(B.pageY)-(me.current?.y??0))}},oe=B=>{V.x<=10&&V.y<=10?B.preventDefault():v.contains(B.target)||je(!1),document.removeEventListener("pointermove",Y),me.current=null};return me.current!==null&&(document.addEventListener("pointermove",Y),document.addEventListener("pointerup",oe,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Y),document.removeEventListener("pointerup",oe,{capture:!0})}}},[v,je,me]),h.useEffect(()=>{const V=()=>je(!1);return window.addEventListener("blur",V),window.addEventListener("resize",V),()=>{window.removeEventListener("blur",V),window.removeEventListener("resize",V)}},[je]);const[qe,Ye]=mc(V=>{const Y=X().filter(W=>!W.disabled),oe=Y.find(W=>W.ref.current===document.activeElement),B=bc(Y,V,oe);B&&setTimeout(()=>B.ref.current.focus())}),he=h.useCallback((V,Y,oe)=>{const B=!Q.current&&!oe;(y.value!==void 0&&y.value===Y||B)&&(j(V),B&&(Q.current=!0))},[y.value]),De=h.useCallback(()=>v?.focus(),[v]),Se=h.useCallback((V,Y,oe)=>{const B=!Q.current&&!oe;(y.value!==void 0&&y.value===Y||B)&&L(V)},[y.value]),Re=s==="popper"?Da:Jl,ee=Re===Da?{side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:f,collisionBoundary:p,collisionPadding:x,sticky:b,hideWhenDetached:m,avoidCollisions:g}:{};return a.jsx(Yl,{scope:n,content:v,viewport:I,onViewportChange:k,itemRefCallback:he,selectedItem:_,onItemLeave:De,itemTextRefCallback:Se,focusSelectedItem:te,selectedItemText:R,position:s,isPositioned:P,searchRef:qe,children:a.jsx(Ch,{as:Xp,allowPinchZoom:!0,children:a.jsx(Ih,{asChild:!0,trapped:y.open,onMountAutoFocus:V=>{V.preventDefault()},onUnmountAutoFocus:de(r,V=>{y.trigger?.focus({preventScroll:!0}),V.preventDefault()}),children:a.jsx(ih,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:V=>V.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:a.jsx(Re,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:V=>V.preventDefault(),...T,...ee,onPlaced:()=>F(!0),ref:C,style:{display:"flex",flexDirection:"column",outline:"none",...T.style},onKeyDown:de(T.onKeyDown,V=>{const Y=V.ctrlKey||V.altKey||V.metaKey;if(V.key==="Tab"&&V.preventDefault(),!Y&&V.key.length===1&&Ye(V.key),["ArrowUp","ArrowDown","Home","End"].includes(V.key)){let B=X().filter(W=>!W.disabled).map(W=>W.ref.current);if(["ArrowUp","End"].includes(V.key)&&(B=B.slice().reverse()),["ArrowUp","ArrowDown"].includes(V.key)){const W=V.target,H=B.indexOf(W);B=B.slice(H+1)}setTimeout(()=>J(B)),V.preventDefault()}})})})})})})});Ql.displayName=Kp;var Wp="SelectItemAlignedPosition",Jl=h.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:s,...r}=e,i=mn(In,n),o=bn(In,n),[l,c]=h.useState(null),[d,u]=h.useState(null),f=It(t,C=>u(C)),p=Fr(n),x=h.useRef(!1),b=h.useRef(!0),{viewport:m,selectedItem:g,selectedItemText:T,focusSelectedItem:y}=o,v=h.useCallback(()=>{if(i.trigger&&i.valueNode&&l&&d&&m&&g&&T){const C=i.trigger.getBoundingClientRect(),_=d.getBoundingClientRect(),j=i.valueNode.getBoundingClientRect(),R=T.getBoundingClientRect();if(i.dir!=="rtl"){const W=R.left-_.left,H=j.left-W,q=C.left-H,Z=C.width+q,fe=Math.max(Z,_.width),Qe=window.innerWidth-vt,Ht=fo(H,[vt,Math.max(vt,Qe-fe)]);l.style.minWidth=Z+"px",l.style.left=Ht+"px"}else{const W=_.right-R.right,H=window.innerWidth-j.right-W,q=window.innerWidth-C.right-H,Z=C.width+q,fe=Math.max(Z,_.width),Qe=window.innerWidth-vt,Ht=fo(H,[vt,Math.max(vt,Qe-fe)]);l.style.minWidth=Z+"px",l.style.right=Ht+"px"}const L=p(),X=window.innerHeight-vt*2,P=m.scrollHeight,F=window.getComputedStyle(d),Q=parseInt(F.borderTopWidth,10),J=parseInt(F.paddingTop,10),te=parseInt(F.borderBottomWidth,10),je=parseInt(F.paddingBottom,10),me=Q+J+P+je+te,qe=Math.min(g.offsetHeight*5,me),Ye=window.getComputedStyle(m),he=parseInt(Ye.paddingTop,10),De=parseInt(Ye.paddingBottom,10),Se=C.top+C.height/2-vt,Re=X-Se,ee=g.offsetHeight/2,V=g.offsetTop+ee,Y=Q+J+V,oe=me-Y;if(Y<=Se){const W=L.length>0&&g===L[L.length-1].ref.current;l.style.bottom="0px";const H=d.clientHeight-m.offsetTop-m.offsetHeight,q=Math.max(Re,ee+(W?De:0)+H+te),Z=Y+q;l.style.height=Z+"px"}else{const W=L.length>0&&g===L[0].ref.current;l.style.top="0px";const q=Math.max(Se,Q+m.offsetTop+(W?he:0)+ee)+oe;l.style.height=q+"px",m.scrollTop=Y-Se+m.offsetTop}l.style.margin=`${vt}px 0`,l.style.minHeight=qe+"px",l.style.maxHeight=X+"px",s?.(),requestAnimationFrame(()=>x.current=!0)}},[p,i.trigger,i.valueNode,l,d,m,g,T,i.dir,s]);ln(()=>v(),[v]);const[S,I]=h.useState();ln(()=>{d&&I(window.getComputedStyle(d).zIndex)},[d]);const k=h.useCallback(C=>{C&&b.current===!0&&(v(),y?.(),b.current=!1)},[v,y]);return a.jsx(qp,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:x,onScrollButtonChange:k,children:a.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:S},children:a.jsx(He.div,{...r,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Jl.displayName=Wp;var Hp="SelectPopperPosition",Da=h.forwardRef((e,t)=>{const{__scopeSelect:n,align:s="start",collisionPadding:r=vt,...i}=e,o=Ur(n);return a.jsx(oh,{...o,...i,ref:t,align:s,collisionPadding:r,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Da.displayName=Hp;var[qp,ui]=rs(In,{}),Ra="SelectViewport",Zl=h.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:s,...r}=e,i=bn(Ra,n),o=ui(Ra,n),l=It(t,i.onViewportChange),c=h.useRef(0);return a.jsxs(a.Fragment,{children:[a.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),a.jsx(Pr.Slot,{scope:n,children:a.jsx(He.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:de(r.onScroll,d=>{const u=d.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:p}=o;if(p?.current&&f){const x=Math.abs(c.current-u.scrollTop);if(x>0){const b=window.innerHeight-vt*2,m=parseFloat(f.style.minHeight),g=parseFloat(f.style.height),T=Math.max(m,g);if(T<b){const y=T+x,v=Math.min(b,y),S=y-v;f.style.height=v+"px",f.style.bottom==="0px"&&(u.scrollTop=S>0?S:0,f.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});Zl.displayName=Ra;var ec="SelectGroup",[Yp,Qp]=rs(ec),tc=h.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,r=Hn();return a.jsx(Yp,{scope:n,id:r,children:a.jsx(He.div,{role:"group","aria-labelledby":r,...s,ref:t})})});tc.displayName=ec;var nc="SelectLabel",sc=h.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,r=Qp(nc,n);return a.jsx(He.div,{id:r.id,...s,ref:t})});sc.displayName=nc;var mr="SelectItem",[Jp,rc]=rs(mr),ac=h.forwardRef((e,t)=>{const{__scopeSelect:n,value:s,disabled:r=!1,textValue:i,...o}=e,l=mn(mr,n),c=bn(mr,n),d=l.value===s,[u,f]=h.useState(i??""),[p,x]=h.useState(!1),b=It(t,y=>c.itemRefCallback?.(y,s,r)),m=Hn(),g=h.useRef("touch"),T=()=>{r||(l.onValueChange(s),l.onOpenChange(!1))};if(s==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return a.jsx(Jp,{scope:n,value:s,disabled:r,textId:m,isSelected:d,onItemTextChange:h.useCallback(y=>{f(v=>v||(y?.textContent??"").trim())},[]),children:a.jsx(Pr.ItemSlot,{scope:n,value:s,disabled:r,textValue:u,children:a.jsx(He.div,{role:"option","aria-labelledby":m,"data-highlighted":p?"":void 0,"aria-selected":d&&p,"data-state":d?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:b,onFocus:de(o.onFocus,()=>x(!0)),onBlur:de(o.onBlur,()=>x(!1)),onClick:de(o.onClick,()=>{g.current!=="mouse"&&T()}),onPointerUp:de(o.onPointerUp,()=>{g.current==="mouse"&&T()}),onPointerDown:de(o.onPointerDown,y=>{g.current=y.pointerType}),onPointerMove:de(o.onPointerMove,y=>{g.current=y.pointerType,r?c.onItemLeave?.():g.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:de(o.onPointerLeave,y=>{y.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:de(o.onKeyDown,y=>{c.searchRef?.current!==""&&y.key===" "||(Fp.includes(y.key)&&T(),y.key===" "&&y.preventDefault())})})})})});ac.displayName=mr;var js="SelectItemText",ic=h.forwardRef((e,t)=>{const{__scopeSelect:n,className:s,style:r,...i}=e,o=mn(js,n),l=bn(js,n),c=rc(js,n),d=Vp(js,n),[u,f]=h.useState(null),p=It(t,T=>f(T),c.onItemTextChange,T=>l.itemTextRefCallback?.(T,c.value,c.disabled)),x=u?.textContent,b=h.useMemo(()=>a.jsx("option",{value:c.value,disabled:c.disabled,children:x},c.value),[c.disabled,c.value,x]),{onNativeOptionAdd:m,onNativeOptionRemove:g}=d;return ln(()=>(m(b),()=>g(b)),[m,g,b]),a.jsxs(a.Fragment,{children:[a.jsx(He.span,{id:c.textId,...i,ref:p}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?_n.createPortal(i.children,o.valueNode):null]})});ic.displayName=js;var oc="SelectItemIndicator",lc=h.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return rc(oc,n).isSelected?a.jsx(He.span,{"aria-hidden":!0,...s,ref:t}):null});lc.displayName=oc;var Ma="SelectScrollUpButton",cc=h.forwardRef((e,t)=>{const n=bn(Ma,e.__scopeSelect),s=ui(Ma,e.__scopeSelect),[r,i]=h.useState(!1),o=It(t,s.onScrollButtonChange);return ln(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=c.scrollTop>0;i(d)};const c=n.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),r?a.jsx(uc,{...e,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=n;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});cc.displayName=Ma;var Oa="SelectScrollDownButton",dc=h.forwardRef((e,t)=>{const n=bn(Oa,e.__scopeSelect),s=ui(Oa,e.__scopeSelect),[r,i]=h.useState(!1),o=It(t,s.onScrollButtonChange);return ln(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<d;i(u)};const c=n.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),r?a.jsx(uc,{...e,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=n;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});dc.displayName=Oa;var uc=h.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:s,...r}=e,i=bn("SelectScrollButton",n),o=h.useRef(null),l=Fr(n),c=h.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return h.useEffect(()=>()=>c(),[c]),ln(()=>{l().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[l]),a.jsx(He.div,{"aria-hidden":!0,...r,ref:t,style:{flexShrink:0,...r.style},onPointerDown:de(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(s,50))}),onPointerMove:de(r.onPointerMove,()=>{i.onItemLeave?.(),o.current===null&&(o.current=window.setInterval(s,50))}),onPointerLeave:de(r.onPointerLeave,()=>{c()})})}),Zp="SelectSeparator",hc=h.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e;return a.jsx(He.div,{"aria-hidden":!0,...s,ref:t})});hc.displayName=Zp;var Pa="SelectArrow",em=h.forwardRef((e,t)=>{const{__scopeSelect:n,...s}=e,r=Ur(n),i=mn(Pa,n),o=bn(Pa,n);return i.open&&o.position==="popper"?a.jsx(lh,{...r,...s,ref:t}):null});em.displayName=Pa;var tm="SelectBubbleInput",fc=h.forwardRef(({__scopeSelect:e,value:t,...n},s)=>{const r=h.useRef(null),i=It(s,r),o=pf(t);return h.useEffect(()=>{const l=r.current;if(!l)return;const c=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==t&&u){const f=new Event("change",{bubbles:!0});u.call(l,t),l.dispatchEvent(f)}},[o,t]),a.jsx(He.select,{...n,style:{...sh,...n.style},ref:i,defaultValue:t})});fc.displayName=tm;function pc(e){return e===""||e===void 0}function mc(e){const t=ah(e),n=h.useRef(""),s=h.useRef(0),r=h.useCallback(o=>{const l=n.current+o;t(l),(function c(d){n.current=d,window.clearTimeout(s.current),d!==""&&(s.current=window.setTimeout(()=>c(""),1e3))})(l)},[t]),i=h.useCallback(()=>{n.current="",window.clearTimeout(s.current)},[]);return h.useEffect(()=>()=>window.clearTimeout(s.current),[]),[n,r,i]}function bc(e,t,n){const r=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,i=n?e.indexOf(n):-1;let o=nm(e,Math.max(i,0));r.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==n?c:void 0}function nm(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var sm=Vl,xc=zl,rm=Xl,am=Wl,im=Hl,gc=ql,om=Zl,lm=tc,vc=sc,Nc=ac,cm=ic,dm=lc,yc=cc,Ec=dc,_c=hc;const Xs=sm,Ms=lm,Ws=rm,as=D.forwardRef(({className:e,children:t,...n},s)=>a.jsxs(xc,{ref:s,className:M("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,a.jsx(am,{asChild:!0,children:a.jsx(jh,{className:"size-4 opacity-50"})})]}));as.displayName=xc.displayName;const Tc=D.forwardRef(({className:e,...t},n)=>a.jsx(yc,{ref:n,className:M("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(Sh,{})}));Tc.displayName=yc.displayName;const wc=D.forwardRef(({className:e,...t},n)=>a.jsx(Ec,{ref:n,className:M("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(_l,{})}));wc.displayName=Ec.displayName;const is=D.forwardRef(({className:e,children:t,position:n="popper",...s},r)=>a.jsx(im,{children:a.jsxs(gc,{ref:r,className:M("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...s,children:[a.jsx(Tc,{}),a.jsx(om,{className:M("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),a.jsx(wc,{})]})}));is.displayName=gc.displayName;const Fa=D.forwardRef(({className:e,...t},n)=>a.jsx(vc,{ref:n,className:M("px-2 py-1.5 text-sm font-semibold",e),...t}));Fa.displayName=vc.displayName;const Ke=D.forwardRef(({className:e,children:t,...n},s)=>a.jsxs(Nc,{ref:s,className:M("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(dm,{children:a.jsx(El,{className:"size-4"})})}),a.jsx(cm,{children:t})]}));Ke.displayName=Nc.displayName;const Cc=D.forwardRef(({className:e,...t},n)=>a.jsx(_c,{ref:n,className:M("-mx-1 my-1 h-px bg-muted",e),...t}));Cc.displayName=_c.displayName;const Ae=D.forwardRef((e,t)=>a.jsx(K,{ref:t,variant:"ghost",className:"size-8 p-2 text-slate-500 hover:cursor-pointer hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",asChild:!0,...e}));Ae.displayName="ListItemHeaderButton";function um(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.useMemo(()=>s=>{t.forEach(r=>r(s))},t)}const Br=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function os(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function hi(e){return"nodeType"in e}function tt(e){var t,n;return e?os(e)?e:hi(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function fi(e){const{Document:t}=tt(e);return e instanceof t}function Hs(e){return os(e)?!1:e instanceof tt(e).HTMLElement}function Ic(e){return e instanceof tt(e).SVGElement}function ls(e){return e?os(e)?e.document:hi(e)?fi(e)?e:Hs(e)||Ic(e)?e.ownerDocument:document:document:document}const Mt=Br?h.useLayoutEffect:h.useEffect;function pi(e){const t=h.useRef(e);return Mt(()=>{t.current=e}),h.useCallback(function(){for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return t.current==null?void 0:t.current(...s)},[])}function hm(){const e=h.useRef(null),t=h.useCallback((s,r)=>{e.current=setInterval(s,r)},[]),n=h.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Os(e,t){t===void 0&&(t=[e]);const n=h.useRef(e);return Mt(()=>{n.current!==e&&(n.current=e)},t),n}function qs(e,t){const n=h.useRef();return h.useMemo(()=>{const s=e(n.current);return n.current=s,s},[...t])}function br(e){const t=pi(e),n=h.useRef(null),s=h.useCallback(r=>{r!==n.current&&t?.(r,n.current),n.current=r},[]);return[n,s]}function Ua(e){const t=h.useRef();return h.useEffect(()=>{t.current=e},[e]),t.current}let ya={};function Ys(e,t){return h.useMemo(()=>{if(t)return t;const n=ya[e]==null?0:ya[e]+1;return ya[e]=n,e+"-"+n},[e,t])}function jc(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];return s.reduce((i,o)=>{const l=Object.entries(o);for(const[c,d]of l){const u=i[c];u!=null&&(i[c]=u+e*d)}return i},{...t})}}const qn=jc(1),xr=jc(-1);function fm(e){return"clientX"in e&&"clientY"in e}function mi(e){if(!e)return!1;const{KeyboardEvent:t}=tt(e.target);return t&&e instanceof t}function pm(e){if(!e)return!1;const{TouchEvent:t}=tt(e.target);return t&&e instanceof t}function Ba(e){if(pm(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return fm(e)?{x:e.clientX,y:e.clientY}:null}const Ot=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Ot.Translate.toString(e),Ot.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:s}=e;return t+" "+n+"ms "+s}}}),po="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function mm(e){return e.matches(po)?e:e.querySelector(po)}const bm={display:"none"};function xm(e){let{id:t,value:n}=e;return D.createElement("div",{id:t,style:bm},n)}function gm(e){let{id:t,announcement:n,ariaLiveType:s="assertive"}=e;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return D.createElement("div",{id:t,style:r,role:"status","aria-live":s,"aria-atomic":!0},n)}function vm(){const[e,t]=h.useState("");return{announce:h.useCallback(s=>{s!=null&&t(s)},[]),announcement:e}}const Sc=h.createContext(null);function Nm(e){const t=h.useContext(Sc);h.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function ym(){const[e]=h.useState(()=>new Set),t=h.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[h.useCallback(s=>{let{type:r,event:i}=s;e.forEach(o=>{var l;return(l=o[r])==null?void 0:l.call(o,i)})},[e]),t]}const Em={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},_m={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Tm(e){let{announcements:t=_m,container:n,hiddenTextDescribedById:s,screenReaderInstructions:r=Em}=e;const{announce:i,announcement:o}=vm(),l=Ys("DndLiveRegion"),[c,d]=h.useState(!1);if(h.useEffect(()=>{d(!0)},[]),Nm(h.useMemo(()=>({onDragStart(f){let{active:p}=f;i(t.onDragStart({active:p}))},onDragMove(f){let{active:p,over:x}=f;t.onDragMove&&i(t.onDragMove({active:p,over:x}))},onDragOver(f){let{active:p,over:x}=f;i(t.onDragOver({active:p,over:x}))},onDragEnd(f){let{active:p,over:x}=f;i(t.onDragEnd({active:p,over:x}))},onDragCancel(f){let{active:p,over:x}=f;i(t.onDragCancel({active:p,over:x}))}}),[i,t])),!c)return null;const u=D.createElement(D.Fragment,null,D.createElement(xm,{id:s,value:r.draggable}),D.createElement(gm,{id:l,announcement:o}));return n?_n.createPortal(u,n):u}var ke;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ke||(ke={}));function gr(){}function cs(e,t){return h.useMemo(()=>({sensor:e,options:{}}),[e,t])}function ds(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.useMemo(()=>[...t].filter(s=>s!=null),[...t])}const Tt=Object.freeze({x:0,y:0});function wm(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Cm(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return n-s}function Im(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return s-n}function jm(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function mo(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const us=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const r=mo(t,t.left,t.top),i=[];for(const o of s){const{id:l}=o,c=n.get(l);if(c){const d=wm(mo(c),r);i.push({id:l,data:{droppableContainer:o,value:d}})}}return i.sort(Cm)};function Sm(e,t){const n=Math.max(t.top,e.top),s=Math.max(t.left,e.left),r=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),o=r-s,l=i-n;if(s<r&&n<i){const c=t.width*t.height,d=e.width*e.height,u=o*l,f=u/(c+d-u);return Number(f.toFixed(4))}return 0}const km=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const r=[];for(const i of s){const{id:o}=i,l=n.get(o);if(l){const c=Sm(l,t);c>0&&r.push({id:o,data:{droppableContainer:i,value:c}})}}return r.sort(Im)};function Lm(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function kc(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Tt}function Am(e){return function(n){for(var s=arguments.length,r=new Array(s>1?s-1:0),i=1;i<s;i++)r[i-1]=arguments[i];return r.reduce((o,l)=>({...o,top:o.top+e*l.y,bottom:o.bottom+e*l.y,left:o.left+e*l.x,right:o.right+e*l.x}),{...n})}}const Dm=Am(1);function Rm(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Mm(e,t,n){const s=Rm(t);if(!s)return e;const{scaleX:r,scaleY:i,x:o,y:l}=s,c=e.left-o-(1-r)*parseFloat(n),d=e.top-l-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),u=r?e.width/r:e.width,f=i?e.height/i:e.height;return{width:u,height:f,top:d,right:c+u,bottom:d+f,left:c}}const Om={ignoreTransform:!1};function hs(e,t){t===void 0&&(t=Om);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:u}=tt(e).getComputedStyle(e);d&&(n=Mm(n,d,u))}const{top:s,left:r,width:i,height:o,bottom:l,right:c}=n;return{top:s,left:r,width:i,height:o,bottom:l,right:c}}function bo(e){return hs(e,{ignoreTransform:!0})}function Pm(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Fm(e,t){return t===void 0&&(t=tt(e).getComputedStyle(e)),t.position==="fixed"}function Um(e,t){t===void 0&&(t=tt(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const i=t[r];return typeof i=="string"?n.test(i):!1})}function bi(e,t){const n=[];function s(r){if(t!=null&&n.length>=t||!r)return n;if(fi(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Hs(r)||Ic(r)||n.includes(r))return n;const i=tt(e).getComputedStyle(r);return r!==e&&Um(r,i)&&n.push(r),Fm(r,i)?n:s(r.parentNode)}return e?s(e):n}function Lc(e){const[t]=bi(e,1);return t??null}function Ea(e){return!Br||!e?null:os(e)?e:hi(e)?fi(e)||e===ls(e).scrollingElement?window:Hs(e)?e:null:null}function Ac(e){return os(e)?e.scrollX:e.scrollLeft}function Dc(e){return os(e)?e.scrollY:e.scrollTop}function $a(e){return{x:Ac(e),y:Dc(e)}}var Me;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Me||(Me={}));function Rc(e){return!Br||!e?!1:e===document.scrollingElement}function Mc(e){const t={x:0,y:0},n=Rc(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},r=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,o=e.scrollTop>=s.y,l=e.scrollLeft>=s.x;return{isTop:r,isLeft:i,isBottom:o,isRight:l,maxScroll:s,minScroll:t}}const Bm={x:.2,y:.2};function $m(e,t,n,s,r){let{top:i,left:o,right:l,bottom:c}=n;s===void 0&&(s=10),r===void 0&&(r=Bm);const{isTop:d,isBottom:u,isLeft:f,isRight:p}=Mc(e),x={x:0,y:0},b={x:0,y:0},m={height:t.height*r.y,width:t.width*r.x};return!d&&i<=t.top+m.height?(x.y=Me.Backward,b.y=s*Math.abs((t.top+m.height-i)/m.height)):!u&&c>=t.bottom-m.height&&(x.y=Me.Forward,b.y=s*Math.abs((t.bottom-m.height-c)/m.height)),!p&&l>=t.right-m.width?(x.x=Me.Forward,b.x=s*Math.abs((t.right-m.width-l)/m.width)):!f&&o<=t.left+m.width&&(x.x=Me.Backward,b.x=s*Math.abs((t.left+m.width-o)/m.width)),{direction:x,speed:b}}function Vm(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:t,left:n,right:s,bottom:r}=e.getBoundingClientRect();return{top:t,left:n,right:s,bottom:r,width:e.clientWidth,height:e.clientHeight}}function Oc(e){return e.reduce((t,n)=>qn(t,$a(n)),Tt)}function Gm(e){return e.reduce((t,n)=>t+Ac(n),0)}function zm(e){return e.reduce((t,n)=>t+Dc(n),0)}function Km(e,t){if(t===void 0&&(t=hs),!e)return;const{top:n,left:s,bottom:r,right:i}=t(e);Lc(e)&&(r<=0||i<=0||n>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const Xm=[["x",["left","right"],Gm],["y",["top","bottom"],zm]];class xi{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=bi(n),r=Oc(s);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,o,l]of Xm)for(const c of o)Object.defineProperty(this,c,{get:()=>{const d=l(s),u=r[i]-d;return this.rect[c]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ks{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=t}add(t,n,s){var r;(r=this.target)==null||r.addEventListener(t,n,s),this.listeners.push([t,n,s])}}function Wm(e){const{EventTarget:t}=tt(e);return e instanceof t?e:ls(e)}function _a(e,t){const n=Math.abs(e.x),s=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+s**2)>t:"x"in t&&"y"in t?n>t.x&&s>t.y:"x"in t?n>t.x:"y"in t?s>t.y:!1}var ut;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(ut||(ut={}));function xo(e){e.preventDefault()}function Hm(e){e.stopPropagation()}var ne;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(ne||(ne={}));const Pc={start:[ne.Space,ne.Enter],cancel:[ne.Esc],end:[ne.Space,ne.Enter,ne.Tab]},qm=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case ne.Right:return{...n,x:n.x+25};case ne.Left:return{...n,x:n.x-25};case ne.Down:return{...n,y:n.y+25};case ne.Up:return{...n,y:n.y-25}}};class Fc{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new ks(ls(n)),this.windowListeners=new ks(tt(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ut.Resize,this.handleCancel),this.windowListeners.add(ut.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ut.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,s=t.node.current;s&&Km(s),n(Tt)}handleKeyDown(t){if(mi(t)){const{active:n,context:s,options:r}=this.props,{keyboardCodes:i=Pc,coordinateGetter:o=qm,scrollBehavior:l="smooth"}=r,{code:c}=t;if(i.end.includes(c)){this.handleEnd(t);return}if(i.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:d}=s.current,u=d?{x:d.left,y:d.top}:Tt;this.referenceCoordinates||(this.referenceCoordinates=u);const f=o(t,{active:n,context:s.current,currentCoordinates:u});if(f){const p=xr(f,u),x={x:0,y:0},{scrollableAncestors:b}=s.current;for(const m of b){const g=t.code,{isTop:T,isRight:y,isLeft:v,isBottom:S,maxScroll:I,minScroll:k}=Mc(m),C=Vm(m),_={x:Math.min(g===ne.Right?C.right-C.width/2:C.right,Math.max(g===ne.Right?C.left:C.left+C.width/2,f.x)),y:Math.min(g===ne.Down?C.bottom-C.height/2:C.bottom,Math.max(g===ne.Down?C.top:C.top+C.height/2,f.y))},j=g===ne.Right&&!y||g===ne.Left&&!v,R=g===ne.Down&&!S||g===ne.Up&&!T;if(j&&_.x!==f.x){const L=m.scrollLeft+p.x,X=g===ne.Right&&L<=I.x||g===ne.Left&&L>=k.x;if(X&&!p.y){m.scrollTo({left:L,behavior:l});return}X?x.x=m.scrollLeft-L:x.x=g===ne.Right?m.scrollLeft-I.x:m.scrollLeft-k.x,x.x&&m.scrollBy({left:-x.x,behavior:l});break}else if(R&&_.y!==f.y){const L=m.scrollTop+p.y,X=g===ne.Down&&L<=I.y||g===ne.Up&&L>=k.y;if(X&&!p.x){m.scrollTo({top:L,behavior:l});return}X?x.y=m.scrollTop-L:x.y=g===ne.Down?m.scrollTop-I.y:m.scrollTop-k.y,x.y&&m.scrollBy({top:-x.y,behavior:l});break}}this.handleMove(t,qn(xr(f,this.referenceCoordinates),x))}}}handleMove(t,n){const{onMove:s}=this.props;t.preventDefault(),s(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Fc.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:s=Pc,onActivation:r}=t,{active:i}=n;const{code:o}=e.nativeEvent;if(s.start.includes(o)){const l=i.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),r?.({event:e.nativeEvent}),!0)}return!1}}];function go(e){return!!(e&&"distance"in e)}function vo(e){return!!(e&&"delay"in e)}class gi{constructor(t,n,s){var r;s===void 0&&(s=Wm(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:o}=i;this.props=t,this.events=n,this.document=ls(o),this.documentListeners=new ks(this.document),this.listeners=new ks(s),this.windowListeners=new ks(tt(o)),this.initialCoordinates=(r=Ba(i))!=null?r:Tt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(ut.Resize,this.handleCancel),this.windowListeners.add(ut.DragStart,xo),this.windowListeners.add(ut.VisibilityChange,this.handleCancel),this.windowListeners.add(ut.ContextMenu,xo),this.documentListeners.add(ut.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(vo(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(go(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:s,onPending:r}=this.props;r(s,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(ut.Click,Hm,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ut.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:s,initialCoordinates:r,props:i}=this,{onMove:o,options:{activationConstraint:l}}=i;if(!r)return;const c=(n=Ba(t))!=null?n:Tt,d=xr(r,c);if(!s&&l){if(go(l)){if(l.tolerance!=null&&_a(d,l.tolerance))return this.handleCancel();if(_a(d,l.distance))return this.handleStart()}if(vo(l)&&_a(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}t.cancelable&&t.preventDefault(),o(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===ne.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Ym={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class xn extends gi{constructor(t){const{event:n}=t,s=ls(n.target);super(t,Ym,s)}}xn.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return!n.isPrimary||n.button!==0?!1:(s?.({event:n}),!0)}}];const Qm={move:{name:"mousemove"},end:{name:"mouseup"}};var Va;(function(e){e[e.RightClick=2]="RightClick"})(Va||(Va={}));class Jm extends gi{constructor(t){super(t,Qm,ls(t.event.target))}}Jm.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return n.button===Va.RightClick?!1:(s?.({event:n}),!0)}}];const Ta={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Zm extends gi{constructor(t){super(t,Ta)}static setup(){return window.addEventListener(Ta.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Ta.move.name,t)};function t(){}}}Zm.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;const{touches:r}=n;return r.length>1?!1:(s?.({event:n}),!0)}}];var Ls;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Ls||(Ls={}));var vr;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(vr||(vr={}));function eb(e){let{acceleration:t,activator:n=Ls.Pointer,canScroll:s,draggingRect:r,enabled:i,interval:o=5,order:l=vr.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:u,delta:f,threshold:p}=e;const x=nb({delta:f,disabled:!i}),[b,m]=hm(),g=h.useRef({x:0,y:0}),T=h.useRef({x:0,y:0}),y=h.useMemo(()=>{switch(n){case Ls.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case Ls.DraggableRect:return r}},[n,r,c]),v=h.useRef(null),S=h.useCallback(()=>{const k=v.current;if(!k)return;const C=g.current.x*T.current.x,_=g.current.y*T.current.y;k.scrollBy(C,_)},[]),I=h.useMemo(()=>l===vr.TreeOrder?[...d].reverse():d,[l,d]);h.useEffect(()=>{if(!i||!d.length||!y){m();return}for(const k of I){if(s?.(k)===!1)continue;const C=d.indexOf(k),_=u[C];if(!_)continue;const{direction:j,speed:R}=$m(k,_,y,t,p);for(const L of["x","y"])x[L][j[L]]||(R[L]=0,j[L]=0);if(R.x>0||R.y>0){m(),v.current=k,b(S,o),g.current=R,T.current=j;return}}g.current={x:0,y:0},T.current={x:0,y:0},m()},[t,S,s,m,i,o,JSON.stringify(y),JSON.stringify(x),b,d,I,u,JSON.stringify(p)])}const tb={x:{[Me.Backward]:!1,[Me.Forward]:!1},y:{[Me.Backward]:!1,[Me.Forward]:!1}};function nb(e){let{delta:t,disabled:n}=e;const s=Ua(t);return qs(r=>{if(n||!s||!r)return tb;const i={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[Me.Backward]:r.x[Me.Backward]||i.x===-1,[Me.Forward]:r.x[Me.Forward]||i.x===1},y:{[Me.Backward]:r.y[Me.Backward]||i.y===-1,[Me.Forward]:r.y[Me.Forward]||i.y===1}}},[n,t,s])}function sb(e,t){const n=t!=null?e.get(t):void 0,s=n?n.node.current:null;return qs(r=>{var i;return t==null?null:(i=s??r)!=null?i:null},[s,t])}function rb(e,t){return h.useMemo(()=>e.reduce((n,s)=>{const{sensor:r}=s,i=r.activators.map(o=>({eventName:o.eventName,handler:t(o.handler,s)}));return[...n,...i]},[]),[e,t])}var Ps;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Ps||(Ps={}));var Ga;(function(e){e.Optimized="optimized"})(Ga||(Ga={}));const No=new Map;function ab(e,t){let{dragging:n,dependencies:s,config:r}=t;const[i,o]=h.useState(null),{frequency:l,measure:c,strategy:d}=r,u=h.useRef(e),f=g(),p=Os(f),x=h.useCallback(function(T){T===void 0&&(T=[]),!p.current&&o(y=>y===null?T:y.concat(T.filter(v=>!y.includes(v))))},[p]),b=h.useRef(null),m=qs(T=>{if(f&&!n)return No;if(!T||T===No||u.current!==e||i!=null){const y=new Map;for(let v of e){if(!v)continue;if(i&&i.length>0&&!i.includes(v.id)&&v.rect.current){y.set(v.id,v.rect.current);continue}const S=v.node.current,I=S?new xi(c(S),S):null;v.rect.current=I,I&&y.set(v.id,I)}return y}return T},[e,i,n,f,c]);return h.useEffect(()=>{u.current=e},[e]),h.useEffect(()=>{f||x()},[n,f]),h.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),h.useEffect(()=>{f||typeof l!="number"||b.current!==null||(b.current=setTimeout(()=>{x(),b.current=null},l))},[l,f,x,...s]),{droppableRects:m,measureDroppableContainers:x,measuringScheduled:i!=null};function g(){switch(d){case Ps.Always:return!1;case Ps.BeforeDragging:return n;default:return!n}}}function Uc(e,t){return qs(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ib(e,t){return Uc(e,t)}function ob(e){let{callback:t,disabled:n}=e;const s=pi(t),r=h.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,n]);return h.useEffect(()=>()=>r?.disconnect(),[r]),r}function $r(e){let{callback:t,disabled:n}=e;const s=pi(t),r=h.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[n]);return h.useEffect(()=>()=>r?.disconnect(),[r]),r}function lb(e){return new xi(hs(e),e)}function yo(e,t,n){t===void 0&&(t=lb);const[s,r]=h.useState(null);function i(){r(c=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=c??n)!=null?d:null}const u=t(e);return JSON.stringify(c)===JSON.stringify(u)?c:u})}const o=ob({callback(c){if(e)for(const d of c){const{type:u,target:f}=d;if(u==="childList"&&f instanceof HTMLElement&&f.contains(e)){i();break}}}}),l=$r({callback:i});return Mt(()=>{i(),e?(l?.observe(e),o?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),o?.disconnect())},[e]),s}function cb(e){const t=Uc(e);return kc(e,t)}const Eo=[];function db(e){const t=h.useRef(e),n=qs(s=>e?s&&s!==Eo&&e&&t.current&&e.parentNode===t.current.parentNode?s:bi(e):Eo,[e]);return h.useEffect(()=>{t.current=e},[e]),n}function ub(e){const[t,n]=h.useState(null),s=h.useRef(e),r=h.useCallback(i=>{const o=Ea(i.target);o&&n(l=>l?(l.set(o,$a(o)),new Map(l)):null)},[]);return h.useEffect(()=>{const i=s.current;if(e!==i){o(i);const l=e.map(c=>{const d=Ea(c);return d?(d.addEventListener("scroll",r,{passive:!0}),[d,$a(d)]):null}).filter(c=>c!=null);n(l.length?new Map(l):null),s.current=e}return()=>{o(e),o(i)};function o(l){l.forEach(c=>{const d=Ea(c);d?.removeEventListener("scroll",r)})}},[r,e]),h.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,o)=>qn(i,o),Tt):Oc(e):Tt,[e,t])}function _o(e,t){t===void 0&&(t=[]);const n=h.useRef(null);return h.useEffect(()=>{n.current=null},t),h.useEffect(()=>{const s=e!==Tt;s&&!n.current&&(n.current=e),!s&&n.current&&(n.current=null)},[e]),n.current?xr(e,n.current):Tt}function hb(e){h.useEffect(()=>{if(!Br)return;const t=e.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of t)n?.()}},e.map(t=>{let{sensor:n}=t;return n}))}function fb(e,t){return h.useMemo(()=>e.reduce((n,s)=>{let{eventName:r,handler:i}=s;return n[r]=o=>{i(o,t)},n},{}),[e,t])}function Bc(e){return h.useMemo(()=>e?Pm(e):null,[e])}const To=[];function pb(e,t){t===void 0&&(t=hs);const[n]=e,s=Bc(n?tt(n):null),[r,i]=h.useState(To);function o(){i(()=>e.length?e.map(c=>Rc(c)?s:new xi(t(c),c)):To)}const l=$r({callback:o});return Mt(()=>{l?.disconnect(),o(),e.forEach(c=>l?.observe(c))},[e]),r}function mb(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Hs(t)?t:e}function bb(e){let{measure:t}=e;const[n,s]=h.useState(null),r=h.useCallback(d=>{for(const{target:u}of d)if(Hs(u)){s(f=>{const p=t(u);return f?{...f,width:p.width,height:p.height}:p});break}},[t]),i=$r({callback:r}),o=h.useCallback(d=>{const u=mb(d);i?.disconnect(),u&&i?.observe(u),s(u?t(u):null)},[t,i]),[l,c]=br(o);return h.useMemo(()=>({nodeRef:l,rect:n,setRef:c}),[n,l,c])}const xb=[{sensor:xn,options:{}},{sensor:Fc,options:{}}],gb={current:{}},or={draggable:{measure:bo},droppable:{measure:bo,strategy:Ps.WhileDragging,frequency:Ga.Optimized},dragOverlay:{measure:hs}};class As extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,s;return(n=(s=this.get(t))==null?void 0:s.node.current)!=null?n:void 0}}const vb={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new As,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:gr},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:or,measureDroppableContainers:gr,windowRect:null,measuringScheduled:!1},Nb={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:gr,draggableNodes:new Map,over:null,measureDroppableContainers:gr},Vr=h.createContext(Nb),$c=h.createContext(vb);function yb(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new As}}}function Eb(e,t){switch(t.type){case ke.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ke.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ke.DragEnd:case ke.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ke.RegisterDroppable:{const{element:n}=t,{id:s}=n,r=new As(e.droppable.containers);return r.set(s,n),{...e,droppable:{...e.droppable,containers:r}}}case ke.SetDroppableDisabled:{const{id:n,key:s,disabled:r}=t,i=e.droppable.containers.get(n);if(!i||s!==i.key)return e;const o=new As(e.droppable.containers);return o.set(n,{...i,disabled:r}),{...e,droppable:{...e.droppable,containers:o}}}case ke.UnregisterDroppable:{const{id:n,key:s}=t,r=e.droppable.containers.get(n);if(!r||s!==r.key)return e;const i=new As(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function _b(e){let{disabled:t}=e;const{active:n,activatorEvent:s,draggableNodes:r}=h.useContext(Vr),i=Ua(s),o=Ua(n?.id);return h.useEffect(()=>{if(!t&&!s&&i&&o!=null){if(!mi(i)||document.activeElement===i.target)return;const l=r.get(o);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const u of[c.current,d.current]){if(!u)continue;const f=mm(u);if(f){f.focus();break}}})}},[s,t,r,o,i]),null}function Tb(e,t){let{transform:n,...s}=t;return e!=null&&e.length?e.reduce((r,i)=>i({transform:r,...s}),n):n}function wb(e){return h.useMemo(()=>({draggable:{...or.draggable,...e?.draggable},droppable:{...or.droppable,...e?.droppable},dragOverlay:{...or.dragOverlay,...e?.dragOverlay}}),[e?.draggable,e?.droppable,e?.dragOverlay])}function Cb(e){let{activeNode:t,measure:n,initialRect:s,config:r=!0}=e;const i=h.useRef(!1),{x:o,y:l}=typeof r=="boolean"?{x:r,y:r}:r;Mt(()=>{if(!o&&!l||!t){i.current=!1;return}if(i.current||!s)return;const d=t?.node.current;if(!d||d.isConnected===!1)return;const u=n(d),f=kc(u,s);if(o||(f.x=0),l||(f.y=0),i.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const p=Lc(d);p&&p.scrollBy({top:f.y,left:f.x})}},[t,o,l,s,n])}const Vc=h.createContext({...Tt,scaleX:1,scaleY:1});var tn;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(tn||(tn={}));const fs=h.memo(function(t){var n,s,r,i;let{id:o,accessibility:l,autoScroll:c=!0,children:d,sensors:u=xb,collisionDetection:f=km,measuring:p,modifiers:x,...b}=t;const m=h.useReducer(Eb,void 0,yb),[g,T]=m,[y,v]=ym(),[S,I]=h.useState(tn.Uninitialized),k=S===tn.Initialized,{draggable:{active:C,nodes:_,translate:j},droppable:{containers:R}}=g,L=C!=null?_.get(C):null,X=h.useRef({initial:null,translated:null}),P=h.useMemo(()=>{var Ue;return C!=null?{id:C,data:(Ue=L?.data)!=null?Ue:gb,rect:X}:null},[C,L]),F=h.useRef(null),[Q,J]=h.useState(null),[te,je]=h.useState(null),me=Os(b,Object.values(b)),qe=Ys("DndDescribedBy",o),Ye=h.useMemo(()=>R.getEnabled(),[R]),he=wb(p),{droppableRects:De,measureDroppableContainers:Se,measuringScheduled:Re}=ab(Ye,{dragging:k,dependencies:[j.x,j.y],config:he.droppable}),ee=sb(_,C),V=h.useMemo(()=>te?Ba(te):null,[te]),Y=Zu(),oe=ib(ee,he.draggable.measure);Cb({activeNode:C!=null?_.get(C):null,config:Y.layoutShiftCompensation,initialRect:oe,measure:he.draggable.measure});const B=yo(ee,he.draggable.measure,oe),W=yo(ee?ee.parentElement:null),H=h.useRef({activatorEvent:null,active:null,activeNode:ee,collisionRect:null,collisions:null,droppableRects:De,draggableNodes:_,draggingNode:null,draggingNodeRect:null,droppableContainers:R,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),q=R.getNodeFor((n=H.current.over)==null?void 0:n.id),Z=bb({measure:he.dragOverlay.measure}),fe=(s=Z.nodeRef.current)!=null?s:ee,Qe=k?(r=Z.rect)!=null?r:B:null,Ht=!!(Z.nodeRef.current&&Z.rect),Ui=cb(Ht?null:B),ra=Bc(fe?tt(fe):null),qt=db(k?q??ee:null),Zs=pb(qt),er=Tb(x,{transform:{x:j.x-Ui.x,y:j.y-Ui.y,scaleX:1,scaleY:1},activatorEvent:te,active:P,activeNodeRect:B,containerNodeRect:W,draggingNodeRect:Qe,over:H.current.over,overlayNodeRect:Z.rect,scrollableAncestors:qt,scrollableAncestorRects:Zs,windowRect:ra}),Bi=V?qn(V,j):null,$i=ub(qt),Xu=_o($i),Wu=_o($i,[B]),Un=qn(er,Xu),Bn=Qe?Dm(Qe,er):null,Es=P&&Bn?f({active:P,collisionRect:Bn,droppableRects:De,droppableContainers:Ye,pointerCoordinates:Bi}):null,Vi=jm(Es,"id"),[Yt,Gi]=h.useState(null),Hu=Ht?er:qn(er,Wu),qu=Lm(Hu,(i=Yt?.rect)!=null?i:null,B),aa=h.useRef(null),zi=h.useCallback((Ue,nt)=>{let{sensor:st,options:Qt}=nt;if(F.current==null)return;const ct=_.get(F.current);if(!ct)return;const rt=Ue.nativeEvent,St=new st({active:F.current,activeNode:ct,event:rt,options:Qt,context:H,onAbort(Pe){if(!_.get(Pe))return;const{onDragAbort:kt}=me.current,Vt={id:Pe};kt?.(Vt),y({type:"onDragAbort",event:Vt})},onPending(Pe,Jt,kt,Vt){if(!_.get(Pe))return;const{onDragPending:Ts}=me.current,Zt={id:Pe,constraint:Jt,initialCoordinates:kt,offset:Vt};Ts?.(Zt),y({type:"onDragPending",event:Zt})},onStart(Pe){const Jt=F.current;if(Jt==null)return;const kt=_.get(Jt);if(!kt)return;const{onDragStart:Vt}=me.current,_s={activatorEvent:rt,active:{id:Jt,data:kt.data,rect:X}};_n.unstable_batchedUpdates(()=>{Vt?.(_s),I(tn.Initializing),T({type:ke.DragStart,initialCoordinates:Pe,active:Jt}),y({type:"onDragStart",event:_s}),J(aa.current),je(rt)})},onMove(Pe){T({type:ke.DragMove,coordinates:Pe})},onEnd:$n(ke.DragEnd),onCancel:$n(ke.DragCancel)});aa.current=St;function $n(Pe){return async function(){const{active:kt,collisions:Vt,over:_s,scrollAdjustedTranslate:Ts}=H.current;let Zt=null;if(kt&&Ts){const{cancelDrop:ws}=me.current;Zt={activatorEvent:rt,active:kt,collisions:Vt,delta:Ts,over:_s},Pe===ke.DragEnd&&typeof ws=="function"&&await Promise.resolve(ws(Zt))&&(Pe=ke.DragCancel)}F.current=null,_n.unstable_batchedUpdates(()=>{T({type:Pe}),I(tn.Uninitialized),Gi(null),J(null),je(null),aa.current=null;const ws=Pe===ke.DragEnd?"onDragEnd":"onDragCancel";if(Zt){const ia=me.current[ws];ia?.(Zt),y({type:ws,event:Zt})}})}}},[_]),Yu=h.useCallback((Ue,nt)=>(st,Qt)=>{const ct=st.nativeEvent,rt=_.get(Qt);if(F.current!==null||!rt||ct.dndKit||ct.defaultPrevented)return;const St={active:rt};Ue(st,nt.options,St)===!0&&(ct.dndKit={capturedBy:nt.sensor},F.current=Qt,zi(st,nt))},[_,zi]),Ki=rb(u,Yu);hb(u),Mt(()=>{B&&S===tn.Initializing&&I(tn.Initialized)},[B,S]),h.useEffect(()=>{const{onDragMove:Ue}=me.current,{active:nt,activatorEvent:st,collisions:Qt,over:ct}=H.current;if(!nt||!st)return;const rt={active:nt,activatorEvent:st,collisions:Qt,delta:{x:Un.x,y:Un.y},over:ct};_n.unstable_batchedUpdates(()=>{Ue?.(rt),y({type:"onDragMove",event:rt})})},[Un.x,Un.y]),h.useEffect(()=>{const{active:Ue,activatorEvent:nt,collisions:st,droppableContainers:Qt,scrollAdjustedTranslate:ct}=H.current;if(!Ue||F.current==null||!nt||!ct)return;const{onDragOver:rt}=me.current,St=Qt.get(Vi),$n=St&&St.rect.current?{id:St.id,rect:St.rect.current,data:St.data,disabled:St.disabled}:null,Pe={active:Ue,activatorEvent:nt,collisions:st,delta:{x:ct.x,y:ct.y},over:$n};_n.unstable_batchedUpdates(()=>{Gi($n),rt?.(Pe),y({type:"onDragOver",event:Pe})})},[Vi]),Mt(()=>{H.current={activatorEvent:te,active:P,activeNode:ee,collisionRect:Bn,collisions:Es,droppableRects:De,draggableNodes:_,draggingNode:fe,draggingNodeRect:Qe,droppableContainers:R,over:Yt,scrollableAncestors:qt,scrollAdjustedTranslate:Un},X.current={initial:Qe,translated:Bn}},[P,ee,Es,Bn,_,fe,Qe,De,R,Yt,qt,Un]),eb({...Y,delta:j,draggingRect:Bn,pointerCoordinates:Bi,scrollableAncestors:qt,scrollableAncestorRects:Zs});const Qu=h.useMemo(()=>({active:P,activeNode:ee,activeNodeRect:B,activatorEvent:te,collisions:Es,containerNodeRect:W,dragOverlay:Z,draggableNodes:_,droppableContainers:R,droppableRects:De,over:Yt,measureDroppableContainers:Se,scrollableAncestors:qt,scrollableAncestorRects:Zs,measuringConfiguration:he,measuringScheduled:Re,windowRect:ra}),[P,ee,B,te,Es,W,Z,_,R,De,Yt,Se,qt,Zs,he,Re,ra]),Ju=h.useMemo(()=>({activatorEvent:te,activators:Ki,active:P,activeNodeRect:B,ariaDescribedById:{draggable:qe},dispatch:T,draggableNodes:_,over:Yt,measureDroppableContainers:Se}),[te,Ki,P,B,T,qe,_,Yt,Se]);return D.createElement(Sc.Provider,{value:v},D.createElement(Vr.Provider,{value:Ju},D.createElement($c.Provider,{value:Qu},D.createElement(Vc.Provider,{value:qu},d)),D.createElement(_b,{disabled:l?.restoreFocus===!1})),D.createElement(Tm,{...l,hiddenTextDescribedById:qe}));function Zu(){const Ue=Q?.autoScrollEnabled===!1,nt=typeof c=="object"?c.enabled===!1:c===!1,st=k&&!Ue&&!nt;return typeof c=="object"?{...c,enabled:st}:{enabled:st}}}),Ib=h.createContext(null),wo="button",jb="Draggable";function Sb(e){let{id:t,data:n,disabled:s=!1,attributes:r}=e;const i=Ys(jb),{activators:o,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:u,draggableNodes:f,over:p}=h.useContext(Vr),{role:x=wo,roleDescription:b="draggable",tabIndex:m=0}=r??{},g=c?.id===t,T=h.useContext(g?Vc:Ib),[y,v]=br(),[S,I]=br(),k=fb(o,t),C=Os(n);Mt(()=>(f.set(t,{id:t,key:i,node:y,activatorNode:S,data:C}),()=>{const j=f.get(t);j&&j.key===i&&f.delete(t)}),[f,t]);const _=h.useMemo(()=>({role:x,tabIndex:m,"aria-disabled":s,"aria-pressed":g&&x===wo?!0:void 0,"aria-roledescription":b,"aria-describedby":u.draggable}),[s,x,m,g,b,u.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:_,isDragging:g,listeners:s?void 0:k,node:y,over:p,setNodeRef:v,setActivatorNodeRef:I,transform:T}}function kb(){return h.useContext($c)}const Lb="Droppable",Ab={timeout:25};function Db(e){let{data:t,disabled:n=!1,id:s,resizeObserverConfig:r}=e;const i=Ys(Lb),{active:o,dispatch:l,over:c,measureDroppableContainers:d}=h.useContext(Vr),u=h.useRef({disabled:n}),f=h.useRef(!1),p=h.useRef(null),x=h.useRef(null),{disabled:b,updateMeasurementsFor:m,timeout:g}={...Ab,...r},T=Os(m??s),y=h.useCallback(()=>{if(!f.current){f.current=!0;return}x.current!=null&&clearTimeout(x.current),x.current=setTimeout(()=>{d(Array.isArray(T.current)?T.current:[T.current]),x.current=null},g)},[g]),v=$r({callback:y,disabled:b||!o}),S=h.useCallback((_,j)=>{v&&(j&&(v.unobserve(j),f.current=!1),_&&v.observe(_))},[v]),[I,k]=br(S),C=Os(t);return h.useEffect(()=>{!v||!I.current||(v.disconnect(),f.current=!1,v.observe(I.current))},[I,v]),h.useEffect(()=>(l({type:ke.RegisterDroppable,element:{id:s,key:i,disabled:n,node:I,rect:p,data:C}}),()=>l({type:ke.UnregisterDroppable,key:i,id:s})),[s]),h.useEffect(()=>{n!==u.current.disabled&&(l({type:ke.SetDroppableDisabled,id:s,key:i,disabled:n}),u.current.disabled=n)},[s,i,n,l]),{active:o,rect:p,isOver:c?.id===s,node:I,over:c,setNodeRef:k}}function gn(e,t,n){const s=e.slice();return s.splice(n<0?s.length+n:n,0,s.splice(t,1)[0]),s}function Rb(e,t){return e.reduce((n,s,r)=>{const i=t.get(s);return i&&(n[r]=i),n},Array(e.length))}function nr(e){return e!==null&&e>=0}function Mb(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ob(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Gc=e=>{let{rects:t,activeIndex:n,overIndex:s,index:r}=e;const i=gn(t,s,n),o=t[r],l=i[r];return!l||!o?null:{x:l.left-o.left,y:l.top-o.top,scaleX:l.width/o.width,scaleY:l.height/o.height}},sr={scaleX:1,scaleY:1},ps=e=>{var t;let{activeIndex:n,activeNodeRect:s,index:r,rects:i,overIndex:o}=e;const l=(t=i[n])!=null?t:s;if(!l)return null;if(r===n){const d=i[o];return d?{x:0,y:n<o?d.top+d.height-(l.top+l.height):d.top-l.top,...sr}:null}const c=Pb(i,r,n);return r>n&&r<=o?{x:0,y:-l.height-c,...sr}:r<n&&r>=o?{x:0,y:l.height+c,...sr}:{x:0,y:0,...sr}};function Pb(e,t,n){const s=e[t],r=e[t-1],i=e[t+1];return s?n<t?r?s.top-(r.top+r.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const zc="Sortable",Kc=D.createContext({activeIndex:-1,containerId:zc,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Gc,disabled:{draggable:!1,droppable:!1}});function ms(e){let{children:t,id:n,items:s,strategy:r=Gc,disabled:i=!1}=e;const{active:o,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:u}=kb(),f=Ys(zc,n),p=l.rect!==null,x=h.useMemo(()=>s.map(k=>typeof k=="object"&&"id"in k?k.id:k),[s]),b=o!=null,m=o?x.indexOf(o.id):-1,g=d?x.indexOf(d.id):-1,T=h.useRef(x),y=!Mb(x,T.current),v=g!==-1&&m===-1||y,S=Ob(i);Mt(()=>{y&&b&&u(x)},[y,x,b,u]),h.useEffect(()=>{T.current=x},[x]);const I=h.useMemo(()=>({activeIndex:m,containerId:f,disabled:S,disableTransforms:v,items:x,overIndex:g,useDragOverlay:p,sortedRects:Rb(x,c),strategy:r}),[m,f,S.draggable,S.droppable,v,x,g,c,p,r]);return D.createElement(Kc.Provider,{value:I},t)}const Fb=e=>{let{id:t,items:n,activeIndex:s,overIndex:r}=e;return gn(n,s,r).indexOf(t)},Ub=e=>{let{containerId:t,isSorting:n,wasDragging:s,index:r,items:i,newIndex:o,previousItems:l,previousContainerId:c,transition:d}=e;return!d||!s||l!==i&&r===o?!1:n?!0:o!==r&&t===c},Bb={duration:200,easing:"ease"},Xc="transform",$b=Ot.Transition.toString({property:Xc,duration:0,easing:"linear"}),Vb={roleDescription:"sortable"};function Gb(e){let{disabled:t,index:n,node:s,rect:r}=e;const[i,o]=h.useState(null),l=h.useRef(n);return Mt(()=>{if(!t&&n!==l.current&&s.current){const c=r.current;if(c){const d=hs(s.current,{ignoreTransform:!0}),u={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(u.x||u.y)&&o(u)}}n!==l.current&&(l.current=n)},[t,n,s,r]),h.useEffect(()=>{i&&o(null)},[i]),i}function vn(e){let{animateLayoutChanges:t=Ub,attributes:n,disabled:s,data:r,getNewIndex:i=Fb,id:o,strategy:l,resizeObserverConfig:c,transition:d=Bb}=e;const{items:u,containerId:f,activeIndex:p,disabled:x,disableTransforms:b,sortedRects:m,overIndex:g,useDragOverlay:T,strategy:y}=h.useContext(Kc),v=zb(s,x),S=u.indexOf(o),I=h.useMemo(()=>({sortable:{containerId:f,index:S,items:u},...r}),[f,r,S,u]),k=h.useMemo(()=>u.slice(u.indexOf(o)),[u,o]),{rect:C,node:_,isOver:j,setNodeRef:R}=Db({id:o,data:I,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:k,...c}}),{active:L,activatorEvent:X,activeNodeRect:P,attributes:F,setNodeRef:Q,listeners:J,isDragging:te,over:je,setActivatorNodeRef:me,transform:qe}=Sb({id:o,data:I,attributes:{...Vb,...n},disabled:v.draggable}),Ye=um(R,Q),he=!!L,De=he&&!b&&nr(p)&&nr(g),Se=!T&&te,Re=Se&&De?qe:null,V=De?Re??(l??y)({rects:m,activeNodeRect:P,activeIndex:p,overIndex:g,index:S}):null,Y=nr(p)&&nr(g)?i({id:o,items:u,activeIndex:p,overIndex:g}):S,oe=L?.id,B=h.useRef({activeId:oe,items:u,newIndex:Y,containerId:f}),W=u!==B.current.items,H=t({active:L,containerId:f,isDragging:te,isSorting:he,id:o,index:S,items:u,newIndex:B.current.newIndex,previousItems:B.current.items,previousContainerId:B.current.containerId,transition:d,wasDragging:B.current.activeId!=null}),q=Gb({disabled:!H,index:S,node:_,rect:C});return h.useEffect(()=>{he&&B.current.newIndex!==Y&&(B.current.newIndex=Y),f!==B.current.containerId&&(B.current.containerId=f),u!==B.current.items&&(B.current.items=u)},[he,Y,f,u]),h.useEffect(()=>{if(oe===B.current.activeId)return;if(oe&&!B.current.activeId){B.current.activeId=oe;return}const fe=setTimeout(()=>{B.current.activeId=oe},50);return()=>clearTimeout(fe)},[oe]),{active:L,activeIndex:p,attributes:F,data:I,rect:C,index:S,newIndex:Y,items:u,isOver:j,isSorting:he,isDragging:te,listeners:J,node:_,overIndex:g,over:je,setNodeRef:Ye,setActivatorNodeRef:me,setDroppableNodeRef:R,setDraggableNodeRef:Q,transform:q??V,transition:Z()};function Z(){if(q||W&&B.current.newIndex===S)return $b;if(!(Se&&!mi(X)||!d)&&(he||H))return Ot.Transition.toString({...d,property:Xc})}}function zb(e,t){var n,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e?.draggable)!=null?n:t.draggable,droppable:(s=e?.droppable)!=null?s:t.droppable}}ne.Down,ne.Right,ne.Up,ne.Left;const Kb=({table:e})=>{const{updateTable:t,updateTablesState:n,removeTable:s,createIndex:r,createField:i,createTable:o,schemas:l,databaseType:c,readonly:d}=se(),{schemasDisplayed:u}=Ir(),{openTableSchemaDialog:f}=Jn(),{t:p}=ie(),{focusOnTable:x}=Rr(),[b,m]=D.useState(!1),[g,T]=D.useState(e.name),y=D.useRef(null),{listeners:v}=vn({id:e.id}),S=h.useCallback(()=>{b&&(g.trim()&&t(e.id,{name:g.trim()}),m(!1))},[g,e.id,t,b]),I=h.useCallback(()=>{m(!1),T(e.name)},[e.name]);zs(y,S),cn("Enter",S),cn("Escape",I);const k=F=>{F.stopPropagation(),m(!0)},C=h.useCallback(F=>{F.stopPropagation(),x(e.id)},[x,e.id]),_=h.useCallback(()=>{s(e.id)},[e.id,s]),j=h.useCallback(({schema:F})=>{n(Q=>Q.map(J=>J.id===e.id||!J.schema?{...J,schema:F.name}:J))},[e.id,n]),R=h.useCallback(()=>{f({table:e,schemas:l,onConfirm:j,allowSchemaCreation:!0})},[f,e,l,j]),L=h.useCallback(F=>{F.stopPropagation();const Q=ch(e);Q.name=`${Q.name}_copy`,Q.x+=30,Q.y+=50,o(Q)},[o,e]),X=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-fit min-w-40",children:[a.jsx(Zn,{children:p("side_panel.tables_section.table.table_actions.title")}),a.jsx(At,{}),l.length>0||wn?.[c]?a.jsxs(a.Fragment,{children:[a.jsx(Dt,{children:a.jsxs(it,{className:"flex justify-between gap-4",onClick:F=>{F.stopPropagation(),R()},children:[p("side_panel.tables_section.table.table_actions.change_schema"),a.jsx(jr,{className:"size-3.5"})]})}),a.jsx(At,{})]}):null,a.jsxs(Dt,{children:[a.jsxs(it,{className:"flex justify-between gap-4",onClick:F=>{F.stopPropagation(),i(e.id)},children:[p("side_panel.tables_section.table.table_actions.add_field"),a.jsx(Sa,{className:"size-3.5"})]}),e.isView?null:a.jsxs(it,{className:"flex justify-between gap-4",onClick:F=>{F.stopPropagation(),r(e.id)},children:[p("side_panel.tables_section.table.table_actions.add_index"),a.jsx(Aa,{className:"size-3.5"})]})]}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:L,className:"flex justify-between",children:[p("side_panel.tables_section.table.table_actions.duplicate_table"),a.jsx(kh,{className:"size-3.5"})]})}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:_,className:"flex justify-between !text-red-700",children:[p("side_panel.tables_section.table.table_actions.delete_table"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})})]})]}),[e.id,e.isView,i,r,_,L,p,R,l.length,c]),P=h.useMemo(()=>{if(u.length>1)return e.schema??wn[c]},[e.schema,u.length,c]);return h.useEffect(()=>{e.name.trim()&&T(e.name.trim())},[e.name]),a.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[d?null:a.jsx("div",{className:"flex cursor-move items-center justify-center",...v,children:a.jsx(ts,{className:"size-4 text-muted-foreground"})}),a.jsx("div",{className:"flex min-w-0 flex-1 px-1",children:b?a.jsx(Ie,{ref:y,autoFocus:!0,type:"text",placeholder:e.name,value:g,onClick:F=>F.stopPropagation(),onChange:F=>T(F.target.value),className:"h-7 w-full focus-visible:ring-0"}):d?a.jsxs("div",{className:"truncate px-2 py-0.5",children:[e.name,a.jsx("span",{className:"text-xs text-muted-foreground",children:P?` (${P})`:""})]}):a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsxs("div",{onDoubleClick:k,className:"text-editable truncate px-2 py-0.5",children:[e.name,a.jsx("span",{className:"text-xs text-muted-foreground",children:P?` (${P})`:""})]})}),a.jsx(Te,{children:p("tool_tips.double_click_to_edit")})]})}),a.jsx("div",{className:"flex flex-row-reverse items-center",children:b?a.jsx(Ae,{onClick:S,children:a.jsx(Dn,{})}):a.jsxs(a.Fragment,{children:[d?null:a.jsx("div",{children:X()}),e.isView?a.jsx("span",{className:"rounded bg-muted px-1.5 py-0 text-[10px] font-medium text-muted-foreground",children:"View"}):null,a.jsxs("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:[d?null:a.jsx(Ae,{onClick:k,children:a.jsx(ns,{})}),a.jsx(Ae,{onClick:C,children:a.jsx(Ks,{})})]})]})})]})},za=D.forwardRef(({className:e,...t},n)=>a.jsx(Mr,{...t,ref:n,variant:"default",className:M("h-8 w-[32px] p-2 text-xs text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200","data-[state=on]:text-orange-600 dark:data-[state=on]:text-orange-400",e)}));za.displayName=Mr.displayName;const Gr=D.forwardRef(({className:e,...t},n)=>a.jsx("textarea",{className:M("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));Gr.displayName="Textarea";const Xb=({field:e,table:t,databaseType:n,updateField:s,removeField:r,open:i,onOpenChange:o})=>{const{readonly:l}=se(),{t:c}=ie(),[d,u]=D.useState(e),[f,p]=D.useState(!1),x=h.useMemo(()=>i??f,[i,f]),b=h.useCallback(_=>{o?o(_):p(_)},[o,p]),m=D.useMemo(()=>{if(!e.primaryKey)return!1;for(const _ of t.fields)if(_.id!==e.id&&_.primaryKey)return!1;return!0},[t.fields,e.primaryKey,e.id]);h.useEffect(()=>{u(e)},[e]);const g=h.useCallback(_=>{s(_)},[s]),T=mf(g,200),y=h.useRef(e);h.useEffect(()=>{x&&!kf(y.current,d)&&T({comments:d.comments,characterMaximumLength:d.characterMaximumLength,precision:d.precision,scale:d.scale,unique:d.unique,default:d.default,increment:d.increment,isArray:d.isArray}),y.current=d},[d,T,x]);const v=h.useMemo(()=>Xi(e.type.id,n),[e.type.id,n]),S=h.useMemo(()=>dh(e.type.name),[e.type.name]),I=h.useMemo(()=>uh(e.type.name,n),[e.type.name,n]),k=h.useMemo(()=>hh(e.type.name)&&!d.nullable,[e.type.name,d.nullable]),C=h.useMemo(()=>d.nullable||l||k,[d.nullable,l,k]);return a.jsxs(Sr,{open:x,onOpenChange:_=>{b(_),_&&u(e)},children:[a.jsx(kr,{asChild:!0,children:a.jsx(K,{variant:"ghost",className:"h-8 w-[32px] p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:a.jsx(ri,{className:"size-3.5"})})}),a.jsx(Lr,{className:"w-52",children:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-sm font-semibold",children:c("side_panel.tables_section.table.field_actions.title")}),a.jsx(Rt,{orientation:"horizontal"}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.unique")}),a.jsx(ir,{checked:d.unique,disabled:m||l,onCheckedChange:_=>u(j=>({...j,unique:!!_}))})]}),S?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Je,{htmlFor:"increment",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.auto_increment")}),a.jsx(ir,{checked:k?!0:d.increment??!1,disabled:C,onCheckedChange:_=>u(j=>({...j,increment:!!_}))})]}):null,I?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(Je,{htmlFor:"isArray",className:"text-subtitle",children:"Array"}),a.jsx(ir,{checked:d.isArray??!1,disabled:l,onCheckedChange:_=>u(j=>({...j,isArray:!!_}))})]}):null,a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"default",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.default_value")}),a.jsx(Ie,{value:d.default??"",onChange:_=>u(j=>({...j,default:_.target.value||null})),placeholder:c("side_panel.tables_section.table.field_actions.no_default"),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}),v?.fieldAttributes?.hasCharMaxLength?a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.character_length")}),v?.fieldAttributes?.hasCharMaxLengthOption?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(Xs,{value:d.characterMaximumLength==="max"?"max":d.characterMaximumLength?"custom":"none",onValueChange:_=>{u(_==="max"?j=>({...j,characterMaximumLength:"max"}):_==="custom"?j=>({...j,characterMaximumLength:"255"}):j=>({...j,characterMaximumLength:null}))},disabled:l,children:[a.jsx(as,{className:"w-full bg-muted",children:a.jsx(Ws,{placeholder:"Select length"})}),a.jsxs(is,{children:[a.jsx(Ke,{value:"none",children:"No length"}),a.jsx(Ke,{value:"max",children:"MAX"}),a.jsx(Ke,{value:"custom",children:"Custom"})]})]}),d.characterMaximumLength&&d.characterMaximumLength!=="max"?a.jsx(Ie,{value:d.characterMaximumLength,type:"number",min:"1",max:v?.fieldAttributes?.maxLength||void 0,onChange:_=>u(j=>({...j,characterMaximumLength:_.target.value})),className:"w-24 rounded-md bg-muted text-sm",readOnly:l}):null]}):a.jsx(Ie,{value:d.characterMaximumLength??"",type:"number",onChange:_=>u(j=>({...j,characterMaximumLength:_.target.value})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}):null,v?.fieldAttributes?.precision||v?.fieldAttributes?.scale?a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.precision")}),a.jsx(Ie,{value:d.precision??"",type:"number",max:v?.fieldAttributes?.precision?(v?.fieldAttributes?.precision).max:void 0,min:v?.fieldAttributes?.precision?(v?.fieldAttributes?.precision).min:void 0,placeholder:v?.fieldAttributes?.precision?`${(v?.fieldAttributes?.precision).default}`:"Optional",onChange:_=>u(j=>({...j,precision:_.target.value?parseInt(_.target.value):void 0})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]}),a.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.scale")}),a.jsx(Ie,{value:d.scale??"",max:v?.fieldAttributes?.scale?(v?.fieldAttributes?.scale).max:void 0,min:v?.fieldAttributes?.scale?(Xi(e.type.id)?.fieldAttributes?.scale).min:void 0,placeholder:v?.fieldAttributes?.scale?`${(v?.fieldAttributes?.scale).default}`:"Optional",type:"number",onChange:_=>u(j=>({...j,scale:_.target.value?parseInt(_.target.value):void 0})),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]})]}):null,a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:c("side_panel.tables_section.table.field_actions.comments")}),a.jsx(Gr,{value:d.comments??void 0,onChange:_=>u(j=>({...j,comments:_.target.value})),placeholder:c("side_panel.tables_section.table.field_actions.no_comments"),className:"w-full rounded-md bg-muted text-sm",readOnly:l})]})]}),l?null:a.jsxs(a.Fragment,{children:[a.jsx(Rt,{orientation:"horizontal"}),a.jsxs(K,{variant:"outline",className:"flex gap-2 !text-red-700",onClick:r,children:[a.jsx(bt,{className:"size-3.5 text-red-700"}),c("side_panel.tables_section.table.field_actions.delete_field")]})]})]})})]})},Wb=({table:e,field:t,updateField:n,removeField:s,databaseType:r,readonly:i=!1})=>{const{t:o}=ie(),{attributes:l,listeners:c,setNodeRef:d,transform:u,transition:f}=vn({id:t.id}),{dataFieldOptions:p,handleDataTypeChange:x,handlePrimaryKeyToggle:b,handleNullableToggle:m,handleNameChange:g,generateFieldSuffix:T,fieldName:y,nullable:v,primaryKey:S}=Lf(e,t,n),I={transform:Ot.Translate.toString(u),transition:f},k=fh(t.type.name),[C,_]=h.useState(!1),j=h.useCallback(()=>{_(!0)},[]);return a.jsxs("div",{className:"flex flex-1 touch-none flex-row justify-between gap-2 p-1",ref:d,style:I,...l,children:[a.jsxs("div",{className:"flex flex-1 items-center justify-start gap-1 overflow-hidden",children:[i?null:a.jsx("div",{className:"flex w-4 shrink-0 cursor-move items-center justify-center",...c,children:a.jsx(ts,{className:"size-3.5  text-muted-foreground"})}),a.jsxs("span",{className:"relative min-w-0 flex-1",children:[a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx(Ie,{className:"h-8 w-full !truncate focus-visible:ring-0",type:"text",placeholder:o("side_panel.tables_section.table.field_name"),value:y,onChange:R=>g(R.target.value),readOnly:i})}),a.jsx(Te,{children:t.name})]}),t.comments?a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("div",{className:"absolute right-0 top-0 h-full w-[10px] cursor-pointer",onClick:j,children:a.jsx("div",{className:"pointer-events-none absolute right-0 top-0 size-0 border-l-[10px] border-t-[10px] border-l-transparent border-t-pink-500"})})}),a.jsx(Te,{className:"max-w-xs",children:a.jsxs("div",{children:[a.jsx("div",{className:"font-normal text-white/70 dark:text-black/70",children:"Comment:"}),a.jsx("div",{className:"whitespace-pre-wrap break-words",children:t.comments})]})})]}):null]}),a.jsxs(Ee,{children:[a.jsx(_e,{className:"flex h-8 min-w-0 flex-1",asChild:!0,children:a.jsx("span",{children:a.jsx(ai,{className:"flex h-8 min-h-8 w-full",popoverClassName:"min-w-[350px]",options:p,placeholder:o("side_panel.tables_section.table.field_type"),value:t.type.id,valueSuffix:ph(t,{databaseType:r}),optionSuffix:R=>T(R.value),onChange:x,emptyPlaceholder:o("side_panel.tables_section.table.no_types_found"),readonly:i,modal:!1})})}),a.jsxs(Te,{children:[t.type.name,t.characterMaximumLength?`(${t.characterMaximumLength})`:""]})]})]}),a.jsxs("div",{className:"flex shrink-0 items-center justify-end gap-1",children:[a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:a.jsx(za,{pressed:v,onPressedChange:m,disabled:i||k||S,children:"N"})})}),a.jsx(Te,{children:v?"Null":"Not Null"})]}),a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:a.jsx(za,{pressed:S,onPressedChange:b,disabled:i,children:a.jsx(Dl,{className:"h-3.5"})})})}),a.jsx(Te,{children:o("side_panel.tables_section.table.primary_key")})]}),a.jsx(Xb,{field:t,table:e,updateField:n,removeField:s,databaseType:r,open:C,onOpenChange:_})]})]})},Ka=D.forwardRef((e,t)=>a.jsx(Mr,{...e,ref:t,variant:"default",className:"h-8 w-[32px] p-2 text-xs text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"}));Ka.displayName=Mr.displayName;const Hb=({options:e,value:t,label:n,onChange:s,readonly:r,t:i})=>a.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"indexType",className:"text-subtitle",children:i("side_panel.tables_section.table.index_actions.index_type")}),a.jsxs(Sr,{children:[a.jsx(kr,{asChild:!0,children:a.jsxs(K,{variant:"outline",className:"w-full justify-between font-normal",disabled:r,children:[n,a.jsx(Kf,{className:"ml-2 size-4 shrink-0 opacity-50"})]})}),a.jsx(Lr,{className:"w-[180px] p-1",children:a.jsx("div",{className:"flex flex-col",children:e.map(o=>a.jsx(qb,{option:o,isSelected:t===o.value,onSelect:()=>{o.disabled||s(o.value)}},o.value))})})]})]}),qb=({option:e,isSelected:t,onSelect:n})=>{const s=a.jsxs("div",{className:M("flex cursor-pointer items-center rounded-sm px-2 py-1.5 text-sm",e.disabled?"cursor-not-allowed opacity-50":"hover:bg-accent",t&&"bg-accent"),onClick:n,children:[a.jsx(Dn,{className:M("mr-2 h-4 w-4",t?"opacity-100":"opacity-0")}),e.label]});return e.disabled&&e.disabledTooltip?a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:s}),a.jsx(Te,{side:"right",children:e.disabledTooltip})]}):s},Yb=({fields:e,index:t,updateIndex:n,removeIndex:s})=>{const{t:r}=ie(),{databaseType:i,readonly:o}=se(),l=h.useMemo(()=>e.map(g=>({label:g.name,value:g.id})),[e]),c=h.useMemo(()=>e.filter(g=>t.fieldIds.includes(g.id)),[e,t.fieldIds]),d=h.useMemo(()=>Wi(c),[c]),u=bh[i],f=h.useMemo(()=>u?mh.filter(g=>u.includes(g.value)).map(g=>({...g,disabled:g.value==="gin"&&!d})):[],[u,d]),p=h.useCallback(g=>{const T=Array.isArray(g)?g:[g];if(t.type==="hash"&&T.length>0){n({fieldIds:[T[T.length-1]]});return}const y=e.filter(S=>T.includes(S.id)),v=Wi(y);t.type==="gin"&&!v?n({fieldIds:T,type:"btree"}):n({fieldIds:T})},[t.type,n,e]),x=h.useCallback(g=>{g==="hash"&&t.fieldIds.length>1?n({type:g,fieldIds:[t.fieldIds[0]]}):n({type:g})},[n,t.fieldIds]),b=t.type||"btree",m=f.find(g=>g.value===b)?.label||"Select type";return a.jsxs("div",{className:"flex flex-1 flex-row justify-between gap-2 p-1",children:[a.jsx(ai,{className:"flex h-8 min-h-8 min-w-0 flex-1",multiple:!0,oneLine:!0,options:l,placeholder:r("side_panel.tables_section.table.index_select_fields"),value:t.fieldIds,onChange:p,emptyPlaceholder:r("side_panel.tables_section.table.no_types_found"),keepOrder:!0,disabled:t.isPrimaryKey??!1,readonly:o,modal:!1}),a.jsxs("div",{className:"flex shrink-0 gap-1",children:[t.isPrimaryKey?a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:a.jsx(Ka,{pressed:!0,disabled:!0,children:a.jsx(Dl,{className:"h-3.5"})})})}),a.jsx(Te,{children:r("side_panel.tables_section.table.primary_key")})]}):a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:a.jsx(Ka,{pressed:t.unique,onPressedChange:g=>n({unique:!!g}),disabled:o,children:"U"})})}),a.jsx(Te,{children:r("side_panel.tables_section.table.index_actions.unique")})]}),t.isPrimaryKey?a.jsx("div",{className:"h-8 w-[32px]"}):a.jsxs(Sr,{children:[a.jsx(kr,{asChild:!0,children:a.jsx(K,{variant:"ghost",className:"h-8 w-[32px] p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:a.jsx(ri,{className:"size-3.5"})})}),a.jsx(Lr,{className:"w-52",children:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-sm font-semibold",children:r("side_panel.tables_section.table.index_actions.title")}),a.jsx(Rt,{orientation:"horizontal"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:r("side_panel.tables_section.table.index_actions.name")}),a.jsx(Ie,{value:t.name,onChange:g=>n({name:g.target.value}),readOnly:o})]}),a.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[a.jsx(Je,{htmlFor:"width",className:"text-subtitle",children:r("side_panel.tables_section.table.index_actions.unique")}),a.jsx(ir,{checked:t.unique,onCheckedChange:g=>n({unique:!!g}),disabled:o})]}),f.length>0&&a.jsx(Hb,{options:f,value:b,label:m,onChange:x,readonly:o,t:r}),!o&&a.jsxs(a.Fragment,{children:[a.jsx(Rt,{orientation:"horizontal"}),a.jsxs(K,{variant:"outline",className:"flex gap-2 !text-red-700",onClick:s,children:[a.jsx(bt,{className:"size-3.5 text-red-700"}),r("side_panel.tables_section.table.index_actions.delete_index")]})]})]})})]})]})]})},Qb=({constraint:e,updateConstraint:t,removeConstraint:n})=>{const{t:s}=ie(),{readonly:r}=se(),i=h.useMemo(()=>!e.expression||!e.expression.trim()?{isValid:!0}:bf(e.expression),[e.expression]),o=!i.isValid;return a.jsxs("div",{className:"flex flex-1 flex-row items-center justify-between gap-1 py-0.5",children:[a.jsxs("div",{className:`flex h-8 min-w-0 flex-1 items-center gap-1.5 rounded-md border bg-slate-50 px-2.5 dark:bg-slate-900 ${o?"border-red-300 dark:border-red-700":"border-input"}`,children:[o&&a.jsx(pr,{className:"size-3 shrink-0 text-red-500"}),a.jsx("code",{className:`min-w-0 flex-1 truncate font-mono text-xs ${o?"text-red-600 dark:text-red-400":"text-slate-700 dark:text-slate-300"}`,children:e.expression||a.jsx("span",{className:"italic text-slate-400 dark:text-slate-500",children:"empty"})})]}),a.jsx("div",{className:"flex shrink-0",children:a.jsxs(Sr,{children:[a.jsx(kr,{asChild:!0,children:a.jsx(K,{variant:"ghost",className:"size-8 p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:a.jsx(ri,{className:"size-3.5"})})}),a.jsx(Lr,{className:"w-72",children:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-sm font-semibold",children:s("side_panel.tables_section.table.check_constraint_actions.title")}),a.jsx(Rt,{orientation:"horizontal"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx(Je,{htmlFor:"constraint-expression",className:"text-subtitle",children:s("side_panel.tables_section.table.check_constraint_actions.expression")}),a.jsx(Gr,{id:"constraint-expression",value:e.expression,onChange:l=>t({expression:l.target.value}),readOnly:r,className:`min-h-[60px] font-mono text-xs ${o?"border-red-500 focus-visible:ring-red-500":""}`,placeholder:"e.g., price > 0"}),o&&i.error&&a.jsxs("div",{className:"flex items-start gap-1.5 text-xs text-red-600 dark:text-red-400",children:[a.jsx(pr,{className:"mt-0.5 size-3 shrink-0"}),a.jsx("span",{children:i.error})]})]}),r?null:a.jsxs(a.Fragment,{children:[a.jsx(Rt,{orientation:"horizontal"}),a.jsxs(K,{variant:"outline",className:"flex gap-2 !text-red-700",onClick:n,children:[a.jsx(bt,{className:"size-3.5 text-red-700"}),s("side_panel.tables_section.table.check_constraint_actions.delete")]})]})]})})]})})]})},Jb=({table:e})=>{const{updateField:t,removeField:n,createField:s,createIndex:r,removeIndex:i,updateIndex:o,createCheckConstraint:l,removeCheckConstraint:c,updateCheckConstraint:d,updateTable:u,readonly:f,databaseType:p}=se(),{t:x}=ie(),{color:b}=e,[m,g]=D.useState(["fields"]),T=ds(cs(xn)),y=h.useCallback((C,_)=>{if(t(e.id,C,_),_.primaryKey===!1){const j=e.fields.filter(R=>R.id!==C&&R.primaryKey);j.length===1&&t(e.id,j[0].id,{unique:!0},{updateHistory:!1})}},[e.id,e.fields,t]),v=C=>{const{active:_,over:j}=C;if(_?.id!==j?.id&&j&&_){const R=e.fields,L=R.findIndex(P=>P.id===_.id),X=R.findIndex(P=>P.id===j.id);u(e.id,{fields:gn(R,L,X)})}},S=h.useCallback(C=>{C.stopPropagation(),g(_=>_.includes("indexes")?_:[..._,"indexes"]),r(e.id)},[r,e.id,g]),I=h.useCallback(C=>{C.stopPropagation(),s(e.id)},[s,e.id]),k=h.useCallback(C=>{C.stopPropagation(),g(_=>_.includes("checks")?_:[..._,"checks"]),l(e.id)},[l,e.id,g]);return a.jsxs("div",{className:"flex flex-col gap-1 rounded-b-md border-l-[6px] px-1",style:{borderColor:b},children:[a.jsxs(Dr,{type:"multiple",className:"w-full",value:m,onValueChange:C=>g(C),children:[a.jsxs(rn,{value:"fields",className:"mb-2 border-y-0",children:[a.jsx(an,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:a.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Sa,{className:"size-4"}),x("side_panel.tables_section.table.fields")]}),f?null:a.jsx("div",{className:"flex flex-row-reverse",children:a.jsx("div",{className:"hidden flex-row-reverse group-hover:flex",children:a.jsx(K,{variant:"ghost",className:"size-4 p-0 text-xs hover:bg-primary-foreground",onClick:I,children:a.jsx(Lt,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})})})})]})}),a.jsx(on,{className:"flex flex-col pb-0 pt-1",children:a.jsxs(fs,{sensors:T,collisionDetection:us,onDragEnd:v,children:[a.jsx(ms,{items:e.fields,strategy:ps,children:e.fields.map(C=>a.jsx(Wb,{field:C,table:e,updateField:_=>y(C.id,_),removeField:()=>n(e.id,C.id),databaseType:p,readonly:f},C.id))}),f?null:a.jsx("div",{className:"flex justify-start p-1",children:a.jsxs(K,{variant:"ghost",className:"flex h-7 items-center gap-1 px-2 text-xs",onClick:I,children:[a.jsx(Lt,{className:"size-4 text-muted-foreground"}),x("side_panel.tables_section.table.add_field")]})})]})})]}),e.isView?null:a.jsxs(rn,{value:"indexes",className:"mb-2 border-y-0",children:[a.jsx(an,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:a.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Aa,{className:"size-4"}),x("side_panel.tables_section.table.indexes")]}),f?null:a.jsx("div",{className:"flex flex-row-reverse",children:a.jsx("div",{className:"hidden flex-row-reverse group-hover:flex",children:a.jsx(K,{variant:"ghost",className:"size-4 p-0 text-xs hover:bg-primary-foreground",onClick:S,children:a.jsx(Lt,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})})})})]})}),a.jsxs(on,{className:"pb-0 pt-1",children:[[...e.indexes].sort((C,_)=>C.isPrimaryKey&&!_.isPrimaryKey?-1:!C.isPrimaryKey&&_.isPrimaryKey?1:0).map(C=>a.jsx(Yb,{index:C,removeIndex:()=>i(e.id,C.id),updateIndex:_=>o(e.id,C.id,_),fields:e.fields},C.id)),f?null:a.jsx("div",{className:"flex justify-start p-1",children:a.jsxs(K,{variant:"ghost",className:"flex h-7 items-center gap-1 px-2 text-xs",onClick:S,children:[a.jsx(Lt,{className:"size-4 text-muted-foreground"}),x("side_panel.tables_section.table.add_index")]})})]})]}),a.jsxs(rn,{value:"checks",className:"mb-2 border-y-0",children:[a.jsx(an,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:a.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(sp,{className:"size-4"}),x("side_panel.tables_section.table.check_constraints")]}),f?null:a.jsx("div",{className:"flex flex-row-reverse",children:a.jsx("div",{className:"hidden flex-row-reverse group-hover:flex",children:a.jsx(K,{variant:"ghost",className:"size-4 p-0 text-xs hover:bg-primary-foreground",onClick:k,children:a.jsx(Lt,{className:"size-4 shrink-0 text-muted-foreground transition-transform duration-200"})})})})]})}),a.jsxs(on,{className:"pb-0 pt-1",children:[a.jsx("div",{className:"flex flex-col gap-1",children:(e.checkConstraints??[]).map(C=>a.jsx(Qb,{constraint:C,removeConstraint:()=>c(e.id,C.id),updateConstraint:_=>d(e.id,C.id,_)},C.id))}),f?null:a.jsx("div",{className:"flex justify-start p-1",children:a.jsxs(K,{variant:"ghost",className:"flex h-7 items-center gap-1 px-2 text-xs",onClick:k,children:[a.jsx(Lt,{className:"size-4 text-muted-foreground"}),x("side_panel.tables_section.table.add_check")]})})]})]}),a.jsxs(rn,{value:"comments",className:"border-y-0",children:[a.jsx(an,{iconPosition:"right",className:"group flex flex-1 p-0 px-2 py-1 text-xs text-subtitle hover:bg-secondary",asChild:!0,children:a.jsx("div",{className:"flex flex-1 items-center justify-between",children:a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Af,{className:"size-4"}),x("side_panel.tables_section.table.comments")]})})}),a.jsx(on,{className:"pb-0 pt-1",children:a.jsx(Gr,{value:e.comments??void 0,onChange:C=>u(e.id,{comments:C.target.value}),placeholder:x("side_panel.tables_section.table.no_comments"),className:"w-full rounded-md bg-muted text-sm focus-visible:ring-0",readOnly:f})})]})]}),f?null:a.jsx(Rt,{className:""}),a.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[!e.isView&&!f?a.jsx(li,{color:b,onChange:C=>u(e.id,{color:C})}):a.jsx("div",{}),f?null:a.jsxs("div",{className:"flex gap-1",children:[e.isView?null:a.jsxs(K,{variant:"outline",className:"h-8 p-2 text-xs",onClick:S,children:[a.jsx(Aa,{className:"h-4"}),x("side_panel.tables_section.table.add_index")]}),a.jsxs(K,{variant:"outline",className:"h-8 p-2 text-xs",onClick:I,children:[a.jsx(Sa,{className:"h-4"}),x("side_panel.tables_section.table.add_field")]})]})]})]})},Wc=D.forwardRef(({table:e},t)=>{const{attributes:n,setNodeRef:s,transform:r,transition:i}=vn({id:e.id}),o={transform:Ot.Translate.toString(r),transition:i};return a.jsx(rn,{value:e.id,className:"border-none",ref:t,children:a.jsxs("div",{className:"w-full rounded-md border-b",ref:s,style:o,...n,children:[a.jsx(an,{className:"w-full rounded-md border-l-[6px] px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",style:{borderColor:e.color},asChild:!0,children:a.jsx(Kb,{table:e})}),a.jsx(on,{children:a.jsx(Jb,{table:e})})]})})});Wc.displayName="TableListItem";const Zb=({tables:e})=>{const{updateTablesState:t}=se(),{openTableFromSidebar:n,openedTableInSidebar:s}=et(),r=D.useRef(null),i=h.useMemo(()=>e.reduce((u,f)=>(u[f.id]=D.createRef(),u),{}),[e]),o=h.useCallback(u=>i[u]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[i]),l=ds(cs(xn)),c=u=>{const{active:f,over:p}=u;if(f?.id!==p?.id&&p&&f){const x=e.findIndex(g=>g.id===f.id),b=e.findIndex(g=>g.id===p.id),m=gn(e,x,b).reduce((g,T,y)=>(g.set(T.id,y),g),new Map);t(g=>g.map(T=>({id:T.id,order:m.get(T.id)})))}},d=h.useCallback(()=>{s&&r.current!==s&&(r.current=s,o(s))},[o,s]);return a.jsx(Dr,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:s,onValueChange:n,onAnimationEnd:d,children:a.jsx(fs,{sensors:l,collisionDetection:us,onDragEnd:c,children:a.jsx(ms,{items:e,strategy:ps,children:e.sort((u,f)=>u.order&&f.order===void 0?-1:u.order===void 0&&f.order?1:u.order!==void 0&&f.order!==void 0?(u.order??0)-(f.order??0):u.isView===f.isView?u.name.localeCompare(f.name):u.isView?1:-1).map(u=>a.jsx(Wc,{table:u,ref:i[u.id]},u.id))})})})},ex=""+new URL("empty_state-FM0xVkGj.png",import.meta.url).href,tx=""+new URL("empty_state_dark-CGFOiUtp.png",import.meta.url).href;function nx({className:e,...t}){return a.jsx("div",{"data-slot":"empty",className:M("flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12",e),...t})}function sx({className:e,...t}){return a.jsx("div",{"data-slot":"empty-header",className:M("flex max-w-sm flex-col items-center gap-2 text-center",e),...t})}const rx=ci("mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0",{variants:{variant:{default:"bg-transparent",icon:"flex size-10 shrink-0 items-center justify-center rounded-lg bg-muted text-foreground [&_svg:not([class*='size-'])]:size-6"}},defaultVariants:{variant:"default"}});function ax({className:e,variant:t="default",...n}){return a.jsx("div",{"data-slot":"empty-icon","data-variant":t,className:M(rx({variant:t,className:e})),...n})}function ix({className:e,...t}){return a.jsx("div",{"data-slot":"empty-title",className:M("text-lg font-medium tracking-tight",e),...t})}function ox({className:e,...t}){return a.jsx("div",{"data-slot":"empty-description",className:M("text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",e),...t})}function Co({className:e,...t}){return a.jsx("div",{"data-slot":"empty-content",className:M("flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm",e),...t})}const bs=h.forwardRef(({title:e,description:t,className:n,titleClassName:s,descriptionClassName:r,imageClassName:i,primaryAction:o,secondaryAction:l,footerAction:c},d)=>{const{effectiveTheme:u}=Or(),f=h.useMemo(()=>!!(o||l),[o,l]),p=h.useMemo(()=>!!c,[c]),x=h.useMemo(()=>u==="dark"?tx:ex,[u]);return a.jsx("div",{ref:d,className:M("flex flex-1 flex-col items-center justify-center space-y-1",n),children:a.jsxs(nx,{children:[a.jsxs(sx,{children:[a.jsx(ax,{variant:"icon",children:a.jsx("img",{src:x,alt:"Empty state",className:M("p-2",i)})}),a.jsx(ix,{className:s,children:e}),a.jsx(ox,{className:r,children:t})]}),f&&a.jsx(Co,{children:a.jsxs("div",{className:"flex gap-2",children:[o&&a.jsxs(K,{onClick:o.onClick,disabled:o.disabled,className:"h-8 font-normal",children:[o.label,o.icon]}),l&&a.jsxs(K,{variant:"outline",onClick:l.onClick,disabled:l.disabled,className:"h-8 font-normal",children:[l.label,l.icon]})]})}),p&&c&&a.jsx(K,{variant:"link",asChild:!!c.href,className:"text-muted-foreground",size:"sm",disabled:c.disabled,onClick:c.href?void 0:c.onClick,children:c.href?a.jsxs("a",{href:c.href,children:[c.label,c.icon]}):a.jsxs("span",{children:[c.label,c.icon]})}),!f&&!p&&a.jsx(Co,{})]})})});bs.displayName="EmptyState";const Hc=D.forwardRef(({className:e,variant:t,size:n,asChild:s=!1,alternatives:r,children:i,onClick:o,dropdownTriggerClassName:l,chevronDownIconClassName:c,...d},u)=>{const f=s?es:"button",p=(r?.length??0)>0;return a.jsxs("div",{className:"inline-flex items-stretch",children:[a.jsx(f,{className:M(La({variant:t,size:n}),{"rounded-r-none":p},e),ref:u,onClick:o,...d,children:i}),p?a.jsxs(hn,{children:[a.jsx(fn,{asChild:!0,children:a.jsx("button",{className:M(La({variant:t,size:n}),"rounded-l-none border-l border-l-primary/5 px-2 min-w-0",e?.includes("h-")&&e.match(/h-\d+/)?.[0],e?.includes("text-")&&e.match(/text-\w+/)?.[0],l),type:"button",children:a.jsx(_l,{className:M("size-4 shrink-0",c)})})}),a.jsx(pn,{align:"end",children:r.map((x,b)=>{const m=a.jsx(it,{onClick:x.onClick,disabled:x.disabled,className:M(x.className),children:a.jsxs("span",{className:"flex w-full items-center justify-between gap-2",children:[x.label,x.icon]})},b);return x.tooltip?a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:m}),a.jsx(Te,{side:"left",children:x.tooltip})]},b):m})})]}):null]})});Hc.displayName="ButtonWithAlternatives";const lx=()=>{const{createTable:e,tables:t,databaseType:n,readonly:s}=se(),{filter:r,schemasDisplayed:i,hasActiveFilter:o,resetFilter:l}=Ir(),{openTableSchemaDialog:c}=Jn(),d=ii(),{t:u}=ie(),{openTableFromSidebar:f}=et(),[p,x]=D.useState(""),{showDBViews:b}=di(),m=D.useRef(null),g=h.useMemo(()=>t.filter(_=>Lh({table:{id:_.id,schema:_.schema},filter:r,options:{defaultSchema:wn[n]}})),[t,r,n]),T=h.useMemo(()=>!o||t.length===0?!1:g.length===0,[o,t.length,g.length]),y=h.useMemo(()=>{const _=R=>!p?.trim?.()||R.name.toLowerCase().includes(p.toLowerCase()),j=R=>b?!0:!R.isView;return g.filter(_).filter(j)},[g,p,b]),v=h.useCallback(()=>{const j=-d.x/d.zoom+80/d.zoom,R=-d.y/d.zoom+80/d.zoom;return{centerX:j,centerY:R}},[d.x,d.y,d.zoom]),S=h.useCallback(async({schema:_})=>{const{centerX:j,centerY:R}=v(),L=await e({x:j,y:R,schema:_?.name});f(L.id)},[e,f,v]),I=h.useCallback(async({schema:_})=>{const{centerX:j,centerY:R}=v(),L=await e({x:j,y:R,schema:_?.name,isView:!0});f(L.id)},[e,f,v]),k=h.useCallback(async({view:_})=>{if(x(""),i.length>1)c({onConfirm:_?I:S,schemas:i});else{const j=i.length===1?i[0]:void 0;_?I({schema:j}):S({schema:j})}},[I,S,i,c,x]),C=h.useCallback(()=>{x("")},[]);return a.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{ref:m,type:"text",placeholder:u("side_panel.tables_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:p,onChange:_=>x(_.target.value)})}),s?null:a.jsxs(Hc,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:()=>k({view:!1}),dropdownTriggerClassName:"px-1",chevronDownIconClassName:"!size-3.5",alternatives:b?[{label:u("side_panel.tables_section.add_view"),onClick:()=>k({view:!0}),icon:a.jsx(Ah,{className:"size-4"}),className:"text-xs"}]:[],children:[a.jsx(Tl,{className:"h-4"}),u("side_panel.tables_section.add_table")]})]}),T&&a.jsxs("div",{className:"mb-2 flex items-center gap-2 rounded-md border bg-muted/50 px-3 py-2",children:[a.jsx(Df,{className:"size-4 text-muted-foreground"}),a.jsx("span",{className:"flex-1 text-xs text-muted-foreground",children:u("side_panel.tables_section.all_hidden")}),a.jsx(K,{variant:"outline",size:"sm",className:"h-6 px-2 text-xs",onClick:()=>l(),children:u("side_panel.tables_section.show_all")})]}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(Gs,{className:"h-full",children:t.length===0?a.jsx(bs,{title:u("side_panel.tables_section.empty_state.title"),description:u("side_panel.tables_section.empty_state.description"),className:"mt-20",secondaryAction:s?void 0:{label:u("side_panel.tables_section.add_table"),onClick:()=>k({view:!1})}}):p&&y.length===0?a.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:u("side_panel.tables_section.no_results")}),a.jsxs(K,{variant:"outline",size:"sm",onClick:C,className:"gap-1",children:[a.jsx(Rn,{className:"size-3.5"}),u("side_panel.tables_section.clear")]})]}):a.jsx(Zb,{tables:y})})})]})},qc=({customType:e,tables:t})=>{const n=e.name;for(const s of t)for(const r of s.fields)if(r.type.name===n)return!0;return!1},cx=({customType:e})=>{const{updateCustomType:t,removeCustomType:n,highlightedCustomType:s,highlightCustomTypeId:r,tables:i,databaseType:o,readonly:l}=se(),{schemasDisplayed:c}=Ir(),{t:d}=ie(),[u,f]=D.useState(!1),[p,x]=D.useState(e.name),b=D.useRef(null),{listeners:m}=vn({id:e.id}),g=h.useCallback(()=>{u&&(p.trim()&&t(e.id,{name:p.trim()}),f(!1))},[p,e.id,t,u]),T=h.useCallback(()=>{f(!1),x(e.name)},[e.name]);zs(b,g),cn("Enter",g),cn("Escape",T);const y=j=>{j.stopPropagation(),f(!0)},v=h.useCallback(j=>{j.stopPropagation(),n(e.id)},[e.id,n]),S=h.useMemo(()=>s?.id===e.id,[s,e.id]),I=h.useCallback(j=>{j.stopPropagation(),r(S?void 0:e.id)},[e.id,r,S]),k=h.useMemo(()=>qc({customType:e,tables:i}),[e,i]),C=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-fit min-w-40",children:[a.jsx(Zn,{children:d("side_panel.custom_types_section.custom_type.custom_type_actions.title")}),a.jsx(At,{}),a.jsxs(Dt,{children:[a.jsxs(it,{onClick:I,disabled:!k,className:"flex justify-between",children:[d(S?"side_panel.custom_types_section.custom_type.custom_type_actions.clear_field_highlight":"side_panel.custom_types_section.custom_type.custom_type_actions.highlight_fields"),a.jsx(Rl,{className:"size-3.5"})]}),l?null:a.jsxs(it,{onClick:v,className:"flex justify-between !text-red-700",children:[d("side_panel.custom_types_section.custom_type.custom_type_actions.delete_custom_type"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})]})]})]}),[v,d,I,k,S,l]),_=h.useMemo(()=>{if(c.length>1)return e.schema??wn[o]},[e.schema,c.length,o]);return a.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[l?null:a.jsx("div",{className:"flex cursor-move items-center justify-center",...m,children:a.jsx(ts,{className:"size-4 text-muted-foreground"})}),a.jsx("div",{className:"flex min-w-0 flex-1 px-1",children:u?a.jsx(Ie,{ref:b,autoFocus:!0,type:"text",placeholder:e.name,value:p,onClick:j=>j.stopPropagation(),onChange:j=>x(j.target.value),className:"h-7 w-full focus-visible:ring-0"}):l?a.jsxs("div",{className:"truncate px-2 py-0.5",children:[e.name,a.jsx("span",{className:"text-xs text-muted-foreground",children:_?` (${_})`:""})]}):a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsxs("div",{onDoubleClick:y,className:"text-editable truncate px-2 py-0.5",children:[e.name,a.jsx("span",{className:"text-xs text-muted-foreground",children:_?` (${_})`:""})]})}),a.jsx(Te,{children:d("tool_tips.double_click_to_edit")})]})}),a.jsx("div",{className:"flex flex-row-reverse items-center",children:u?a.jsx(Ae,{onClick:g,children:a.jsx(Dn,{})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{children:C()}),e.kind===sn.enum?a.jsx(Of,{variant:"outline",className:"h-fit bg-background px-2 text-xs md:group-hover:hidden",children:ka[e.kind]}):null,l?null:a.jsx("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:a.jsx(Ae,{onClick:y,children:a.jsx(ns,{})})})]})})]})},dx=({values:e,addValue:t,removeValue:n})=>{const{t:s}=ie(),[r,i]=h.useState(""),{readonly:o}=se(),l=h.useCallback(()=>{r.trim()&&!e.includes(r.trim())&&(t(r.trim()),i(""))},[r,e,t]),c=h.useCallback(d=>{d.key==="Enter"&&(d.preventDefault(),l())},[l]);return a.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(op,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:s("side_panel.custom_types_section.custom_type.enum_values")})]}),a.jsx("div",{className:"flex flex-col gap-1",children:e.map((d,u)=>a.jsxs("div",{className:"flex items-center justify-between gap-1 rounded-md border border-border bg-muted/30 px-2 py-1",children:[a.jsx("span",{className:"flex-1 truncate text-sm font-medium",children:d}),o?null:a.jsx(K,{variant:"ghost",className:"size-6 p-0 text-muted-foreground hover:bg-destructive/10 hover:text-destructive",onClick:()=>n(d),children:a.jsx(Rn,{className:"size-3.5"})})]},u))}),e.length===0?a.jsx("div",{className:"py-2 text-muted-foreground",children:s("side_panel.custom_types_section.custom_type.no_values")}):null,o?null:a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Ie,{value:r,onChange:d=>i(d.target.value),onKeyDown:c,placeholder:"Add enum value...",className:"h-8 flex-1 text-xs focus-visible:ring-0"}),a.jsx(K,{variant:"outline",className:"h-8 px-2 text-xs",onClick:l,disabled:!r.trim()||e.includes(r.trim()),children:a.jsx(Lt,{className:"size-3.5"})})]})]})},ux=({field:e,onRemove:t})=>{const{attributes:n,listeners:s,setNodeRef:r,transform:i,transition:o,isDragging:l}=vn({id:e.field}),{readonly:c}=se(),d={transform:Ot.Transform.toString(i),transition:o,opacity:l?.5:1};return a.jsxs("div",{ref:r,style:d,className:"flex items-center gap-2 rounded-md border p-2",children:[c?null:a.jsx("div",{className:"flex cursor-move items-center justify-center",...n,...s,children:a.jsx(ts,{className:"size-3 text-muted-foreground"})}),a.jsx("div",{className:"flex-1 text-sm",children:e.field}),a.jsx("div",{className:"text-xs text-muted-foreground",children:e.type}),c?null:a.jsx(K,{variant:"ghost",size:"sm",className:"size-6 p-0 text-muted-foreground hover:text-red-500",onClick:t,children:a.jsx(Rn,{className:"size-3"})})]})},hx=({fields:e,addField:t,removeField:n,reorderFields:s})=>{const{t:r}=ie(),{currentDiagram:i,customTypes:o,readonly:l}=se(),[c,d]=h.useState(""),[u,f]=h.useState(""),p=h.useMemo(()=>xh[i.databaseType]||[],[i.databaseType]),x=h.useMemo(()=>o.map(v=>({id:v.name,name:v.name})),[o]),b=ds(cs(xn)),m=h.useCallback(v=>{const{active:S,over:I}=v;if(S?.id!==I?.id&&I&&S){const k=e.findIndex(_=>_.field===S.id),C=e.findIndex(_=>_.field===I.id);if(k!==-1&&C!==-1){const _=gn(e,k,C);s(_)}}},[e,s]),g=h.useCallback(()=>{if(c.trim()&&u.trim()){if(e.some(S=>S.field===c.trim()))return;t({field:c.trim(),type:u.trim()}),d(""),f("")}},[c,u,t,e]),T=h.useCallback(v=>{v.key==="Enter"&&(v.preventDefault(),g())},[g]),y=h.useCallback(v=>{n(v)},[n]);return a.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(hp,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:r("side_panel.custom_types_section.custom_type.composite_fields")})]}),e.length===0?a.jsx("div",{className:"py-2 text-muted-foreground",children:r("side_panel.custom_types_section.custom_type.no_fields")}):a.jsx(fs,{sensors:b,collisionDetection:us,onDragEnd:m,children:a.jsx(ms,{items:e.map(v=>v.field),strategy:ps,children:a.jsx("div",{className:"flex flex-col gap-1",children:e.map(v=>a.jsx(ux,{field:v,onRemove:()=>y(v)},v.field))})})}),l?null:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx(Ie,{placeholder:r("side_panel.custom_types_section.custom_type.field_name_placeholder"),value:c,onChange:v=>d(v.target.value),onKeyDown:T,className:"h-8 flex-1 text-xs"}),a.jsxs(Xs,{value:u,onValueChange:f,children:[a.jsx(as,{className:"h-8 w-32 text-xs",children:a.jsx(Ws,{placeholder:r("side_panel.custom_types_section.custom_type.field_type_placeholder")})}),a.jsxs(is,{children:[a.jsxs(Ms,{children:[a.jsx(Fa,{children:"Standard Types"}),p.map(v=>a.jsx(Ke,{value:v.name,children:v.name},v.id))]}),x.length>0?a.jsxs(a.Fragment,{children:[a.jsx(Cc,{}),a.jsxs(Ms,{children:[a.jsx(Fa,{children:"Custom Types"}),x.map(v=>a.jsx(Ke,{value:v.name,children:v.name},v.id))]})]}):null]})]})]}),a.jsxs(K,{variant:"ghost",size:"sm",className:"h-6 gap-1 self-start text-xs",onClick:g,disabled:!c.trim()||!u.trim(),children:[a.jsx(Lt,{className:"size-3"}),r("side_panel.custom_types_section.custom_type.add_field")]})]})]})},fx=({customType:e})=>{const{removeCustomType:t,updateCustomType:n,highlightedCustomType:s,highlightCustomTypeId:r,tables:i,readonly:o}=se(),{t:l}=ie(),c=h.useCallback(()=>{t(e.id)},[e.id,t]),d=h.useCallback(v=>{n(e.id,{kind:v})},[e.id,n]),u=h.useCallback(v=>{n(e.id,{values:[...e.values||[],v]})},[e.id,e.values,n]),f=h.useCallback(v=>{n(e.id,{values:(e.values||[]).filter(S=>S!==v)})},[e.id,e.values,n]),p=h.useCallback(v=>{n(e.id,{fields:[...e.fields||[],v]})},[e.id,e.fields,n]),x=h.useCallback(v=>{n(e.id,{fields:(e.fields||[]).filter(S=>S.field!==v.field)})},[e.id,e.fields,n]),b=h.useCallback(v=>{n(e.id,{fields:v})},[e.id,n]),m=h.useCallback(()=>{s?.id===e.id?r(void 0):r(e.id)},[e.id,r,s?.id]),g=h.useMemo(()=>qc({customType:e,tables:i}),[e,i]),T=h.useMemo(()=>s?.id===e.id,[s,e.id]),y=h.useCallback(()=>a.jsxs(K,{variant:"ghost",disabled:!g,className:"flex h-8 w-full items-center justify-center p-2 text-xs",onClick:m,children:[a.jsx(Rl,{className:"mr-1 size-3.5"}),l(T?"side_panel.custom_types_section.custom_type.custom_type_actions.clear_field_highlight":"side_panel.custom_types_section.custom_type.custom_type_actions.highlight_fields")]}),[T,g,m,l]);return a.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1",children:[a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx($f,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.custom_types_section.custom_type.kind")})]}),a.jsxs(Xs,{value:e.kind,onValueChange:d,disabled:o,children:[a.jsx(as,{className:"h-8",children:a.jsx(Ws,{})}),a.jsx(is,{children:a.jsxs(Ms,{children:[a.jsx(Ke,{value:sn.composite,children:ka[sn.composite]}),a.jsx(Ke,{value:sn.enum,children:ka[sn.enum]})]})})]})]}),e.kind===sn.enum?a.jsx(dx,{values:e.values||[],addValue:u,removeValue:f}):a.jsx(hx,{fields:e.fields||[],addField:p,removeField:x,reorderFields:b})]}),a.jsxs("div",{className:"flex flex-col items-center justify-center pt-2",children:[g?y():a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:y()})}),a.jsx(Te,{children:l("side_panel.custom_types_section.custom_type.no_fields_tooltip")})]}),o?null:a.jsxs(K,{variant:"ghost",className:"flex h-8 w-full items-center justify-center p-2 text-xs",onClick:c,children:[a.jsx(bt,{className:"mr-1 size-3.5 text-red-700"}),a.jsx("div",{className:"text-red-700",children:l("side_panel.custom_types_section.custom_type.delete_custom_type")})]})]})]})},Yc=D.forwardRef(({customType:e},t)=>{const{attributes:n,setNodeRef:s,transform:r,transition:i}=vn({id:e.id}),o={transform:Ot.Translate.toString(r),transition:i};return a.jsx(rn,{value:e.id,className:"border-none",ref:t,children:a.jsxs("div",{className:"w-full rounded-md border-b",ref:s,style:o,...n,children:[a.jsx(an,{className:"w-full rounded-md bg-slate-50 px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none dark:bg-slate-900",asChild:!0,children:a.jsx(cx,{customType:e})}),a.jsx(on,{className:"border-x border-slate-100 p-1 pb-0 dark:border-slate-800",children:a.jsx(fx,{customType:e})})]})})});Yc.displayName="CustomTypeListItem";const px=({customTypes:e})=>{const{updateCustomType:t}=se(),{openCustomTypeFromSidebar:n,openedCustomTypeInSidebar:s}=et(),r=D.useRef(null),i=h.useMemo(()=>e.reduce((u,f)=>(u[f.id]=D.createRef(),u),{}),[e]),o=h.useCallback(u=>i[u]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[i]),l=ds(cs(xn)),c=h.useCallback(u=>{const{active:f,over:p}=u;if(f?.id!==p?.id&&p&&f){const x=e.findIndex(g=>g.id===f.id),b=e.findIndex(g=>g.id===p.id);gn(e,x,b).forEach((g,T)=>{t(g.id,{order:T})})}},[e,t]),d=h.useCallback(()=>{s&&r.current!==s&&(r.current=s,o(s))},[o,s]);return a.jsx(Dr,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:s,onValueChange:n,onAnimationEnd:d,children:a.jsx(fs,{sensors:l,collisionDetection:us,onDragEnd:c,children:a.jsx(ms,{items:e,strategy:ps,children:e.sort((u,f)=>u.order&&f.order===void 0?-1:u.order===void 0&&f.order?1:u.order!=null&&f.order!=null?u.order-f.order:u.name.localeCompare(f.name)).map(u=>a.jsx(Yc,{customType:u,ref:i[u.id]},u.id))})})})},mx=()=>{const{t:e}=ie(),{customTypes:t,createCustomType:n,readonly:s}=se(),[r,i]=D.useState(""),o=D.useRef(null),l=h.useMemo(()=>t.filter(u=>!r?.trim?.()||u.name.toLowerCase().includes(r.toLowerCase())),[t,r]),c=h.useCallback(()=>{i("")},[]),d=h.useCallback(async()=>{await n()},[n]);return a.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{ref:o,type:"text",placeholder:e("side_panel.custom_types_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:r,onChange:u=>i(u.target.value)})}),s?null:a.jsxs(K,{variant:"secondary",size:"sm",className:"h-8 px-2",onClick:d,children:[a.jsx(Lt,{className:"mr-1 size-4"}),e("side_panel.custom_types_section.new_type")]})]}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(Gs,{className:"h-full",children:t.length===0?a.jsx(bs,{title:e("side_panel.custom_types_section.empty_state.title"),description:e("side_panel.custom_types_section.empty_state.description"),className:"mt-20",secondaryAction:s?void 0:{label:e("side_panel.custom_types_section.new_type"),onClick:d}}):r&&l.length===0?a.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:e("side_panel.custom_types_section.no_results")}),a.jsxs(K,{variant:"outline",size:"sm",onClick:c,className:"gap-1",children:[a.jsx(Rn,{className:"size-3.5"}),e("side_panel.custom_types_section.clear")]})]}):a.jsx(px,{customTypes:l})})})]})},bx=e=>!e||e.length===0?"":e.filter(t=>t.kind===sn.enum).map(t=>{const n=t.schema?`"${t.schema}"."${t.name.replace(/"/g,'\\"')}"`:`"${t.name.replace(/"/g,'\\"')}"`,s=(t.values||[]).map(r=>`    "${r.replace(/"/g,'\\"')}"`).join(`
`);return`Enum ${n} {
${s}
}
`}).join(`
`),xx=e=>{switch(e){case Ne.SQL_SERVER:return"mssql";case Ne.MYSQL:case Ne.MARIADB:return"mysql";case Ne.POSTGRESQL:case Ne.COCKROACHDB:case Ne.SQLITE:case Ne.ORACLE:return"postgres";default:return"postgres"}},gx=e=>{const t=e.tables?.map(s=>{const r={...s};return s.name==="relation"&&(r.fields=s.fields.map(i=>{const o={...i};return i.name==="from"?o.name="source":i.name==="to"&&(o.name="target"),o})),r})||[],n=e.relationships?.map(s=>{const r=e.tables?.find(c=>c.name==="relation");if(!r)return s;const i={...s},o=r.fields.find(c=>c.name==="from");if(o&&s.targetFieldId===o.id){const d=t.find(u=>u.name==="relation")?.fields.find(u=>u.name==="source");d&&(i.targetFieldId=d.id)}const l=r.fields.find(c=>c.name==="to");if(l&&s.targetFieldId===l.id){const d=t.find(u=>u.name==="relation")?.fields.find(u=>u.name==="target");d&&(i.targetFieldId=d.id)}return i})||[];return{...e,tables:t,relationships:n}},vx=e=>{let t=e;const n=new Set;let s=0;return t=t.replace(/ADD CONSTRAINT (\w+) FOREIGN KEY/g,(o,l)=>n.has(l)?`ADD CONSTRAINT ${l}_${++s} FOREIGN KEY`:(n.add(l),o)),t=t.split(`
`).map(o=>{const c=/ALTER\s+TABLE\s+(?:["[]?(\S+?)[\]"]?\.)?["[]?(\S+?)[\]"]?\s+ADD\s+CONSTRAINT\s+\S+\s+FOREIGN\s+KEY\s*\(["[]?([^)"]+)[\]"]?\)\s+REFERENCES\s+(?:["[]?\S+?[\]"]?\.)?"?[[]?\2[\]]?"?\s*\(["[]?([^)"]+)[\]"]?\)\s*;/i.exec(o);if(c){const d=c[3].trim(),u=c[4].trim();if(d===u)return`-- ${o}`}return o}).join(`
`),t=t.replace(/::regclass/g,""),t=t.replace(/: :regclass/g,""),t=t.replace(/CREATE\s+(?:UNIQUE\s+)?INDEX\s+\S+\s+ON\s+\S+\s*\(([^)]+)\)/gi,(o,l)=>{const c=l.split(",").map(u=>u.trim()),d=[...new Set(c)];return o.replace(l,d.join(", "))}),t=t.replace(/char\s+\(/g,"char("),t=t.replace(/character\s+\(/g,"character("),t=t.replace(/DEFAULT\s+([A-Z]{3})(?=\s|,|$)/g,"DEFAULT '$1'"),t=t.replace(/DEFAULT\s+([A-Z])(?=\s|,|$)/g,"DEFAULT '$1'"),t=t.replace(/DEFAULT\s+NOW(?=\s|,|$)/gi,"DEFAULT NOW()"),t=t.replace(/\?\?/g,"__"),t},Nx=(e,t)=>{let n=t+1;const s=e.length;for(;n<s;){const r=e[n];if(r==="]")return n;if(r==="'"||r==='"'){const o=r==="'"&&e[n+1]==="'"&&e[n+2]==="'"?"'''":r,l=o.length;for(n+=l;n<s;)if(e[n]==="\\")n+=2;else if(e.startsWith(o,n)){n+=l;break}else n++;continue}n++}return-1},yx=e=>{const t=/Ref\s+"([^"]+)"\s*:\s*(?:"([^"]+)"\.)?"([^"]+)"\."([^"]+)"\s*(<>|[<>\-*])\s*(?:"([^"]+)"\.)?"([^"]+)"\."([^"]+)"/g,n=[];let s;for(;(s=t.exec(e))!==null;)n.push({refName:s[1],sourceSchema:s[2]||void 0,sourceTable:s[3],sourceField:s[4],direction:s[5],targetSchema:s[6]||void 0,targetTable:s[7],targetField:s[8]});const r={};let i=0;for(;i<e.length;){const b=/Table\s+(?:"([^"]+)"(?:\."([^"]+)")?|(\[?[^\s[]+\]?\.\[?[^\s\]]+\]?)|(\[?[^\s[{]+\]?))\s*{/g;b.lastIndex=i;const m=b.exec(e);if(!m)break;let g;m[1]&&m[2]?g=`${m[1]}.${m[2]}`:m[1]?g=m[1]:g=m[3]||m[4];const T=g.replace(/\[([^\]]+)\]/g,"$1"),y=m.index+m[0].length-1;let v=1;const S=y+1;let I=S;for(let k=S;k<e.length&&v>0;k++)e[k]==="{"?v++:e[k]==="}"&&(v--,v===0&&(I=k));if(v===0){const k=e.substring(S,I),C=e.substring(m.index,I+1);r[T]={start:m.index,end:I+1,content:k,fullMatch:C},i=I+1}else i=m.index+m[0].length}if(n.length===0||Object.keys(r).length===0)return e;const o=new Map(Object.entries(r)),l=new Map;n.forEach(b=>{let m,g,T,y;const v=b.sourceSchema?`"${b.sourceSchema}"."${b.sourceTable}"."${b.sourceField}"`:`"${b.sourceTable}"."${b.sourceField}"`,S=b.targetSchema?`"${b.targetSchema}"."${b.targetTable}"."${b.targetField}"`:`"${b.targetTable}"."${b.targetField}"`;b.direction==="<"?(m=b.targetSchema?`${b.targetSchema}.${b.targetTable}`:b.targetTable,g=b.targetField,T=`ref: > ${v}`,y=b.sourceTable):b.direction===">"?(m=b.sourceSchema?`${b.sourceSchema}.${b.sourceTable}`:b.sourceTable,g=b.sourceField,T=`ref: > ${S}`,y=b.targetTable):b.direction==="-"?(m=b.targetSchema?`${b.targetSchema}.${b.targetTable}`:b.targetTable,g=b.targetField,T=`ref: - ${v}`,y=b.sourceTable):b.direction==="<>"?(m=b.targetSchema?`${b.targetSchema}.${b.targetTable}`:b.targetTable,g=b.targetField,T=`ref: <> ${v}`,y=b.sourceTable):(m=b.sourceSchema?`${b.sourceSchema}.${b.sourceTable}`:b.sourceTable,g=b.sourceField,T=`ref: > ${S}`,y=b.targetTable);const I=`${m}.${g}`,k=l.get(I)||{table:m,refs:[],relatedTables:[]};k.refs.push(T),k.relatedTables.push(y),l.set(I,k)}),l.forEach((b,m)=>{const g=m.lastIndexOf("."),T=m.substring(0,g),y=m.substring(g+1),v=o.get(T);if(!v)return;const S=new RegExp(`^([ \\t]*)"${y}"\\s+`),I=v.content.split(`
`);let k=!1;const C=I.map(_=>{const j=S.exec(_);if(!j)return _;k=!0;const R=j[1],L=_.indexOf("["),X=L!==-1?_.substring(0,L).trim():_.trim(),P=L!==-1?_.substring(L+1,Nx(_,L)):null,F=P?[P.trim(),...b.refs]:b.refs;return`${R}${X} [${F.join(", ")}]`});k&&(v.content=C.join(`
`),o.set(T,v))});let c="",d=0;const u=Object.entries(r).sort(([,b],[,m])=>b.start-m.start);for(const[,b]of u){c+=e.substring(d,b.start);const m=b.fullMatch;let g=b.content;const T=g.split(`
`),y=[];for(let I=0;I<T.length;I++){const k=T[I],C=k.trimEnd();C===""&&I===T.length-1||C===""&&I<T.length-1&&T[I+1].trim().startsWith("}")||y.push(k)}g=y.join(`
`),g.endsWith(`
`)||(g=g+`
`);const S=`${m.substring(0,m.indexOf("{")+1)}${g}}`;c+=S,d=b.end}return c+=e.substring(d),c.split(`
`).filter(b=>!b.trim().startsWith("Ref ")).join(`
`).trim().replace(/\n\s*\n\s*\n/g,`

`).replace(/}\n(?=Table)/g,`}

`)},Ex=e=>{if(!e.relationships)return e;const t=new Set,n=new Set,s=e.relationships.filter(r=>{const i=`${r.sourceTableId}-${r.sourceFieldId}->${r.targetTableId}-${r.targetFieldId}`,o=[`${r.sourceTableId}-${r.sourceFieldId}`,`${r.targetTableId}-${r.targetFieldId}`].sort().join("<->");return t.has(i)||n.has(o)?!1:(t.add(i),n.add(o),!0)});return{...e,relationships:s}},Io=e=>e.replace(/"char "/g,'"char"').replace(/char \(([0-9]+)\)/g,"char($1)").replace(/"char \(([0-9]+)\)"/g,'"char($1)"').replace(/"character \(([0-9]+)\)"/g,'"character($1)"').replace(/character \(([0-9]+)\)/g,"character($1)"),jo=e=>e.replace(/(\s+"[^"]+"\s+)"([^"\s]+\[\])"/g,"$1$2"),_x=e=>e.replace(/Table\s+\[([^\]]+)\]\.\[([^\]]+)\]/g,'Table "$1"."$2"'),Tx=e=>e.replace(/Table\s+((?:"[^"]*"\.)?"[^"]*(?:\n[^"]*)*")\s*\{/g,(t,n)=>`Table ${n.replace(/\n\s*/g,"")} {`),wx=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{s.fields.filter(i=>i.increment).forEach(i=>{const o=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`,l=i.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=new RegExp(`(Table ${o} \\{[^}]*?^\\s*"${l}"[^\\[\\n]+)(\\[[^\\]]*\\])`,"gms");n=n.replace(c,(d,u,f)=>{if(f.includes("increment"))return d;const p=f.replace("]",", increment]");return u+p})})}),n},Cx=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{const r=(s.checkConstraints??[]).filter(l=>l.expression&&l.expression.trim()&&kl(l.expression));if(r.length===0)return;const i=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`,o=new RegExp(`(Table ${i} \\{)([\\s\\S]*?)(^\\})`,"gm");n=n.replace(o,(l,c,d,u)=>{if(/^\s*checks\s*\{/m.test(d))return l;const p=`
  checks {
${r.map(x=>`    \`${x.expression}\``).join(`
`)}
  }
`;return`${c}${d}${p}${u}`})}),n},Ix=(e,t)=>{if(!t||t.length===0)return e;let n=e;const s=r=>r.replace(/\r?\n/g," ").replace(/\s+/g," ").trim().replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"');return t.forEach(r=>{const i=r.schema?`"${r.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${r.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${r.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`;if(r.comments){const l=s(r.comments),c=new RegExp(`(Table ${i} \\{)([\\s\\S]*?)(^\\})`,"gm");n=n.replace(c,(d,u,f,p)=>/^\s*Note:\s*'/m.test(f)?d:`${u}${f}
  Note: '${l}'
${p}`)}r.fields.filter(l=>l.comments).forEach(l=>{const c=l.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=s(l.comments),u=new RegExp(`(Table ${i} \\{[^}]*?^\\s*"${c}"\\s+\\S+(?:\\([^)]*\\))?(?:\\[\\])?)(\\s*\\[[^\\]]*\\])?`,"gms");n=n.replace(u,(f,p,x)=>{if(x&&x.includes("note:"))return f;if(x){const b=x.replace("]",`, note: '${d}']`);return p+b}else return p+` [note: '${d}']`})})}),n},jx=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{const r=s.indexes.find(i=>i.isPrimaryKey);if(r?.name){const i=s.fields.filter(o=>o.primaryKey);if(i.length>=1){const o=i.map(u=>u.name).join(", "),l=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`,c=new RegExp(`(Table ${l} \\{[^}]*?Indexes \\{[^}]*?)(\\(${o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\) \\[pk\\])`,"gs"),d=`$1(${o}) [pk, name: "${r.name}"]`;n=n.replace(c,d)}}}),n},Sx=(e,t)=>{if(!t||t.length===0)return e;let n=e;return t.forEach(s=>{const r=s.indexes.filter(o=>o.type&&o.type!=="btree"&&!o.isPrimaryKey);if(r.length===0)return;const i=s.schema?`"${s.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"\\."${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`:`"${s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"`;r.forEach(o=>{const l=o.fieldIds.map(f=>{const p=s.fields.find(x=>x.id===f);return p?p.name:null}).filter(f=>f!==null);if(l.length===0)return;const c=o.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let d;l.length===1?d=l[0].replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):d=`\\(${l.map(p=>p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join(",\\s*")}\\)`;const u=new RegExp(`(Table ${i} \\{[\\s\\S]*?Indexes \\{[\\s\\S]*?)(${d})\\s*\\[([^\\]]*name:\\s*"${c}"[^\\]]*)\\]`,"g");n=n.replace(u,(f,p,x,b)=>{if(/type:\s*\w+/.test(b))return f;const m=`type: ${o.type}, ${b}`;return`${p}${x} [${m}]`})})}),n},kx=(e,t)=>{if(!t||t.length===0)return e;const n=new Map;t.forEach((r,i)=>{const o=n.get(r.name)||[];o.push({table:r,index:i}),n.set(r.name,o)});let s=e;return n.forEach((r,i)=>{if(r.length===1){const o=r[0].table;if(o.schema){const l=o.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),c=o.schema.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(!new RegExp(`Table\\s+"${c}"\\."${l}"\\s*{`,"g").test(s)){const u=new RegExp(`Table\\s+"${l}"\\s*{`,"g"),f=`Table "${o.schema}"."${o.name}" {`;s=s.replace(u,f);const p=new RegExp(`(Ref\\s+"[^"]+")\\s*:\\s*"${l}"\\."([^"]+)"`,"g");s=s.replace(p,`$1:"${o.schema}"."${o.name}"."$2"`);const x=new RegExp(`([<>])\\s*"${l}"\\."([^"]+)"`,"g");s=s.replace(x,`$1 "${o.schema}"."${o.name}"."$2"`)}}}else{const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),l=r.filter(({table:u})=>{const f=new RegExp(`Table\\s+"${u.schema}"\\.\\s*"${o}"\\s*{`,"g");return!s.match(f)}),c=new RegExp(`Table\\s+"${o}"\\s*{`,"g");let d=0;s=s.replace(c,u=>{if(d>=l.length)return u;const f=l[d];return d++,f&&f.table.schema?`Table "${f.table.schema}"."${i}" {`:u})}}),s},Lx=e=>e.split(`
`).filter(s=>s.trim().startsWith("Ref ")).join(`
`).trim(),Ax=(e,t)=>{if(!e||e.length===0)return"";const n=new Map,s=new Map;for(const i of t){n.set(i.id,i);for(const o of i.fields)s.set(o.id,{table:i,fieldName:o.name})}const r=[];for(const i of e){const o=n.get(i.sourceTableId),l=n.get(i.targetTableId),c=s.get(i.sourceFieldId),d=s.get(i.targetFieldId);if(!o||!l||!c||!d)continue;const u=o.schema?`"${o.schema}"."${o.name}"."${c.fieldName}"`:`"${o.name}"."${c.fieldName}"`,f=l.schema?`"${l.schema}"."${l.name}"."${d.fieldName}"`:`"${l.name}"."${d.fieldName}"`;let p,x,b;i.sourceCardinality==="one"&&i.targetCardinality==="many"?(p=u,x=f,b="<"):i.sourceCardinality==="many"&&i.targetCardinality==="one"?(p=f,x=u,b="<"):i.sourceCardinality==="one"&&i.targetCardinality==="one"?(p=u,x=f,b="-"):(p=u,x=f,b="<>"),r.push(`Ref "${i.name}":${p} ${b} ${x}`)}return r.join(`

`)};function Dx(e){const t=e.tables?.map(b=>{const m=b.fields.filter(g=>g.name!=="");return{...b,fields:m}})??[],n=new Set,s=t.filter(b=>{if(b.fields.length===0)return!1;const m=b.schema?`${b.schema}.${b.name}`:b.name;return n.has(m)?!1:(n.add(m),!0)}),r={...e,tables:s,relationships:e.relationships?.filter(b=>{const m=s.find(v=>v.id===b.sourceTableId),g=s.find(v=>v.id===b.targetTableId),T=m?.fields.some(v=>v.id===b.sourceFieldId),y=g?.fields.some(v=>v.id===b.targetFieldId);return m&&g&&T&&y})??[]},i=gx(r),o=b=>{const m=new Map,g=b.fields.map(y=>{const v=m.get(y.name)||0;if(v>0){const S=`${y.name}_${v+1}`;return{...y,name:S}}return m.set(y.name,v+1),y}),T=(b.checkConstraints??[]).filter(y=>y.expression&&y.expression.trim()&&kl(y.expression));return{...b,fields:g,indexes:(b.indexes||[]).filter(y=>!y.isPrimaryKey).map(y=>({...y,name:y.name||`idx_${Math.random().toString(36).substring(2,8)}`})),checkConstraints:T.length>0?T:void 0}},l=Ex({...i,tables:i.tables?.map(o)??[],relationships:i.relationships?.map((b,m)=>{const g=b.name?b.name.replace(/[^\w]/g,"_"):Math.random().toString(36).substring(2,8);return{...b,name:`fk_${m}_${g}`}})??[]});let c="",d="",u="";const f=bx(l.customTypes);let p;try{u=xf({diagram:l,targetDatabaseType:e.databaseType,isDBMLFlow:!0,skipFKGeneration:!0}),u=vx(u),c=jo(Io(Tx(_x(gf.importer.import(u,xx(e.databaseType)))))),c=kx(c,s),c=jx(c,s),c=wx(c,s),c=Ix(c,s),c=Cx(c,s),c=Sx(c,s);const b=Ax(l.relationships??[],l.tables??[]);b&&(c=c.trimEnd()+`

`+b+`
`),f&&(c=f+`

`+c),d=jo(Io(yx(c))),c=c.replace(/\n\s*\n\s*\n/g,`

`),d=d.replace(/\n\s*\n\s*\n/g,`

`),c.endsWith(`
`)||(c+=`
`),d.endsWith(`
`)||(d+=`
`)}catch(b){console.error("Error during DBML generation process:",b,"Input SQL was:",u),p=b instanceof Error?b.message:"Unknown error";const m=`// Error generating DBML: ${p}`;c=m,d=m,c.startsWith("// Error generating DBML:")&&f&&(c=f+`

`+c),d.startsWith("// Error generating DBML:")&&f&&(d=f+`

`+d)}const x=Lx(c);return{standardDbml:c,inlineDbml:d,relationshipsDbml:x,error:p}}const Mn=({type:e,schema:t,otherSchema:n,parentName:s,otherParentName:r,name:i,otherName:o})=>`${e}-${t?`${t}.`:""}${n?`${n}.`:""}${s?`${s}.`:""}${r?`${r}.`:""}${i}${o?`.${o}`:""}`,Ss=e=>Mn({type:"table",schema:e.schema,name:e.name}),Rx=(e,t)=>Mn({type:"field",schema:e.schema,parentName:e.name,name:t.name}),Mx=(e,t)=>Mn({type:"index",schema:e.schema,parentName:e.name,name:t.name}),Ox=(e,t)=>{const n=t[e.sourceTableId],s=t[e.targetTableId],r=t[e.sourceFieldId],i=t[e.targetFieldId];return!n||!s||!r||!i?null:Mn({type:"relationship",schema:n.schema,otherSchema:s.schema,parentName:n.name,otherParentName:s.name,name:r.name,otherName:i.name})},Qc=e=>Mn({type:"customType",schema:e.schema,name:e.name}),Px=(e,t)=>{const n=t[e.dependentTableId],s=t[e.tableId];return!n||!s?null:Mn({type:"dependency",schema:n.schema,otherSchema:s.schema,name:n.name,otherName:s.name})},Fx=e=>Mn({type:"area",name:e.name}),Ux=e=>{const t={},n={};return e.tables?.forEach(s=>{const r=Ss(s);t[r]=s.id,n[s.id]={schema:s.schema,name:s.name,color:s.color},s.fields?.forEach(i=>{const o=Rx(s,i);t[o]=i.id,n[i.id]={schema:s.schema,name:i.name}}),s.indexes?.forEach(i=>{const o=Mx(s,i);t[o]=i.id})}),e.relationships?.forEach(s=>{const r=Ox(s,n);r&&(t[r]=s.id)}),e.customTypes?.forEach(s=>{const r=Qc(s);t[r]=s.id}),e.dependencies?.forEach(s=>{const r=Px(s,n);r&&(t[r]=s.id)}),e.areas?.forEach(s=>{const r=Fx(s);t[r]=s.id}),{objectKeysToIdsMap:t,sourceIdToDataMap:n}},Bx=({targetTables:e,sourceTables:t,defaultDatabaseSchema:n})=>{if(!e)return{tables:[],idMappings:{tables:{},fields:{}}};if(!t)return{tables:e,idMappings:{tables:{},fields:{}}};const s={tables:{},fields:{}},r=new Map;return t.forEach(o=>{const l=Ss(o);r.set(l,o)}),{tables:e.map(o=>{const l=Ss(o);let c=r.get(l);if(!c&&o.schema){const m=Ss({...o,schema:void 0});c=r.get(m)}if(!c&&n)if(o.schema)o.schema;else{const m=Ss({...o,schema:n});c=r.get(m)}if(!c)return o;const d=c.id;s.tables[o.id]=d;const u=new Map;c.fields?.forEach(m=>{u.set(m.name,m)});const f=o.fields?.map(m=>{const g=u.get(m.name);return g?(s.fields[m.id]=g.id,{...m,id:g.id,createdAt:g.createdAt}):m}),p=new Map;c.indexes?.forEach(m=>{p.set(m.name,m)});const x=o.indexes?.map(m=>{const g=p.get(m.name);if(g)return{...m,id:g.id,name:g.name,createdAt:g.createdAt};const T=m.fieldIds.map(v=>s.fields[v]||v),y=c.indexes?.find(v=>p.has(v.name)&&o.indexes?.some(I=>I.name===v.name)||v.fieldIds.length!==T.length||!v.fieldIds.every((I,k)=>I===T[k])?!1:v.unique===m.unique&&!!v.isPrimaryKey==!!m.isPrimaryKey);return y?{...m,name:y.name,id:y.id,createdAt:y.createdAt}:m}),b={...c,fields:f,indexes:x,checkConstraints:o.checkConstraints,comments:o.comments};return o.fields&&(b.fields=b.fields?.map(m=>{const g=o.fields?.find(T=>T.name===m.name);return g?{...m,nullable:g.nullable,unique:g.unique,primaryKey:g.primaryKey,type:g.type}:m})),b}),idMappings:s}},$x=(e,t)=>e?e.map(n=>{const s=Qc(n),r=t[s];return r?{...n,id:r}:n}):[],Vx=(e,t,n)=>{if(!e||e.length===0)return[];if(!t||t.length===0)return e.map(i=>{let o=i.sourceTableId,l=i.targetTableId,c=i.sourceFieldId,d=i.targetFieldId;for(const[u,f]of Object.entries(n.tables))u===i.sourceTableId&&(o=f),u===i.targetTableId&&(l=f);for(const[u,f]of Object.entries(n.fields))u===i.sourceFieldId&&(c=f),u===i.targetFieldId&&(d=f);return{...i,sourceTableId:o,targetTableId:l,sourceFieldId:c,targetFieldId:d}});const s=[],r=new Set;return t.forEach(i=>{let o=!1;const l=e.find(c=>{const d=n.tables[c.sourceTableId],u=n.tables[c.targetTableId],f=n.fields[c.sourceFieldId],p=n.fields[c.targetFieldId],x=i.sourceTableId===d&&i.targetTableId===u&&i.sourceFieldId===f&&i.targetFieldId===p,b=i.sourceTableId===u&&i.targetTableId===d&&i.sourceFieldId===p&&i.targetFieldId===f;return b&&!x&&(o=!0),x||b});if(l){r.add(l.id);const c={...i,sourceCardinality:o?l.targetCardinality:l.sourceCardinality,targetCardinality:o?l.sourceCardinality:l.targetCardinality};i.sourceSchema||delete c.sourceSchema,i.targetSchema||delete c.targetSchema,s.push(c)}}),e.forEach(i=>{if(!r.has(i.id)){let o=i.sourceTableId,l=i.targetTableId,c=i.sourceFieldId,d=i.targetFieldId;for(const[u,f]of Object.entries(n.tables))u===i.sourceTableId&&(o=f),u===i.targetTableId&&(l=f);for(const[u,f]of Object.entries(n.fields))u===i.sourceFieldId&&(c=f),u===i.targetFieldId&&(d=f);s.push({...i,sourceTableId:o,targetTableId:l,sourceFieldId:c,targetFieldId:d})}}),s},Gx=(e,t,n)=>e?t?e.map(s=>{const r=t.find(i=>{const o=n.tables[s.tableId],l=n.tables[s.dependentTableId];return i.tableId===o&&i.dependentTableId===l});return r?{...s,id:r.id,tableId:n.tables[s.tableId]||s.tableId,dependentTableId:n.tables[s.dependentTableId]||s.dependentTableId}:{...s,tableId:n.tables[s.tableId]||s.tableId,dependentTableId:n.tables[s.dependentTableId]||s.dependentTableId}}):e:[],zx=(e,t)=>e?e.map(n=>({...n,indexes:n.indexes?.map(s=>({...s,fieldIds:s.fieldIds.map(r=>t.fields[r]||r)}))})):[],Kx=({sourceDiagram:e,targetDiagram:t})=>{const{objectKeysToIdsMap:n}=Ux(e),{tables:s,idMappings:r}=Bx({targetTables:t.tables,sourceTables:e.tables,defaultDatabaseSchema:wn[e.databaseType]}),i=$x(t.customTypes,n),o=[...e.customTypes?.filter(p=>p.kind===sn.composite)??[],...i],l=Vx(t.relationships,e.relationships,r),c=Gx(t.dependencies,e.dependencies,r),d=zx(s,r),u=[...l].sort((p,x)=>{const b=e.relationships?.find(y=>y.id===p.id),m=e.relationships?.find(y=>y.id===x.id);if(!b||!m)return 0;const g=e.relationships?.indexOf(b)??0,T=e.relationships?.indexOf(m)??0;return g-T});return{...e,tables:d.sort((p,x)=>(p.order??0)-(x.order??0)),areas:t.areas,notes:t.notes,relationships:u,dependencies:c,customTypes:o}};var Jc=typeof global=="object"&&global&&global.Object===Object&&global,Xx=typeof self=="object"&&self&&self.Object===Object&&self,zt=Jc||Xx||Function("return this")(),Pt=zt.Symbol,Zc=Object.prototype,Wx=Zc.hasOwnProperty,Hx=Zc.toString,Cs=Pt?Pt.toStringTag:void 0;function qx(e){var t=Wx.call(e,Cs),n=e[Cs];try{e[Cs]=void 0;var s=!0}catch{}var r=Hx.call(e);return s&&(t?e[Cs]=n:delete e[Cs]),r}var Yx=Object.prototype,Qx=Yx.toString;function Jx(e){return Qx.call(e)}var Zx="[object Null]",eg="[object Undefined]",So=Pt?Pt.toStringTag:void 0;function xs(e){return e==null?e===void 0?eg:Zx:So&&So in Object(e)?qx(e):Jx(e)}function jn(e){return e!=null&&typeof e=="object"}var tg="[object Symbol]";function zr(e){return typeof e=="symbol"||jn(e)&&xs(e)==tg}function ed(e,t){for(var n=-1,s=e==null?0:e.length,r=Array(s);++n<s;)r[n]=t(e[n],n,e);return r}var wt=Array.isArray,ko=Pt?Pt.prototype:void 0,Lo=ko?ko.toString:void 0;function td(e){if(typeof e=="string")return e;if(wt(e))return ed(e,td)+"";if(zr(e))return Lo?Lo.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var ng=/\s/;function sg(e){for(var t=e.length;t--&&ng.test(e.charAt(t)););return t}var rg=/^\s+/;function ag(e){return e&&e.slice(0,sg(e)+1).replace(rg,"")}function Yn(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ao=NaN,ig=/^[-+]0x[0-9a-f]+$/i,og=/^0b[01]+$/i,lg=/^0o[0-7]+$/i,cg=parseInt;function dg(e){if(typeof e=="number")return e;if(zr(e))return Ao;if(Yn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Yn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ag(e);var n=og.test(e);return n||lg.test(e)?cg(e.slice(2),n?2:8):ig.test(e)?Ao:+e}var Do=1/0,ug=17976931348623157e292;function hg(e){if(!e)return e===0?e:0;if(e=dg(e),e===Do||e===-Do){var t=e<0?-1:1;return t*ug}return e===e?e:0}function fg(e){var t=hg(e),n=t%1;return t===t?n?t-n:t:0}function Kr(e){return e}var pg="[object AsyncFunction]",mg="[object Function]",bg="[object GeneratorFunction]",xg="[object Proxy]";function nd(e){if(!Yn(e))return!1;var t=xs(e);return t==mg||t==bg||t==pg||t==xg}var wa=zt["__core-js_shared__"],Ro=(function(){var e=/[^.]+$/.exec(wa&&wa.keys&&wa.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();function gg(e){return!!Ro&&Ro in e}var vg=Function.prototype,Ng=vg.toString;function On(e){if(e!=null){try{return Ng.call(e)}catch{}try{return e+""}catch{}}return""}var yg=/[\\^$.*+?()[\]{}|]/g,Eg=/^\[object .+?Constructor\]$/,_g=Function.prototype,Tg=Object.prototype,wg=_g.toString,Cg=Tg.hasOwnProperty,Ig=RegExp("^"+wg.call(Cg).replace(yg,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jg(e){if(!Yn(e)||gg(e))return!1;var t=nd(e)?Ig:Eg;return t.test(On(e))}function Sg(e,t){return e?.[t]}function Pn(e,t){var n=Sg(e,t);return jg(n)?n:void 0}var Xa=Pn(zt,"WeakMap");function kg(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var Lg=800,Ag=16,Dg=Date.now;function Rg(e){var t=0,n=0;return function(){var s=Dg(),r=Ag-(s-n);if(n=s,r>0){if(++t>=Lg)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Mg(e){return function(){return e}}var Mo=(function(){try{var e=Pn(Object,"defineProperty");return e({},"",{}),e}catch{}})(),Og=Mo?function(e,t){return Mo(e,"toString",{configurable:!0,enumerable:!1,value:Mg(t),writable:!0})}:Kr,Pg=Rg(Og);function Fg(e,t,n,s){e.length;for(var r=n+1;r--;)if(t(e[r],r,e))return r;return-1}var Ug=9007199254740991,Bg=/^(?:0|[1-9]\d*)$/;function sd(e,t){var n=typeof e;return t=t??Ug,!!t&&(n=="number"||n!="symbol"&&Bg.test(e))&&e>-1&&e%1==0&&e<t}function rd(e,t){return e===t||e!==e&&t!==t}var Oo=Math.max;function $g(e,t,n){return t=Oo(t===void 0?e.length-1:t,0),function(){for(var s=arguments,r=-1,i=Oo(s.length-t,0),o=Array(i);++r<i;)o[r]=s[t+r];r=-1;for(var l=Array(t+1);++r<t;)l[r]=s[r];return l[t]=n(o),kg(e,this,l)}}function Vg(e,t){return Pg($g(e,t,Kr),e+"")}var Gg=9007199254740991;function vi(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Gg}function Xr(e){return e!=null&&vi(e.length)&&!nd(e)}var zg=Object.prototype;function ad(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||zg;return e===n}function id(e,t){for(var n=-1,s=Array(e);++n<e;)s[n]=t(n);return s}var Kg="[object Arguments]";function Po(e){return jn(e)&&xs(e)==Kg}var od=Object.prototype,Xg=od.hasOwnProperty,Wg=od.propertyIsEnumerable,Ni=Po((function(){return arguments})())?Po:function(e){return jn(e)&&Xg.call(e,"callee")&&!Wg.call(e,"callee")};function Hg(){return!1}var ld=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Fo=ld&&typeof module=="object"&&module&&!module.nodeType&&module,qg=Fo&&Fo.exports===ld,Uo=qg?zt.Buffer:void 0,Yg=Uo?Uo.isBuffer:void 0,Wa=Yg||Hg,Qg="[object Arguments]",Jg="[object Array]",Zg="[object Boolean]",ev="[object Date]",tv="[object Error]",nv="[object Function]",sv="[object Map]",rv="[object Number]",av="[object Object]",iv="[object RegExp]",ov="[object Set]",lv="[object String]",cv="[object WeakMap]",dv="[object ArrayBuffer]",uv="[object DataView]",hv="[object Float32Array]",fv="[object Float64Array]",pv="[object Int8Array]",mv="[object Int16Array]",bv="[object Int32Array]",xv="[object Uint8Array]",gv="[object Uint8ClampedArray]",vv="[object Uint16Array]",Nv="[object Uint32Array]",pe={};pe[hv]=pe[fv]=pe[pv]=pe[mv]=pe[bv]=pe[xv]=pe[gv]=pe[vv]=pe[Nv]=!0;pe[Qg]=pe[Jg]=pe[dv]=pe[Zg]=pe[uv]=pe[ev]=pe[tv]=pe[nv]=pe[sv]=pe[rv]=pe[av]=pe[iv]=pe[ov]=pe[lv]=pe[cv]=!1;function yv(e){return jn(e)&&vi(e.length)&&!!pe[xs(e)]}function Ev(e){return function(t){return e(t)}}var cd=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ds=cd&&typeof module=="object"&&module&&!module.nodeType&&module,_v=Ds&&Ds.exports===cd,Ca=_v&&Jc.process,Bo=(function(){try{var e=Ds&&Ds.require&&Ds.require("util").types;return e||Ca&&Ca.binding&&Ca.binding("util")}catch{}})(),$o=Bo&&Bo.isTypedArray,dd=$o?Ev($o):yv,Tv=Object.prototype,wv=Tv.hasOwnProperty;function ud(e,t){var n=wt(e),s=!n&&Ni(e),r=!n&&!s&&Wa(e),i=!n&&!s&&!r&&dd(e),o=n||s||r||i,l=o?id(e.length,String):[],c=l.length;for(var d in e)(t||wv.call(e,d))&&!(o&&(d=="length"||r&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||sd(d,c)))&&l.push(d);return l}function Cv(e,t){return function(n){return e(t(n))}}var Iv=Cv(Object.keys,Object),jv=Object.prototype,Sv=jv.hasOwnProperty;function kv(e){if(!ad(e))return Iv(e);var t=[];for(var n in Object(e))Sv.call(e,n)&&n!="constructor"&&t.push(n);return t}function yi(e){return Xr(e)?ud(e):kv(e)}function Lv(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}var Av=Object.prototype,Dv=Av.hasOwnProperty;function Rv(e){if(!Yn(e))return Lv(e);var t=ad(e),n=[];for(var s in e)s=="constructor"&&(t||!Dv.call(e,s))||n.push(s);return n}function Mv(e){return Xr(e)?ud(e,!0):Rv(e)}var Ov=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Pv=/^\w*$/;function Ei(e,t){if(wt(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||zr(e)?!0:Pv.test(e)||!Ov.test(e)||t!=null&&e in Object(t)}var Fs=Pn(Object,"create");function Fv(){this.__data__=Fs?Fs(null):{},this.size=0}function Uv(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Bv="__lodash_hash_undefined__",$v=Object.prototype,Vv=$v.hasOwnProperty;function Gv(e){var t=this.__data__;if(Fs){var n=t[e];return n===Bv?void 0:n}return Vv.call(t,e)?t[e]:void 0}var zv=Object.prototype,Kv=zv.hasOwnProperty;function Xv(e){var t=this.__data__;return Fs?t[e]!==void 0:Kv.call(t,e)}var Wv="__lodash_hash_undefined__";function Hv(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Fs&&t===void 0?Wv:t,this}function Sn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Sn.prototype.clear=Fv;Sn.prototype.delete=Uv;Sn.prototype.get=Gv;Sn.prototype.has=Xv;Sn.prototype.set=Hv;function qv(){this.__data__=[],this.size=0}function Wr(e,t){for(var n=e.length;n--;)if(rd(e[n][0],t))return n;return-1}var Yv=Array.prototype,Qv=Yv.splice;function Jv(e){var t=this.__data__,n=Wr(t,e);if(n<0)return!1;var s=t.length-1;return n==s?t.pop():Qv.call(t,n,1),--this.size,!0}function Zv(e){var t=this.__data__,n=Wr(t,e);return n<0?void 0:t[n][1]}function eN(e){return Wr(this.__data__,e)>-1}function tN(e,t){var n=this.__data__,s=Wr(n,e);return s<0?(++this.size,n.push([e,t])):n[s][1]=t,this}function Kt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Kt.prototype.clear=qv;Kt.prototype.delete=Jv;Kt.prototype.get=Zv;Kt.prototype.has=eN;Kt.prototype.set=tN;var Us=Pn(zt,"Map");function nN(){this.size=0,this.__data__={hash:new Sn,map:new(Us||Kt),string:new Sn}}function sN(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Hr(e,t){var n=e.__data__;return sN(t)?n[typeof t=="string"?"string":"hash"]:n.map}function rN(e){var t=Hr(this,e).delete(e);return this.size-=t?1:0,t}function aN(e){return Hr(this,e).get(e)}function iN(e){return Hr(this,e).has(e)}function oN(e,t){var n=Hr(this,e),s=n.size;return n.set(e,t),this.size+=n.size==s?0:1,this}function Xt(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var s=e[t];this.set(s[0],s[1])}}Xt.prototype.clear=nN;Xt.prototype.delete=rN;Xt.prototype.get=aN;Xt.prototype.has=iN;Xt.prototype.set=oN;var lN="Expected a function";function _i(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(lN);var n=function(){var s=arguments,r=t?t.apply(this,s):s[0],i=n.cache;if(i.has(r))return i.get(r);var o=e.apply(this,s);return n.cache=i.set(r,o)||i,o};return n.cache=new(_i.Cache||Xt),n}_i.Cache=Xt;var cN=500;function dN(e){var t=_i(e,function(s){return n.size===cN&&n.clear(),s}),n=t.cache;return t}var uN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hN=/\\(\\)?/g,fN=dN(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(uN,function(n,s,r,i){t.push(r?i.replace(hN,"$1"):s||n)}),t});function pN(e){return e==null?"":td(e)}function hd(e,t){return wt(e)?e:Ei(e,t)?[e]:fN(pN(e))}function qr(e){if(typeof e=="string"||zr(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function fd(e,t){t=hd(t,e);for(var n=0,s=t.length;e!=null&&n<s;)e=e[qr(t[n++])];return n&&n==s?e:void 0}function pd(e,t,n){var s=e==null?void 0:fd(e,t);return s===void 0?n:s}function md(e,t){for(var n=-1,s=t.length,r=e.length;++n<s;)e[r+n]=t[n];return e}var Vo=Pt?Pt.isConcatSpreadable:void 0;function mN(e){return wt(e)||Ni(e)||!!(Vo&&e&&e[Vo])}function bN(e,t,n,s,r){var i=-1,o=e.length;for(n||(n=mN),r||(r=[]);++i<o;){var l=e[i];n(l)?md(r,l):r[r.length]=l}return r}function Go(e){var t=e==null?0:e.length;return t?bN(e):[]}function xN(){this.__data__=new Kt,this.size=0}function gN(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function vN(e){return this.__data__.get(e)}function NN(e){return this.__data__.has(e)}var yN=200;function EN(e,t){var n=this.__data__;if(n instanceof Kt){var s=n.__data__;if(!Us||s.length<yN-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xt(s)}return n.set(e,t),this.size=n.size,this}function Gt(e){var t=this.__data__=new Kt(e);this.size=t.size}Gt.prototype.clear=xN;Gt.prototype.delete=gN;Gt.prototype.get=vN;Gt.prototype.has=NN;Gt.prototype.set=EN;function bd(e,t){for(var n=-1,s=e==null?0:e.length,r=0,i=[];++n<s;){var o=e[n];t(o,n,e)&&(i[r++]=o)}return i}function _N(){return[]}var TN=Object.prototype,wN=TN.propertyIsEnumerable,zo=Object.getOwnPropertySymbols,CN=zo?function(e){return e==null?[]:(e=Object(e),bd(zo(e),function(t){return wN.call(e,t)}))}:_N;function IN(e,t,n){var s=t(e);return wt(e)?s:md(s,n(e))}function Ko(e){return IN(e,yi,CN)}var Ha=Pn(zt,"DataView"),qa=Pn(zt,"Promise"),Ya=Pn(zt,"Set"),Xo="[object Map]",jN="[object Object]",Wo="[object Promise]",Ho="[object Set]",qo="[object WeakMap]",Yo="[object DataView]",SN=On(Ha),kN=On(Us),LN=On(qa),AN=On(Ya),DN=On(Xa),nn=xs;(Ha&&nn(new Ha(new ArrayBuffer(1)))!=Yo||Us&&nn(new Us)!=Xo||qa&&nn(qa.resolve())!=Wo||Ya&&nn(new Ya)!=Ho||Xa&&nn(new Xa)!=qo)&&(nn=function(e){var t=xs(e),n=t==jN?e.constructor:void 0,s=n?On(n):"";if(s)switch(s){case SN:return Yo;case kN:return Xo;case LN:return Wo;case AN:return Ho;case DN:return qo}return t});var Qo=zt.Uint8Array,RN="__lodash_hash_undefined__";function MN(e){return this.__data__.set(e,RN),this}function ON(e){return this.__data__.has(e)}function Nr(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Xt;++t<n;)this.add(e[t])}Nr.prototype.add=Nr.prototype.push=MN;Nr.prototype.has=ON;function PN(e,t){for(var n=-1,s=e==null?0:e.length;++n<s;)if(t(e[n],n,e))return!0;return!1}function FN(e,t){return e.has(t)}var UN=1,BN=2;function xd(e,t,n,s,r,i){var o=n&UN,l=e.length,c=t.length;if(l!=c&&!(o&&c>l))return!1;var d=i.get(e),u=i.get(t);if(d&&u)return d==t&&u==e;var f=-1,p=!0,x=n&BN?new Nr:void 0;for(i.set(e,t),i.set(t,e);++f<l;){var b=e[f],m=t[f];if(s)var g=o?s(m,b,f,t,e,i):s(b,m,f,e,t,i);if(g!==void 0){if(g)continue;p=!1;break}if(x){if(!PN(t,function(T,y){if(!FN(x,y)&&(b===T||r(b,T,n,s,i)))return x.push(y)})){p=!1;break}}else if(!(b===m||r(b,m,n,s,i))){p=!1;break}}return i.delete(e),i.delete(t),p}function $N(e){var t=-1,n=Array(e.size);return e.forEach(function(s,r){n[++t]=[r,s]}),n}function VN(e){var t=-1,n=Array(e.size);return e.forEach(function(s){n[++t]=s}),n}var GN=1,zN=2,KN="[object Boolean]",XN="[object Date]",WN="[object Error]",HN="[object Map]",qN="[object Number]",YN="[object RegExp]",QN="[object Set]",JN="[object String]",ZN="[object Symbol]",ey="[object ArrayBuffer]",ty="[object DataView]",Jo=Pt?Pt.prototype:void 0,Ia=Jo?Jo.valueOf:void 0;function ny(e,t,n,s,r,i,o){switch(n){case ty:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ey:return!(e.byteLength!=t.byteLength||!i(new Qo(e),new Qo(t)));case KN:case XN:case qN:return rd(+e,+t);case WN:return e.name==t.name&&e.message==t.message;case YN:case JN:return e==t+"";case HN:var l=$N;case QN:var c=s&GN;if(l||(l=VN),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;s|=zN,o.set(e,t);var u=xd(l(e),l(t),s,r,i,o);return o.delete(e),u;case ZN:if(Ia)return Ia.call(e)==Ia.call(t)}return!1}var sy=1,ry=Object.prototype,ay=ry.hasOwnProperty;function iy(e,t,n,s,r,i){var o=n&sy,l=Ko(e),c=l.length,d=Ko(t),u=d.length;if(c!=u&&!o)return!1;for(var f=c;f--;){var p=l[f];if(!(o?p in t:ay.call(t,p)))return!1}var x=i.get(e),b=i.get(t);if(x&&b)return x==t&&b==e;var m=!0;i.set(e,t),i.set(t,e);for(var g=o;++f<c;){p=l[f];var T=e[p],y=t[p];if(s)var v=o?s(y,T,p,t,e,i):s(T,y,p,e,t,i);if(!(v===void 0?T===y||r(T,y,n,s,i):v)){m=!1;break}g||(g=p=="constructor")}if(m&&!g){var S=e.constructor,I=t.constructor;S!=I&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof I=="function"&&I instanceof I)&&(m=!1)}return i.delete(e),i.delete(t),m}var oy=1,Zo="[object Arguments]",el="[object Array]",rr="[object Object]",ly=Object.prototype,tl=ly.hasOwnProperty;function cy(e,t,n,s,r,i){var o=wt(e),l=wt(t),c=o?el:nn(e),d=l?el:nn(t);c=c==Zo?rr:c,d=d==Zo?rr:d;var u=c==rr,f=d==rr,p=c==d;if(p&&Wa(e)){if(!Wa(t))return!1;o=!0,u=!1}if(p&&!u)return i||(i=new Gt),o||dd(e)?xd(e,t,n,s,r,i):ny(e,t,c,n,s,r,i);if(!(n&oy)){var x=u&&tl.call(e,"__wrapped__"),b=f&&tl.call(t,"__wrapped__");if(x||b){var m=x?e.value():e,g=b?t.value():t;return i||(i=new Gt),r(m,g,n,s,i)}}return p?(i||(i=new Gt),iy(e,t,n,s,r,i)):!1}function Ti(e,t,n,s,r){return e===t?!0:e==null||t==null||!jn(e)&&!jn(t)?e!==e&&t!==t:cy(e,t,n,s,Ti,r)}var dy=1,uy=2;function hy(e,t,n,s){var r=n.length,i=r;if(e==null)return!i;for(e=Object(e);r--;){var o=n[r];if(o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++r<i;){o=n[r];var l=o[0],c=e[l],d=o[1];if(o[2]){if(c===void 0&&!(l in e))return!1}else{var u=new Gt,f;if(!(f===void 0?Ti(d,c,dy|uy,s,u):f))return!1}}return!0}function gd(e){return e===e&&!Yn(e)}function fy(e){for(var t=yi(e),n=t.length;n--;){var s=t[n],r=e[s];t[n]=[s,r,gd(r)]}return t}function vd(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}function py(e){var t=fy(e);return t.length==1&&t[0][2]?vd(t[0][0],t[0][1]):function(n){return n===e||hy(n,e,t)}}function my(e,t){return e!=null&&t in Object(e)}function by(e,t,n){t=hd(t,e);for(var s=-1,r=t.length,i=!1;++s<r;){var o=qr(t[s]);if(!(i=e!=null&&n(e,o)))break;e=e[o]}return i||++s!=r?i:(r=e==null?0:e.length,!!r&&vi(r)&&sd(o,r)&&(wt(e)||Ni(e)))}function xy(e,t){return e!=null&&by(e,t,my)}var gy=1,vy=2;function Ny(e,t){return Ei(e)&&gd(t)?vd(qr(e),t):function(n){var s=pd(n,e);return s===void 0&&s===t?xy(n,e):Ti(t,s,gy|vy)}}function Nd(e){return function(t){return t?.[e]}}function yy(e){return function(t){return fd(t,e)}}function Ey(e){return Ei(e)?Nd(qr(e)):yy(e)}function yd(e){return typeof e=="function"?e:e==null?Kr:typeof e=="object"?wt(e)?Ny(e[0],e[1]):py(e):Ey(e)}function _y(e,t,n,s){for(var r=-1,i=e==null?0:e.length;++r<i;){var o=e[r];t(s,o,n(o),e)}return s}function Ty(e){return function(t,n,s){for(var r=-1,i=Object(t),o=s(t),l=o.length;l--;){var c=o[++r];if(n(i[c],c,i)===!1)break}return t}}var Ed=Ty();function wy(e,t){return e&&Ed(e,t,yi)}function Cy(e,t){return function(n,s){if(n==null)return n;if(!Xr(n))return e(n,s);for(var r=n.length,i=-1,o=Object(n);++i<r&&s(o[i],i,o)!==!1;);return n}}var Iy=Cy(wy);function jy(e,t,n,s){return Iy(e,function(r,i,o){t(s,r,n(r),o)}),s}function Sy(e,t){return function(n,s){var r=wt(n)?_y:jy,i=t?t():{};return r(n,e,yd(s),i)}}function ky(e){return jn(e)&&Xr(e)}function ge(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function Ly(e){return typeof e=="function"?e:Kr}var Ay=Math.max,Dy=Math.min;function Ry(e,t,n){var s=e==null?0:e.length;if(!s)return-1;var r=s-1;return n!==void 0&&(r=fg(n),r=n<0?Ay(s+r,0):Dy(r,s-1)),Fg(e,yd(t),r)}function My(e){return e&&e.length?e[0]:void 0}function Bs(e,t){return e==null?e:Ed(e,Ly(t),Mv)}var xt=Sy(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),Oy=Math.max;function Py(e){if(!(e&&e.length))return[];var t=0;return e=bd(e,function(n){if(ky(n))return t=Oy(n.length,t),!0}),id(t,function(n){return ed(e,Nd(n))})}var Qa=Vg(Py),w=(e=>(e.SPACE="<space>",e.TAB="<tab>",e.NEWLINE="<newline>",e.COMMA="<comma>",e.LPAREN="<lparen>",e.RPAREN="<rparen>",e.LBRACE="<lbrace>",e.RBRACE="<rbrace>",e.LBRACKET="<lbracket>",e.RBRACKET="<rbracket>",e.LANGLE="<langle>",e.RANGLE="<rangle>",e.OP="<op>",e.EOF="<eof>",e.NUMERIC_LITERAL="<number>",e.STRING_LITERAL="<string>",e.COLOR_LITERAL="<color>",e.FUNCTION_EXPRESSION="<function-expression>",e.QUOTED_STRING="<variable>",e.IDENTIFIER="<identifier>",e.SEMICOLON="<semicolon>",e.COLON="<colon>",e.TILDE="<tilde>",e.SINGLE_LINE_COMMENT="<single-line-comment>",e.MULTILINE_COMMENT="<multiline-comment>",e))(w||{});function Fy(e){switch(e.kind){case"<newline>":case"<space>":case"<tab>":case"<single-line-comment>":case"<multiline-comment>":return!0;default:return!1}}function Uy(e){if(!e)return!1;switch(e){case"+":case"-":case"*":case"/":case"%":case"<":case">":case"=":case"!":case".":case"&":case"|":return!0;default:return!1}}function nl(e){return e!==void 0&&e.kind==="<op>"}class ot{constructor(t,n,s,r,i){this.kind=t,this.startPos=n,this.endPos=s,this.value=r,this.leadingTrivia=[],this.trailingTrivia=[],this.leadingInvalid=[],this.trailingInvalid=[],this.isInvalid=i,this.start=n.offset,this.end=s.offset}static create(t,n,s,r,i){return new ot(t,n,s,r,i)}}function _d(e){return e.trailingTrivia.find(({kind:t})=>t===w.NEWLINE)!==void 0}function sl(e,t){return t.leadingTrivia.find(({kind:n})=>n===w.NEWLINE)!==void 0||_d(e)}function Ja(e){return e.trailingTrivia.find(({kind:t})=>[w.SPACE,w.TAB].includes(t))!==void 0}function Td(e){return e.trailingTrivia.length===0?e.end:Td(ge(e.trailingTrivia))}function wd(e){return e.leadingTrivia.length===0?e.start:wd(e.leadingTrivia[0])}function By(e){return[w.SINGLE_LINE_COMMENT,w.MULTILINE_COMMENT].includes(e.kind)}class $y{constructor(){this.id=0}reset(){this.id=0}nextId(){return this.id++}}class ve{constructor(t,n,s){this.id=t,this.kind=n;const r=s.find(o=>o!==void 0&&!Number.isNaN(o.start));r?(this.startPos=r.startPos,this.fullStart=r instanceof ot?wd(r):r.fullStart):(this.startPos={offset:NaN,column:NaN,line:NaN},this.fullStart=NaN);const i=[...s].reverse().find(o=>o!==void 0&&!Number.isNaN(o.end));i?(this.endPos=i.endPos,this.fullEnd=i instanceof ot?Td(i):i.fullEnd):(this.endPos={offset:NaN,column:NaN,line:NaN},this.fullEnd=NaN),this.start=this.startPos.offset,this.end=this.endPos.offset}}var Tn=(e=>(e.PROGRAM="<program>",e.ELEMENT_DECLARATION="<element-declaration>",e.ATTRIBUTE="<attribute>",e.IDENTIFIER_STREAM="<identifer-stream>",e.LITERAL="<literal>",e.VARIABLE="<variable>",e.PREFIX_EXPRESSION="<prefix-expression>",e.INFIX_EXPRESSION="<infix-expression>",e.POSTFIX_EXPRESSION="<postfix-expression>",e.FUNCTION_EXPRESSION="<function-expression>",e.FUNCTION_APPLICATION="<function-application>",e.BLOCK_EXPRESSION="<block-expression>",e.LIST_EXPRESSION="<list-expression>",e.TUPLE_EXPRESSION="<tuple-expression>",e.CALL_EXPRESSION="<call-expression>",e.PRIMARY_EXPRESSION="<primary-expression>",e.GROUP_EXPRESSION="<group-expression>",e.DUMMY="<dummy>",e.ARRAY="<array>",e.PARTIAL_INJECTION="<partial-injection>",e))(Tn||{});class ht extends ve{constructor({body:t=[],eof:n},s){super(s,"<program>",[...t,n]),this.body=t,this.eof=n}}class ce extends ve{constructor({type:t,name:n,as:s,alias:r,attributeList:i,bodyColon:o,body:l},c){if(super(c,"<element-declaration>",[t,n,s,r,i,o,l]),l&&o&&!(l instanceof re||l instanceof ce))throw new Error("If an element has a simple body, it must be a function application node");this.type=t,this.name=n,this.as=s,this.alias=r,this.attributeList=i,this.bodyColon=o,this.body=l}}class Nt extends ve{constructor({identifiers:t=[]},n){super(n,"<identifer-stream>",t||[]),this.identifiers=t}}class yt extends ve{constructor({name:t,colon:n,value:s},r){super(r,"<attribute>",[t,n,s]),this.name=t,this.value=s,this.colon=n}}class ft extends ve{constructor({op:t,expression:n},s){super(s,"<prefix-expression>",[t,n]),this.op=t,this.expression=n}}class Ft extends ve{constructor({op:t,leftExpression:n,rightExpression:s},r){super(r,"<infix-expression>",[n,t,s]),this.op=t,this.leftExpression=n,this.rightExpression=s}}class Yr extends ve{constructor({op:t,expression:n},s){super(s,"<postfix-expression>",[n,t]),this.op=t,this.expression=n}}class pt extends ve{constructor({value:t},n){super(n,"<function-expression>",[t]),this.value=t}}class re extends ve{constructor({callee:t,args:n=[]},s){super(s,"<function-application>",[t,...n]),this.callee=t,this.args=n}}class jt extends ve{constructor({blockOpenBrace:t,body:n=[],blockCloseBrace:s},r){super(r,"<block-expression>",[t,...n,s]),this.blockOpenBrace=t,this.body=n,this.blockCloseBrace=s}}class kn extends ve{constructor({op:t,partial:n},s){super(s,"<partial-injection>",[t,n]),this.partial=n}}class xe extends ve{constructor({listOpenBracket:t,elementList:n=[],commaList:s=[],listCloseBracket:r},i){super(i,"<list-expression>",[t,...Cd(n,s),r]),this.listOpenBracket=t,this.elementList=n,this.commaList=s,this.listCloseBracket=r}}class Ut extends ve{constructor({tupleOpenParen:t,elementList:n=[],commaList:s=[],tupleCloseParen:r},i){super(i,"<tuple-expression>",[t,...Cd(n,s),r]),this.tupleOpenParen=t,this.elementList=n,this.commaList=s,this.tupleCloseParen=r}}class wi extends Ut{constructor({groupOpenParen:t,expression:n,groupCloseParen:s},r){super({tupleOpenParen:t,elementList:n&&[n],commaList:[],tupleCloseParen:s},r),this.kind="<group-expression>"}}class mt extends ve{constructor({callee:t,argumentList:n},s){super(s,"<call-expression>",[t,n]),this.callee=t,this.argumentList=n}}class gs extends ve{constructor({literal:t},n){super(n,"<literal>",[t]),this.literal=t}}class Ct extends ve{constructor({variable:t},n){super(n,"<variable>",[t]),this.variable=t}}class We extends ve{constructor({expression:t},n){super(n,"<primary-expression>",[t]),this.expression=t}}class ar extends ve{constructor({pre:t},n){const s=ot.create(w.SPACE,t.endPos,t.endPos," ",!1);super(n,"<dummy>",[s])}}class Ln extends ve{constructor({expression:t,indexer:n},s){super(s,"<array>",[t,n]),this.array=t,this.indexer=n}}function Cd(e,t){if(!e||e.length===0)return t||[];if(!t||t.length===0)return e||[];const[n]=e,[s]=t;return(n.start<s.start?Go(Qa(e,t)):Go(Qa(t,e))).filter(r=>r!==null)}class Ce{constructor(t){this.value=t}unwrap(){return this.value}unwrap_or(t){return this.value}and_then(t){return t(this.value)}map(t){return new Ce(t(this.value))}isOk(){return!0}}class ue{constructor(){this.value=void 0}unwrap(){throw new Error("Trying to unwrap a None value")}unwrap_or(t){return t}and_then(t){return new ue}map(t){return new ue}isOk(){return!1}}var U=(e=>(e.Schema="Schema",e.Table="Table",e.Column="Column",e.TableGroup="TableGroup",e.TableGroupField="TableGroup field",e.Enum="Enum",e.EnumField="Enum field",e.Note="Note",e.TablePartial="TablePartial",e.TablePartialInjection="TablePartialInjection",e))(U||{});function Ci(e){return`Schema:${e}`}function yr(e){return`Table:${e}`}function Qr(e){return`Column:${e}`}function Ii(e){return`Enum:${e}`}function ji(e){return`Enum field:${e}`}function Si(e){return`TableGroup:${e}`}function ki(e){return`TableGroup field:${e}`}function Vy(e){return`Note:${e}`}function Li(e){return`TablePartial:${e}`}function Id(e){return`TablePartialInjection:${e}`}function lr(e,t){switch(t){case"Column":return Qr(e);case"Enum":return Ii(e);case"Enum field":return ji(e);case"Schema":return Ci(e);case"Table":return yr(e);case"TableGroup":return Si(e);case"TableGroup field":return ki(e);case"TablePartial":return Li(e);default:throw new Error("Unreachable")}}function Et(e){const[t,n]=e.split(":");return Object.values(U).includes(t)?new Ce({name:n,kind:t}):new ue}function Gy(e){const t=Et(e).unwrap_or(void 0);if(!t)return!1;const{kind:n,name:s}=t;return n==="Schema"&&s==="public"}function zy(e){const t=Et(e).unwrap_or(void 0);if(!t)return!1;const{kind:n}=t;return n==="TablePartialInjection"}function Ky(e){const t=Et(e).unwrap_or(void 0);if(!t)return null;const{kind:n,name:s}=t;return n==="TablePartialInjection"?lr(s,"TablePartial"):null}class Xy{constructor(){this.id=0}reset(){this.id=0}nextId(){return this.id++}}class jd{constructor({symbolTable:t},n){this.references=[],this.id=n,this.symbolTable=t}}class Wy{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Hy{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Sd{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Ai{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class qy{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Yy{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Qy{constructor({symbolTable:t,declaration:n},s){this.references=[],this.id=s,this.symbolTable=t,this.declaration=n}}class Jy{constructor({declaration:t},n){this.references=[],this.id=n,this.declaration=t}}class Zy{constructor({injectorFieldSymbol:t,injectorDeclaration:n},s){this.references=[],this.id=s,this.injectorDeclaration=n,this.injectorFieldSymbol=t}}function eE(e){return[Ci,yr,Ii,Si,Qr,ji,ki,Li,Id].map(t=>t(e))}function tE(e){return e instanceof Ai?Zy:null}function Jr(e){return!!e.match(new RegExp("(\\p{L}|_|\\p{M})","gu"))}function Er(e){const[t]=e;return t>="0"&&t<="9"}function nE(e){const[t]=e;return Er(t)||Jr(t)&&t.toLowerCase()>="a"&&t.toLowerCase()<="f"}function zn(e){return Jr(e)||Er(e)}function rl(e,t){const n=[],s=Math.min(e.length,t.length);for(let r=0;r<s;r+=1)n.push(e[r],t[r]);return n.push(...e.slice(s),...t.slice(s)),n}function Rs(e,t){return e>=t.start&&e<t.end}function kd(e){var t;return e instanceof ft?`${(t=e.op)==null?void 0:t.value}${kd(e.expression)}`:e.expression.literal.value}function Za(e){var t;return e instanceof ft?((t=e.op)==null?void 0:t.value)==="-"?-Za(e.expression):Za(e.expression):Number.parseFloat(e.expression.literal.value)}var N=(e=>(e[e.UNKNOWN_SYMBOL=1e3]="UNKNOWN_SYMBOL",e[e.UNEXPECTED_SYMBOL=1001]="UNEXPECTED_SYMBOL",e[e.UNEXPECTED_EOF=1002]="UNEXPECTED_EOF",e[e.UNEXPECTED_NEWLINE=1003]="UNEXPECTED_NEWLINE",e[e.UNKNOWN_TOKEN=1004]="UNKNOWN_TOKEN",e[e.UNEXPECTED_TOKEN=1005]="UNEXPECTED_TOKEN",e[e.UNEXPECTED_ELEMENT_DECLARATION=1006]="UNEXPECTED_ELEMENT_DECLARATION",e[e.MISSING_SPACES=1007]="MISSING_SPACES",e[e.UNKNOWN_PREFIX_OP=1008]="UNKNOWN_PREFIX_OP",e[e.INVALID_OPERAND=1009]="INVALID_OPERAND",e[e.EMPTY_ATTRIBUTE_NAME=1010]="EMPTY_ATTRIBUTE_NAME",e[e.INVALID_ESCAPE_SEQUENCE=1011]="INVALID_ESCAPE_SEQUENCE",e[e.INVALID_NAME=3e3]="INVALID_NAME",e[e.UNEXPECTED_NAME=3001]="UNEXPECTED_NAME",e[e.NAME_NOT_FOUND=3002]="NAME_NOT_FOUND",e[e.DUPLICATE_NAME=3003]="DUPLICATE_NAME",e[e.INVALID_ALIAS=3004]="INVALID_ALIAS",e[e.UNEXPECTED_ALIAS=3005]="UNEXPECTED_ALIAS",e[e.UNEXPECTED_SETTINGS=3006]="UNEXPECTED_SETTINGS",e[e.INVALID_SETTINGS=3007]="INVALID_SETTINGS",e[e.UNEXPECTED_SIMPLE_BODY=3008]="UNEXPECTED_SIMPLE_BODY",e[e.UNEXPECTED_COMPLEX_BODY=3009]="UNEXPECTED_COMPLEX_BODY",e[e.INVALID_TABLE_CONTEXT=3010]="INVALID_TABLE_CONTEXT",e[e.UNKNOWN_TABLE_SETTING=3011]="UNKNOWN_TABLE_SETTING",e[e.DUPLICATE_TABLE_SETTING=3012]="DUPLICATE_TABLE_SETTING",e[e.INVALID_TABLEGROUP_CONTEXT=3013]="INVALID_TABLEGROUP_CONTEXT",e[e.INVALID_TABLEGROUP_ELEMENT_NAME=3014]="INVALID_TABLEGROUP_ELEMENT_NAME",e[e.DUPLICATE_TABLEGROUP_ELEMENT_NAME=3015]="DUPLICATE_TABLEGROUP_ELEMENT_NAME",e[e.DUPLICATE_TABLEGROUP_FIELD_NAME=3016]="DUPLICATE_TABLEGROUP_FIELD_NAME",e[e.INVALID_TABLEGROUP_FIELD=3017]="INVALID_TABLEGROUP_FIELD",e[e.EMPTY_TABLE=3018]="EMPTY_TABLE",e[e.INVALID_COLUMN=3019]="INVALID_COLUMN",e[e.INVALID_COLUMN_NAME=3020]="INVALID_COLUMN_NAME",e[e.UNKNOWN_COLUMN_SETTING=3021]="UNKNOWN_COLUMN_SETTING",e[e.INVALID_COLUMN_TYPE=3022]="INVALID_COLUMN_TYPE",e[e.DUPLICATE_COLUMN_NAME=3023]="DUPLICATE_COLUMN_NAME",e[e.DUPLICATE_COLUMN_SETTING=3024]="DUPLICATE_COLUMN_SETTING",e[e.INVALID_COLUMN_SETTING_VALUE=3025]="INVALID_COLUMN_SETTING_VALUE",e[e.INVALID_ENUM_CONTEXT=3026]="INVALID_ENUM_CONTEXT",e[e.INVALID_ENUM_ELEMENT_NAME=3027]="INVALID_ENUM_ELEMENT_NAME",e[e.INVALID_ENUM_ELEMENT=3028]="INVALID_ENUM_ELEMENT",e[e.DUPLICATE_ENUM_ELEMENT_NAME=3029]="DUPLICATE_ENUM_ELEMENT_NAME",e[e.UNKNOWN_ENUM_ELEMENT_SETTING=3030]="UNKNOWN_ENUM_ELEMENT_SETTING",e[e.DUPLICATE_ENUM_ELEMENT_SETTING=3031]="DUPLICATE_ENUM_ELEMENT_SETTING",e[e.INVALID_ENUM_ELEMENT_SETTING=3032]="INVALID_ENUM_ELEMENT_SETTING",e[e.EMPTY_ENUM=3033]="EMPTY_ENUM",e[e.INVALID_REF_CONTEXT=3034]="INVALID_REF_CONTEXT",e[e.UNKNOWN_REF_SETTING=3035]="UNKNOWN_REF_SETTING",e[e.DUPLICATE_REF_SETTING=3036]="DUPLICATE_REF_SETTING",e[e.INVALID_REF_SETTING_VALUE=3037]="INVALID_REF_SETTING_VALUE",e[e.INVALID_REF_RELATIONSHIP=3038]="INVALID_REF_RELATIONSHIP",e[e.INVALID_REF_FIELD=3039]="INVALID_REF_FIELD",e[e.EMPTY_REF=3040]="EMPTY_REF",e[e.REF_REDEFINED=3041]="REF_REDEFINED",e[e.INVALID_NOTE_CONTEXT=3042]="INVALID_NOTE_CONTEXT",e[e.INVALID_NOTE=3043]="INVALID_NOTE",e[e.NOTE_REDEFINED=3044]="NOTE_REDEFINED",e[e.NOTE_CONTENT_REDEFINED=3045]="NOTE_CONTENT_REDEFINED",e[e.EMPTY_NOTE=3046]="EMPTY_NOTE",e[e.INVALID_INDEXES_CONTEXT=3047]="INVALID_INDEXES_CONTEXT",e[e.INVALID_INDEXES_FIELD=3048]="INVALID_INDEXES_FIELD",e[e.INVALID_INDEX=3049]="INVALID_INDEX",e[e.UNKNOWN_INDEX_SETTING=3050]="UNKNOWN_INDEX_SETTING",e[e.DUPLICATE_INDEX_SETTING=3051]="DUPLICATE_INDEX_SETTING",e[e.UNEXPECTED_INDEX_SETTING_VALUE=3052]="UNEXPECTED_INDEX_SETTING_VALUE",e[e.INVALID_INDEX_SETTING_VALUE=3053]="INVALID_INDEX_SETTING_VALUE",e[e.INVALID_PROJECT_CONTEXT=3054]="INVALID_PROJECT_CONTEXT",e[e.PROJECT_REDEFINED=3055]="PROJECT_REDEFINED",e[e.INVALID_PROJECT_FIELD=3056]="INVALID_PROJECT_FIELD",e[e.INVALID_CUSTOM_CONTEXT=3057]="INVALID_CUSTOM_CONTEXT",e[e.INVALID_CUSTOM_ELEMENT_VALUE=3058]="INVALID_CUSTOM_ELEMENT_VALUE",e[e.INVALID_ELEMENT_IN_SIMPLE_BODY=3059]="INVALID_ELEMENT_IN_SIMPLE_BODY",e[e.INVALID_TABLE_PARTIAL_CONTEXT=3060]="INVALID_TABLE_PARTIAL_CONTEXT",e[e.INVALID_TABLE_PARTIAL_ELEMENT_NAME=3061]="INVALID_TABLE_PARTIAL_ELEMENT_NAME",e[e.INVALID_TABLE_PARTIAL_SETTING_VALUE=3062]="INVALID_TABLE_PARTIAL_SETTING_VALUE",e[e.DUPLICATE_TABLE_PARTIAL_ELEMENT_NAME=3063]="DUPLICATE_TABLE_PARTIAL_ELEMENT_NAME",e[e.DUPLICATE_TABLE_PARTIAL_SETTING=3064]="DUPLICATE_TABLE_PARTIAL_SETTING",e[e.INVALID_TABLE_PARTIAL_INJECTION=3065]="INVALID_TABLE_PARTIAL_INJECTION",e[e.INVALID_TABLE_PARTIAL_INJECTION_OP=3066]="INVALID_TABLE_PARTIAL_INJECTION_OP",e[e.INVALID_TABLE_PARTIAL_INJECTION_NAME=3067]="INVALID_TABLE_PARTIAL_INJECTION_NAME",e[e.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME=3068]="DUPLICATE_TABLE_PARTIAL_INJECTION_NAME",e[e.UNKNOWN_TABLE_PARTIAL_SETTING=3069]="UNKNOWN_TABLE_PARTIAL_SETTING",e[e.INVALID_TABLE_SETTING_VALUE=3070]="INVALID_TABLE_SETTING_VALUE",e[e.INVALID_CHECKS_CONTEXT=3071]="INVALID_CHECKS_CONTEXT",e[e.INVALID_CHECKS_FIELD=3072]="INVALID_CHECKS_FIELD",e[e.INVALID_CHECK=3073]="INVALID_CHECK",e[e.UNKNOWN_CHECK_SETTING=3074]="UNKNOWN_CHECK_SETTING",e[e.DUPLICATE_CHECK_SETTING=3075]="DUPLICATE_CHECK_SETTING",e[e.INVALID_CHECK_SETTING_VALUE=3076]="INVALID_CHECK_SETTING_VALUE",e[e.BINDING_ERROR=4e3]="BINDING_ERROR",e[e.UNSUPPORTED=5e3]="UNSUPPORTED",e[e.CIRCULAR_REF=5001]="CIRCULAR_REF",e[e.SAME_ENDPOINT=5002]="SAME_ENDPOINT",e[e.UNEQUAL_FIELDS_BINARY_REF=5003]="UNEQUAL_FIELDS_BINARY_REF",e[e.CONFLICTING_SETTING=5004]="CONFLICTING_SETTING",e[e.TABLE_REAPPEAR_IN_TABLEGROUP=5005]="TABLE_REAPPEAR_IN_TABLEGROUP",e))(N||{});class E extends Error{constructor(t,n,s){super(n),this.code=t,this.diagnostic=n,this.nodeOrToken=s,this.start=s.start,this.end=s.end,this.name=this.constructor.name,Object.setPrototypeOf(this,E.prototype)}}class lt{constructor(t,n){this.value=t,this.errors=n===void 0?[]:n}getValue(){return this.value}getErrors(){return this.errors}chain(t){const n=t(this.value),s=[...this.errors,...n.errors];return new lt(n.value,s)}map(t){return new lt(t(this.value),this.errors)}}function sE(e,t,n){if(!e||!dn(e)||t.length===0)return new ue;const s=[...t],r=al(e).unwrap(),i=s.pop();if(!(i instanceof jt))return new ue;const o=ge(s)instanceof xe?s.pop():void 0;if(s.length===3){const l=al(s[1]).value;return!l||!ei(l)?new ue:new Ce(n.create(ce,{type:r,name:s[0],as:l,alias:s[2],attributeList:o,body:i}))}return s.length===1?new Ce(n.create(ce,{type:r,name:s[0],attributeList:o,body:i})):s.length===0?new Ce(n.create(ce,{type:r,attributeList:o,body:i})):new ue}function ei(e){return e?.kind===w.IDENTIFIER&&e.value==="as"}function G(e){e&&(e instanceof ot?rE(e):aE(e))}function rE(e){e.kind!==w.EOF&&(e.isInvalid=!0)}function aE(e){if(e instanceof ce)G(e.type),G(e.name),G(e.as),G(e.alias),G(e.bodyColon),G(e.attributeList),G(e.body);else if(e instanceof Nt)e.identifiers.forEach(G);else if(e instanceof yt)G(e.name),G(e.colon),G(e.value);else if(e instanceof ft)G(e.op),G(e.expression);else if(e instanceof Ft)G(e.leftExpression),G(e.op),G(e.rightExpression);else if(e instanceof Yr)G(e.op),G(e.expression);else if(e instanceof jt)G(e.blockOpenBrace),e.body.forEach(G),G(e.blockCloseBrace);else if(e instanceof xe)G(e.listOpenBracket),e.commaList.forEach(G),e.elementList.forEach(G),G(e.listCloseBracket);else if(e instanceof Ut)G(e.tupleOpenParen),e.commaList.forEach(G),e.elementList.forEach(G),G(e.tupleCloseParen);else if(e instanceof mt)G(e.callee),G(e.argumentList);else if(e instanceof re)G(e.callee),e.args.forEach(G);else if(e instanceof We)G(e.expression);else if(e instanceof pt)G(e.value);else if(e instanceof Ct)G(e.variable);else if(e instanceof gs)G(e.literal);else throw e instanceof wi?new Error("This case is handled by the TupleExpressionNode case"):new Error("Unreachable case in markInvalidNode")}function Ld(e){return!!(e!=null&&e.isInvalid)}function Be(...e){return e.filter(t=>t!==void 0)}function iE(e){if(e instanceof ht)return Be(...e.body,e.eof);if(e instanceof ce)return Be(e.type,e.name,e.as,e.alias,e.attributeList,e.bodyColon,e.body);if(e instanceof yt)return Be(e.name,e.colon,e.value);if(e instanceof Nt)return e.identifiers;if(e instanceof gs)return e.literal?[e.literal]:[];if(e instanceof Ct)return Be(e.variable);if(e instanceof ft)return Be(e.op,e.expression);if(e instanceof Ft)return Be(e.leftExpression,e.op,e.rightExpression);if(e instanceof Yr)return Be(e.expression,e.op);if(e instanceof pt)return Be(e.value);if(e instanceof re)return Be(e.callee,...e.args);if(e instanceof jt)return Be(e.blockOpenBrace,...e.body,e.blockCloseBrace);if(e instanceof xe)return Be(e.listOpenBracket,...rl(e.elementList,e.commaList),e.listCloseBracket);if(e instanceof Ut)return Be(e.tupleOpenParen,...rl(e.elementList,e.commaList),e.tupleCloseParen);if(e instanceof mt)return Be(e.callee,e.argumentList);if(e instanceof We)return Be(e.expression);if(e instanceof Ln)return Be(e.array,e.indexer);if(e instanceof kn)return Be(e.partial);throw e instanceof wi?new Error("This case is already handled by TupleExpressionNode"):new Error("Unreachable - no other possible cases")}function al(e){return Oe(e)?new Ce(e.expression.variable):new ue}function Ge(e){var t;return e instanceof We&&(e.expression instanceof Ct&&e.expression.variable instanceof ot&&e.expression.variable.kind===w.QUOTED_STRING||e.expression instanceof gs&&((t=e.expression.literal)==null?void 0:t.kind)===w.STRING_LITERAL)}function Oe(e){return e instanceof We&&e.expression instanceof Ct&&e.expression.variable instanceof ot}function dn(e){var t;return e instanceof We&&e.expression instanceof Ct&&((t=e.expression.variable)==null?void 0:t.kind)===w.IDENTIFIER}function Zr(e){var t;return e instanceof Ft&&e.leftExpression instanceof ve&&e.rightExpression instanceof ve&&((t=e.op)==null?void 0:t.value)==="."}function Di(e){return Oe(e)?!0:Zr(e)&&Oe(e.rightExpression)&&Di(e.leftExpression)}function Qn(e){if(e===void 0)return new ue;const t=e.identifiers.map(n=>n.value).join(" ");return t===""?new ue:new Ce(t)}class oE{constructor(t){this.start={offset:0,line:0,column:0},this.current={offset:0,line:0,column:0},this.tokens=[],this.errors=[],this.text=t}isAtEnd(){return this.current.offset>=this.text.length}advance(){const t=this.peek();return this.current={...this.current},t===`
`?(this.current.line+=1,this.current.column=0):this.current.column+=1,this.current.offset+=1,t}peek(t=0){if(!(this.current.offset+t>=this.text.length))return this.text[this.current.offset+t]}check(t){for(let n=0;n<t.length;n+=1)if(t[n]!==this.peek(n))return!1;return!0}match(t){return this.check(t)?(t.split("").forEach(()=>this.advance()),!0):!1}addToken(t,n=!1){this.tokens.push(this.createToken(t,n))}createToken(t,n=!1){return ot.create(t,this.start,this.current,this.text.substring(this.start.offset,this.current.offset),n)}lex(){return this.scanTokens(),this.tokens.push(ot.create(w.EOF,this.start,this.current,"",!1)),this.gatherTrivia(),this.gatherInvalid(),new lt(this.tokens,this.errors)}scanTokens(){for(;!this.isAtEnd();){const t=this.advance();switch(t){case" ":this.addToken(w.SPACE);break;case"\r":break;case`
`:this.addToken(w.NEWLINE);break;case"	":this.addToken(w.TAB);break;case",":this.addToken(w.COMMA);break;case"(":this.addToken(w.LPAREN);break;case")":this.addToken(w.RPAREN);break;case"[":this.addToken(w.LBRACKET);break;case"]":this.addToken(w.RBRACKET);break;case"{":this.addToken(w.LBRACE);break;case"}":this.addToken(w.RBRACE);break;case";":this.addToken(w.SEMICOLON);break;case":":this.addToken(w.COLON);break;case"~":this.addToken(w.TILDE);break;case"'":this.match("''")?this.multilineStringLiteral():this.singleLineStringLiteral();break;case'"':this.quotedVariable();break;case"`":this.functionExpression();break;case"#":this.colorLiteral();break;case"/":this.match("/")?this.singleLineComment():this.match("*")?this.multilineComment():this.operator(t);break;default:if(Uy(t)){this.operator(t);break}if(Jr(t)){this.identifier();break}if(Er(t)){this.numericLiteralOrIdentifier();break}this.addToken(w.OP,!0),this.errors.push(new E(N.UNKNOWN_SYMBOL,`Unexpected token '${t}'`,this.createToken(w.OP,!0)));break}this.start={...this.current}}}gatherTrivia(){let t=!0,n=[],s;const r=[];for(const i of this.tokens)Fy(i)?(n.push(i),i.kind===w.NEWLINE&&s&&(s.trailingTrivia=n,t=!0,s=void 0,n=[])):(t?i.leadingTrivia=n:s.trailingTrivia=n,r.push(i),n=[],s=i,t=!1);this.tokens=r}gatherInvalid(){let t;const n=[],s=[];for(t=0;t<this.tokens.length&&Ld(this.tokens[t]);t+=1)s.push(this.tokens[t]);let r=this.tokens[t];for(r.leadingInvalid=[...s,...r.leadingInvalid];t<this.tokens.length;t+=1){const i=this.tokens[t];i.isInvalid?r.trailingInvalid.push(i):(r=i,n.push(i))}this.tokens=n}consumeUntil(t,n,{allowNewline:s,allowEof:r,raw:i,consumeStopSequence:o=!0}){let l="";for(;!this.isAtEnd()&&(s||!this.check(`
`))&&!this.check(n);)this.peek()==="\\"&&!i?(this.advance(),l+=this.escapedString()):l+=this.advance();if(this.isAtEnd()&&!r){const c=this.createToken(t,!0);this.tokens.push(c),this.errors.push(new E(N.UNEXPECTED_EOF,"EOF reached while parsing",c));return}if(this.check(`
`)&&!s){const c=this.createToken(t,!0);this.tokens.push(c),this.errors.push(new E(N.UNEXPECTED_NEWLINE,"Invalid newline encountered while parsing",c));return}o&&this.match(n),this.tokens.push(ot.create(t,this.start,this.current,l,!1))}singleLineStringLiteral(){this.consumeUntil(w.STRING_LITERAL,"'",{allowNewline:!1,allowEof:!1,raw:!1})}multilineStringLiteral(){this.consumeUntil(w.STRING_LITERAL,"'''",{allowNewline:!0,allowEof:!1,raw:!1})}functionExpression(){this.consumeUntil(w.FUNCTION_EXPRESSION,"`",{allowNewline:!0,allowEof:!1,raw:!0})}quotedVariable(){this.consumeUntil(w.QUOTED_STRING,'"',{allowNewline:!1,allowEof:!1,raw:!1})}singleLineComment(){this.consumeUntil(w.SINGLE_LINE_COMMENT,`
`,{allowNewline:!0,allowEof:!0,raw:!0,consumeStopSequence:!1})}multilineComment(){this.consumeUntil(w.MULTILINE_COMMENT,"*/",{allowNewline:!0,allowEof:!1,raw:!0})}identifier(){for(;!this.isAtEnd()&&zn(this.peek());)this.advance();this.addToken(w.IDENTIFIER)}operator(t){switch(t){case"<":[">","="].includes(this.peek())&&this.advance();break;case">":this.peek()==="="&&this.advance();break;case"=":this.peek()==="="&&this.advance();break;case"!":this.peek()==="="&&this.advance();break}this.addToken(w.OP)}numericLiteralOrIdentifier(){let t=0;if(this.isAtEnd())return this.addToken(w.NUMERIC_LITERAL);for(;!this.isAtEnd();){const n=this.check(".");if(t+=n?1:0,t>1)break;if(!n&&this.current.offset===this.text.length-1)return this.advance(),this.addToken(w.NUMERIC_LITERAL);if(!n&&!zn(this.peek()))return this.addToken(w.NUMERIC_LITERAL);if(!n&&!Er(this.peek()))break;this.advance()}if(t>0){for(;!this.isAtEnd()&&(this.check(".")||zn(this.peek()));)this.advance();const n=this.createToken(w.NUMERIC_LITERAL,!0);this.tokens.push(n),this.errors.push(new E(N.UNKNOWN_TOKEN,"Invalid number",n))}else{for(;!this.isAtEnd()&&zn(this.peek());)this.advance();const n=this.createToken(w.IDENTIFIER,!1);this.tokens.push(n)}}colorLiteral(){for(;!this.isAtEnd()&&zn(this.peek());)this.advance();this.addToken(w.COLOR_LITERAL)}escapedString(){const t={column:this.current.column-1,offset:this.current.offset-1,line:this.current.line};if(this.isAtEnd())return"\\";switch(this.advance()){case"\r":return this.check(`
`)&&this.advance(),"";case`
`:return"";case"t":return"	";case"n":return`
`;case"\\":return"\\";case"r":return"\r";case"'":return"'";case'"':return'"';case"`":return"`";case"0":return"\0";case"b":return"\b";case"v":return"\v";case"f":return"\f";case" ":return"\\ ";case"u":{let n="";for(let s=0;s<=3;s+=1){if(this.isAtEnd()||!zn(this.peek()))return this.errors.push(new E(N.INVALID_ESCAPE_SEQUENCE,`Invalid unicode escape sequence '\\u${n}', only unicode escape sequences of the form '\\uHHHH' where H is a hexadecimal number are allowed`,ot.create(w.STRING_LITERAL,t,this.current,`\\u${n}`,!0))),`\\u${n}`;n+=this.advance()}return String.fromCharCode(parseInt(n,16))}default:return this.text[this.current.offset-1]}}}var cr=(e=>(e[e.ListExpression=0]="ListExpression",e[e.GroupExpression=1]="GroupExpression",e[e.BlockExpression=2]="BlockExpression",e))(cr||{});class lE{constructor(){this.stack=[],this.numberOfNestedLParens=0,this.numberOfNestedLBrackets=0,this.numberOfNestedLBraces=0}push(t){this.stack.push(t),t===0&&(this.numberOfNestedLBrackets+=1),t===1&&(this.numberOfNestedLParens+=1),t===2&&(this.numberOfNestedLBraces+=1)}pop(){const t=this.stack.pop();return t===0&&(this.numberOfNestedLBrackets-=1),t===1&&(this.numberOfNestedLParens-=1),t===2&&(this.numberOfNestedLBraces-=1),t}top(){return ge(this.stack)}isWithinGroupExpressionContext(){return this.numberOfNestedLParens>0}isWithinListExpressionContext(){return this.numberOfNestedLBrackets>0}isWithinBlockExpressionContext(){return this.numberOfNestedLBraces>0}withContextDo(t,n){return()=>{this.push(t);try{return n()}finally{this.pop()}}}findHandlerContext(t,n){if(!(this.numberOfNestedLBraces<=0&&this.numberOfNestedLBrackets<=0&&this.numberOfNestedLParens<=0))for(let s=n;s<t.length-1;s+=1)switch(t[s].kind){case w.COMMA:if(this.isWithinGroupExpressionContext()||this.isWithinListExpressionContext())return[...this.stack].reverse().find(r=>[1,0].includes(r));break;case w.RPAREN:if(this.isWithinGroupExpressionContext())return 1;break;case w.RBRACE:if(this.isWithinBlockExpressionContext())return 2;break;case w.RBRACKET:if(this.isWithinListExpressionContext())return 0;break}}}class cE{constructor(t){this.generator=t}create(t,n){return new t(n,this.generator.nextId())}}class O{constructor(t,n,s){this.token=t,this.partialNode=n,this.handlerContext=s}}class dE{constructor(t,n){this.current=0,this.errors=[],this.contextStack=new lE,this.synchronizeProgram=()=>{const s=this.peek();s.kind!==w.EOF?G(this.advance()):(G(this.peek()),this.logError(s,N.UNEXPECTED_EOF,"Unexpected EOF"))},this.synchronizeElementDeclarationName=()=>{for(;!this.isAtEnd();){const s=this.peek();if(ei(s)||this.check(w.COLON,w.LBRACE,w.LBRACKET))break;G(s),this.advance()}},this.synchronizeElementDeclarationAlias=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(w.COLON,w.LBRACE,w.LBRACKET))break;G(s),this.advance()}},this.blockExpression=this.contextStack.withContextDo(cr.BlockExpression,()=>{const s={body:[]},r=()=>this.nodeFactory.create(jt,s);try{this.consume("Expect an opening brace '{'",w.LBRACE),s.blockOpenBrace=this.previous()}catch(i){if(!(i instanceof O))throw i;if(s.blockOpenBrace=i.partialNode,!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeBlock()}for(;!this.isAtEnd()&&!this.check(w.RBRACE);)try{if(this.match(w.TILDE)){const i=this.previous(),o=this.variable(),l=this.nodeFactory.create(kn,{op:i,partial:o});s.body.push(l)}else s.body.push(this.canBeField()?this.fieldDeclaration():this.expression())}catch(i){if(!(i instanceof O))throw i;if(s.body.push(i.partialNode),!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeBlock()}try{this.consume("Expect a closing brace '}'",w.RBRACE),s.blockCloseBrace=this.previous()}catch(i){if(!(i instanceof O))throw i;if(s.blockCloseBrace=i.partialNode,!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeBlock()}return r()}),this.synchronizeBlock=()=>{if(!this.check(w.RBRACE))for(G(this.advance());!this.isAtEnd();){const s=this.peek();if(this.check(w.RBRACE)||sl(this.previous(),s))break;G(s),this.advance()}},this.tupleExpression=this.contextStack.withContextDo(cr.GroupExpression,()=>{const s={elementList:[],commaList:[]},r=()=>this.nodeFactory.create(wi,{groupOpenParen:s.tupleOpenParen,groupCloseParen:s.tupleCloseParen,expression:s.elementList[0]}),i=()=>this.nodeFactory.create(Ut,s);try{this.consume("Expect an opening parenthesis '('",w.LPAREN),s.tupleOpenParen=this.previous()}catch(o){if(!(o instanceof O))throw o;if(s.tupleOpenParen=o.partialNode,!this.canHandle(o))throw new O(o.token,i(),o.handlerContext);this.synchronizeTuple()}if(!this.isAtEnd()&&!this.check(w.RPAREN))try{s.elementList.push(this.normalExpression())}catch(o){if(!(o instanceof O))throw o;if(s.elementList.push(o.partialNode),!this.canHandle(o))throw new O(o.token,r(),o.handlerContext);this.synchronizeTuple()}for(;!this.isAtEnd()&&!this.check(w.RPAREN);)try{this.consume("Expect a comma ','",w.COMMA),s.commaList.push(this.previous()),s.elementList.push(this.normalExpression())}catch(o){if(!(o instanceof O))throw o;if(o.partialNode instanceof ve&&s.elementList.push(o.partialNode),!this.canHandle(o))throw new O(o.token,i(),o.handlerContext);this.synchronizeTuple()}try{this.consume("Expect a closing parenthesis ')'",w.RPAREN),s.tupleCloseParen=this.previous()}catch(o){if(!(o instanceof O))throw o;if(s.tupleCloseParen=o.partialNode,!this.canHandle(o))throw new O(o.token,i(),o.handlerContext);this.synchronizeTuple()}return s.elementList.length===1?r():i()}),this.synchronizeTuple=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(w.RPAREN,w.COMMA))break;G(s),this.advance()}},this.listExpression=this.contextStack.withContextDo(cr.ListExpression,()=>{const s={elementList:[],commaList:[]},r=()=>this.nodeFactory.create(xe,s);try{this.consume("Expect an opening bracket '['",w.LBRACKET),s.listOpenBracket=this.previous()}catch(i){if(!(i instanceof O))throw i;if(s.listOpenBracket=i.partialNode,!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeList()}if(!this.isAtEnd()&&!this.check(w.RBRACKET))try{s.elementList.push(this.attribute())}catch(i){if(!(i instanceof O))throw i;if(s.elementList.push(i.partialNode),!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeList()}for(;!this.isAtEnd()&&!this.check(w.RBRACKET);)try{this.consume("Expect a comma ','",w.COMMA),s.commaList.push(this.previous()),s.elementList.push(this.attribute())}catch(i){if(!(i instanceof O))throw i;if(i.partialNode instanceof ve&&s.elementList.push(i.partialNode),!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeList()}try{this.consume("Expect a closing bracket ']'",w.RBRACKET),s.listCloseBracket=this.previous()}catch(i){if(!(i instanceof O))throw i;if(s.listCloseBracket=i.partialNode,!this.canHandle(i))throw new O(i.token,r(),i.handlerContext);this.synchronizeList()}return r()}),this.synchronizeList=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(w.COMMA,w.RBRACKET))break;G(s),this.advance()}},this.synchronizeAttributeName=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(w.COMMA,w.RBRACKET,w.COLON))break;G(s),this.advance()}},this.synchronizeAttributeValue=()=>{for(;!this.isAtEnd();){const s=this.peek();if(this.check(w.COMMA,w.RBRACKET))break;G(s),this.advance()}},this.tokens=t,this.nodeFactory=new cE(n)}isAtEnd(){return this.current>=this.tokens.length||this.tokens[this.current].kind===w.EOF}advance(){return this.isAtEnd()?ge(this.tokens):this.tokens[this.current++]}peek(t=0){return t+this.current>=this.tokens.length?ge(this.tokens):this.tokens[this.current+t]}match(...t){const n=this.check(...t);return n&&this.advance(),n}check(...t){const n=this.peek();return t.includes(n.kind)}previous(){return this.tokens[this.current-1]}canHandle(t){return t.handlerContext===void 0||t.handlerContext===this.contextStack.top()}consume(t,...n){if(!this.match(...n))throw this.logError(this.peek(),N.UNEXPECTED_TOKEN,t),new O(this.peek(),void 0,this.contextStack.findHandlerContext(this.tokens,this.current))}discardUntil(t,...n){if(this.isAtEnd()||!this.check(...n)){for(G(this.peek()),this.logError(this.advance(),N.UNEXPECTED_TOKEN,t);!this.isAtEnd()&&!this.check(...n);)G(this.advance());return!this.isAtEnd()}return!0}gatherInvalid(){const t=[],n=[];let s,r=0;for(;r<this.tokens.length&&this.tokens[r].isInvalid;r+=1)n.push(this.tokens[r]);for(s=this.tokens[r],s.leadingInvalid=n,t.push(s),r+=1;r<this.tokens.length;r+=1){const i=this.tokens[r];i.isInvalid?s.trailingInvalid.push(i):(s=i,t.push(s))}this.tokens=t}parse(){const t=this.program(),n=this.advance(),s=this.nodeFactory.create(ht,{body:t,eof:n});return this.gatherInvalid(),new lt({ast:s,tokens:this.tokens},this.errors)}program(){const t=[];for(;!this.isAtEnd();)try{const n=this.elementDeclaration();t.push(n)}catch(n){if(!(n instanceof O))throw n;t.push(n.partialNode),this.synchronizeProgram()}return t}elementDeclaration(){const t={},n=()=>this.nodeFactory.create(ce,t);try{this.consume("Expect an identifier",w.IDENTIFIER),t.type=this.previous()}catch(s){throw s instanceof O?(t.type=s.partialNode,new O(s.token,n(),s.handlerContext)):s}if(!this.check(w.COLON,w.LBRACE,w.LBRACKET))try{t.name=this.normalExpression()}catch(s){if(!(s instanceof O))throw s;if(t.name=s.partialNode,!this.canHandle(s))throw new O(s.token,n(),s.handlerContext);this.synchronizeElementDeclarationName()}if(ei(this.peek()))if(t.as=this.advance(),this.check(w.COLON,w.LBRACE,w.LBRACKET))this.logError(this.peek(),N.UNEXPECTED_TOKEN,"Expect an alias");else try{t.alias=this.normalExpression()}catch(s){if(!(s instanceof O))throw s;if(t.alias=s.partialNode,!this.canHandle(s))throw new O(s.token,n(),s.handlerContext);this.synchronizeElementDeclarationAlias()}try{t.attributeList=this.check(w.LBRACKET)?this.listExpression():void 0}catch(s){throw s instanceof O?(t.attributeList=s.partialNode,new O(s.token,n(),s.handlerContext)):s}if(!this.discardUntil("Expect an opening brace '{' or a colon ':'",w.LBRACE,w.COLON))return n();try{if(this.match(w.COLON)){t.bodyColon=this.previous();const s=this.expression();s instanceof ce?(G(s),this.logError(s,N.UNEXPECTED_ELEMENT_DECLARATION,"An element's simple body must not be an element declaration")):t.body=s}else t.body=this.blockExpression()}catch(s){throw s instanceof O?(t.body=s.partialNode,new O(s.token,n(),s.handlerContext)):s}return this.nodeFactory.create(ce,t)}fieldDeclaration(){const t={},n=()=>this.nodeFactory.create(ce,t);try{this.consume("Expect an identifier",w.IDENTIFIER),t.type=this.previous()}catch(s){throw s instanceof O?(t.type=s.partialNode,new O(s.token,n(),s.handlerContext)):s}try{this.consume("Expect a colon ':'",w.COLON),t.bodyColon=this.previous()}catch(s){throw s instanceof O?(t.bodyColon=s.partialNode,new O(s.token,n(),s.handlerContext)):s}try{const s=this.expression();s instanceof ce?this.errors.push(new E(N.INVALID_ELEMENT_IN_SIMPLE_BODY,"Simple body cannot be an element declaration",s)):t.body=s}catch(s){throw s instanceof O?(t.body=s.partialNode,new O(s.token,n(),s.handlerContext)):s}return this.nodeFactory.create(ce,t)}expression(){const t={args:[]},n=()=>sE(t.callee,t.args,this.nodeFactory).unwrap_or(this.nodeFactory.create(re,t));try{t.callee=this.normalExpression()}catch(r){throw r instanceof O?(t.callee=r.partialNode,new O(r.token,n(),r.handlerContext)):r}if(this.shouldStopExpression())return n();let s=t.callee;for(;!this.shouldStopExpression();){Ja(this.previous())||this.logError(s,N.MISSING_SPACES,"Expect a following space");try{s=this.normalExpression(),t.args.push(s)}catch(r){throw r instanceof O?(s=r.partialNode,t.args.push(s),new O(r.token,n(),r.handlerContext)):r}}return n()}shouldStopExpression(){if(this.isAtEnd()||_d(this.previous()))return!0;const t=this.peek().kind;return t===w.RBRACE||t===w.RBRACKET||t===w.RPAREN||t===w.COMMA||t===w.COLON}normalExpression(){return this.expression_bp(0)}expression_bp(t){let n=this.leftExpression_bp();for(;!this.isAtEnd();){const s=this.peek();if(s.kind===w.LPAREN){const{left:r}=il(s);if(r<t||sl(this.previous(),s)&&!this.contextStack.isWithinGroupExpressionContext()&&!this.contextStack.isWithinListExpressionContext())break;try{n=this.nodeFactory.create(mt,{callee:n,argumentList:this.tupleExpression()})}catch(i){throw i instanceof O?(n=this.nodeFactory.create(mt,{callee:n,argumentList:i.partialNode}),new O(i.token,n,i.handlerContext)):i}}else if(s.kind===w.LBRACKET){if(Ja(this.previous()))break;try{n=this.nodeFactory.create(Ln,{expression:n,indexer:this.listExpression()})}catch(r){throw r instanceof O?(n=this.nodeFactory.create(Ln,{expression:n,indexer:r.partialNode}),new O(r.token,n,r.handlerContext)):r}}else if(nl(s)){const r=s,i=il(r);if(i.left!==null){if(i.left<=t)break;this.advance(),n=this.nodeFactory.create(Yr,{expression:n,op:r})}else{const o=hE(r);if(o.left===null||o.left<=t)break;this.advance();try{n=this.nodeFactory.create(Ft,{leftExpression:n,op:r,rightExpression:r.value==="."?this.extractOperand():this.expression_bp(o.right)})}catch(l){throw l instanceof O?(n=this.nodeFactory.create(Ft,{leftExpression:n,op:r,rightExpression:l.partialNode}),new O(l.token,n,l.handlerContext)):l}}}else break}return n}leftExpression_bp(){let t;if(nl(this.peek())){const n={};n.op=this.peek();const s=pE(n.op);if(s.right===null)throw this.logError(n.op,N.UNKNOWN_PREFIX_OP,`Unexpected '${n.op.value}' in an expression`),new O(n.op,this.nodeFactory.create(ar,{pre:n.op}),this.contextStack.findHandlerContext(this.tokens,this.current));this.advance();try{n.expression=this.expression_bp(s.right)}catch(r){throw r instanceof O?(n.expression=r.partialNode,new O(r.token,this.nodeFactory.create(ft,n),r.handlerContext)):r}t=this.nodeFactory.create(ft,n)}else if(t=this.extractOperand(),t instanceof ar)throw new O(this.peek(),this.nodeFactory.create(ar,{pre:this.peek()}),this.contextStack.findHandlerContext(this.tokens,this.current));return t}extractOperand(){return this.check(w.NUMERIC_LITERAL,w.STRING_LITERAL,w.COLOR_LITERAL,w.QUOTED_STRING,w.IDENTIFIER)?this.primaryExpression():this.check(w.FUNCTION_EXPRESSION)?this.functionExpression():this.check(w.LBRACKET)?this.listExpression():this.check(w.LBRACE)?this.blockExpression():this.check(w.LPAREN)?this.tupleExpression():(this.peek().kind===w.EOF?this.logError(this.peek(),N.UNEXPECTED_EOF,"Unexpected EOF"):this.logError(this.peek(),N.INVALID_OPERAND,`Invalid start of operand "${this.peek().value}"`),this.nodeFactory.create(ar,{pre:this.previous()}))}functionExpression(){const t={};try{this.consume("Expect a function expression",w.FUNCTION_EXPRESSION),t.value=this.previous()}catch(n){throw n instanceof O?(t.value=n.partialNode,new O(n.token,this.nodeFactory.create(pt,t),n.handlerContext)):n}return this.nodeFactory.create(pt,t)}variable(){this.consume("Expect a variable",w.IDENTIFIER);const t=this.previous();return this.nodeFactory.create(Ct,{variable:t})}canBeField(){return this.peek().kind===w.IDENTIFIER&&this.peek(1).kind===w.COLON}primaryExpression(){if(this.match(w.COLOR_LITERAL,w.STRING_LITERAL,w.NUMERIC_LITERAL))return this.nodeFactory.create(We,{expression:this.nodeFactory.create(gs,{literal:this.previous()})});if(this.match(w.QUOTED_STRING,w.IDENTIFIER))return this.nodeFactory.create(We,{expression:this.nodeFactory.create(Ct,{variable:this.previous()})});throw this.logError(this.peek(),N.UNEXPECTED_TOKEN,"Expect a variable or literal"),new O(this.peek(),void 0,this.contextStack.findHandlerContext(this.tokens,this.current))}attribute(){const t={};if(this.check(w.COLON,w.RBRACKET,w.COMMA)){const n=this.peek();this.logError(n,N.EMPTY_ATTRIBUTE_NAME,"Expect a non-empty attribute name"),t.name=this.nodeFactory.create(Nt,{identifiers:[]})}else try{t.name=this.attributeName()}catch(n){if(!(n instanceof O))throw n;if(t.name=n.partialNode,!this.canHandle(n))throw new O(n.token,this.nodeFactory.create(yt,t),n.handlerContext);this.synchronizeAttributeName()}return this.match(w.COLON)&&(t.colon=this.previous(),t.value=this.attributeValue()),this.nodeFactory.create(yt,t)}attributeValue(){let t;try{t=this.peek().kind===w.IDENTIFIER&&this.peek(1).kind===w.IDENTIFIER?this.attributeName():this.normalExpression()}catch(n){if(!(n instanceof O)||!this.canHandle(n))throw n;t=n.partialNode,this.synchronizeAttributeValue()}return t}attributeName(){const t=[];if(this.peek().kind!==w.IDENTIFIER)return this.primaryExpression();for(;!this.isAtEnd()&&!this.check(w.COLON,w.COMMA,w.RBRACKET);)try{this.consume("Expect an identifier",w.IDENTIFIER),t.push(this.previous())}catch(n){throw n instanceof O?new O(n.token,this.nodeFactory.create(Nt,{identifiers:t}),n.handlerContext):n}return this.nodeFactory.create(Nt,{identifiers:t})}logError(t,n,s){this.errors.push(new E(n,s,t))}}const uE={"+":{left:9,right:10},"*":{left:11,right:12},"-":{left:9,right:10},"/":{left:11,right:12},"%":{left:11,right:12},"<":{left:7,right:8},"<=":{left:7,right:8},">":{left:7,right:8},">=":{left:7,right:8},"<>":{left:7,right:8},"=":{left:2,right:3},"==":{left:4,right:5},"!=":{left:4,right:5},".":{left:16,right:17}};function hE(e){return uE[e.value]||{left:null,right:null}}const fE={"+":{left:null,right:15},"-":{left:null,right:15},"<":{left:null,right:15},">":{left:null,right:15},"<>":{left:null,right:15},"!":{left:null,right:15}};function pE(e){return fE[e.value]||{left:null,right:null}}const mE={"(":{left:14,right:null}};function il(e){return mE[e.value]||{left:null,right:null}}var $=(e=>(e.Table="table",e.Enum="enum",e.Ref="ref",e.Note="note",e.Project="project",e.Indexes="indexes",e.TableGroup="tablegroup",e.TablePartial="tablepartial",e.Check="checks",e))($||{}),A=(e=>(e.Color="color",e.HeaderColor="headercolor",e.Note="note",e.PK="pk",e.PrimaryKey="primary key",e.Unique="unique",e.Ref="ref",e.NotNull="not null",e.Null="null",e.Increment="increment",e.Default="default",e.Name="name",e.Type="type",e.Check="check",e.Update="update",e.Delete="delete",e))(A||{});function un(e){var t;const n=(t=e?.type)==null?void 0:t.value.toLowerCase();switch(n){case $.Enum:case $.Table:case $.Indexes:case $.Note:case $.Project:case $.Ref:case $.TableGroup:case $.TablePartial:case $.Check:return new Ce(n);default:return new ue}}function Wt(e){if(!e)return new ue;if(!Zr(e))return new Ce([e]);const t=Wt(e.leftExpression).unwrap_or(void 0);return t?(t.push(e.rightExpression),new Ce(t)):new ue}function Ze(e){if(e===void 0)return new ue;const t=Wt(e).unwrap_or(void 0);if(!t)return new ue;const n=[];for(const s of t){const r=Xe(s).unwrap_or(void 0);if(!r)return new ue;n.push(r)}return new Ce(n)}function $s(e){if(e===void 0)return new ue;const t=Wt(e).unwrap_or(void 0);if(!t||t.length===0)return new ue;const n=[];let s;if(!Oe(ge(t))){const r=t.pop();if(Od(r))s=r.elementList.map(i=>$e(i).unwrap());else return new ue}for(const r of t){const i=Xe(r).unwrap_or(void 0);if(!i)return new ue;n.push(i)}return new Ce({variables:n,tupleElements:s})}function Xe(e){return Oe(e)?new Ce(e.expression.variable.value):new ue}function _r(e){if(ol(e))return e instanceof pt?new Ce({functional:[e],nonFunctional:[]}):new Ce({functional:[],nonFunctional:[e]});if(e instanceof Ut&&e.elementList.every(ol)){const t=e.elementList.filter(s=>s instanceof pt),n=e.elementList.filter(Oe);return new Ce({functional:t,nonFunctional:n})}return new ue}function $e(e){var t;const n=(t=e?.expression.variable)==null?void 0:t.value;return n===void 0?new ue:new Ce(n)}function bE(e){var t,n;const s=(n=(t=e?.partial)==null?void 0:t.variable)==null?void 0:n.value;return s===void 0?new ue:new Ce(s)}function Le(e){return Ge(e)?e.expression instanceof Ct?new Ce(e.expression.variable.value):new Ce(e.expression.literal.value):new ue}function xE(e){var t;return!(e instanceof Ft)||!Dd((t=e.op)==null?void 0:t.value)?!1:$s(e.leftExpression).and_then(()=>$s(e.rightExpression)).unwrap_or(void 0)!==void 0}function gE(e){const t=$s(e.leftExpression),n=$s(e.rightExpression);if(!t.isOk()||!n.isOk())return!1;const{tupleElements:s}=t.unwrap(),{tupleElements:r}=n.unwrap();return s?.length===r?.length}function ol(e){return e instanceof We&&e.expression instanceof Ct||e instanceof pt}function ll(e,t){var n,s,r,i;let o=t;const l=Gy(e);for(;o;){if((s=(n=o.symbol)==null?void 0:n.symbolTable)!=null&&s.has(e))return(r=o.symbol.symbolTable)==null?void 0:r.get(e);if(((i=o.symbol)==null?void 0:i.declaration)instanceof ht&&l)return o.symbol;if(o instanceof ht)return;o=o.parent}}class vE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ht||un(this.declarationNode.parent).unwrap_or(void 0)!==$.Project?[new E(N.INVALID_CUSTOM_CONTEXT,"A Custom element can only appear in a Project",this.declarationNode)]:[]}validateName(t){return t?[new E(N.UNEXPECTED_NAME,"A Custom element shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(N.UNEXPECTED_NAME,"A Custom element shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"A Custom element shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof jt)return[new E(N.UNEXPECTED_COMPLEX_BODY,"A Custom element can only have an inline field",t)];const n=[];return Ge(t.callee)||n.push(new E(N.INVALID_CUSTOM_ELEMENT_VALUE,"A Custom element value can only be a string",t)),t.args.length>0&&n.push(...t.args.map(s=>new E(N.INVALID_CUSTOM_ELEMENT_VALUE,"A Custom element value can only be a string",s))),n}}class vs{constructor(){this.table=new Map}has(t){return this.table.has(t)}set(t,n){this.table.set(t,n)}get(t,n){return this.table.get(t)||n!==void 0&&this.set(t,n)||n}entries(){return this.table.entries()}forEach(t){return this.table.forEach(t)}}class NE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ce?[new E(N.INVALID_PROJECT_CONTEXT,"An Enum can only appear top-level",this.declarationNode)]:[]}validateName(t){return t?Ad(t)?[]:[new E(N.INVALID_NAME,"An Enum name must be of the form <enum> or <schema>.<enum>",t)]:[new E(N.NAME_NOT_FOUND,"An Enum must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"An Enum shouldn't have an alias",t)]:[]}registerElement(){const t=[];this.declarationNode.symbol=this.symbolFactory.create(Wy,{declaration:this.declarationNode,symbolTable:new vs});const{name:n}=this.declarationNode,s=Ze(n);if(s.isOk()){const r=s.unwrap(),i=r.pop(),o=ea(r,this.publicSymbolTable,this.symbolFactory),l=Ii(i);o.has(l)&&t.push(new E(N.DUPLICATE_NAME,`Enum name ${i} already exists in schema '${r.join(".")||"public"}'`,n)),o.set(l,this.declarationNode.symbol)}return t}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"An Enum shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return this.validateFields([t]);const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.length===0?[new E(N.EMPTY_ENUM,"An Enum must have at least one element",this.declarationNode)]:t.flatMap(n=>{const s=[];n.callee&&!Oe(n.callee)&&s.push(new E(N.INVALID_ENUM_ELEMENT_NAME,"An enum field must be an identifier or a quoted identifier",n.callee));const r=[...n.args];return ge(r)instanceof xe?(s.push(...this.validateFieldSettings(ge(r))),r.pop()):r[0]instanceof xe&&(s.push(...this.validateFieldSettings(r[0])),r.shift()),r.length>0&&s.push(...r.map(i=>new E(N.INVALID_ENUM_ELEMENT,"An Enum must have only a field and optionally a setting list",i))),s.push(...this.registerField(n)),s})}validateFieldSettings(t){const n=we(t),s=n.getErrors(),r=n.getValue();for(const i in r){const o=r[i];i==="note"?(o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_ENUM_ELEMENT_SETTING,"'note' can only appear once",l))),o.forEach(l=>{Ge(l.value)||s.push(new E(N.INVALID_ENUM_ELEMENT_SETTING,"'note' must be a string",l))})):o.forEach(l=>s.push(new E(N.UNKNOWN_ENUM_ELEMENT_SETTING,`Unknown enum field setting '${i}'`,l)))}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}registerField(t){if(t.callee&&Oe(t.callee)){const n=$e(t.callee).unwrap(),s=ji(n),r=this.symbolFactory.create(Hy,{declaration:t});t.symbol=r;const i=this.declarationNode.symbol.symbolTable;if(i.has(s)){const o=i.get(s);return[new E(N.DUPLICATE_COLUMN_NAME,`Duplicate enum field ${n}`,t),new E(N.DUPLICATE_COLUMN_NAME,`Duplicate enum field ${n}`,o.declaration)]}i.set(s,r)}return[]}}class yE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){const t=new E(N.INVALID_INDEXES_CONTEXT,"An Indexes can only appear inside a Table or a TablePartial",this.declarationNode);if(this.declarationNode.parent instanceof ht)return[t];const n=un(this.declarationNode.parent).unwrap_or(void 0);return n&&[$.Table,$.TablePartial].includes(n)?[]:[t]}validateName(t){return t?[new E(N.UNEXPECTED_NAME,"An Indexes shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"An Indexes shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"An Indexes shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"An Indexes must have a complex body",t)];const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[],r=[n.callee,...n.args];return ge(r)instanceof xe&&s.push(...this.validateFieldSetting(r.pop())),r.forEach(i=>{for(;i instanceof mt;)i.argumentList&&!_r(i.argumentList).isOk()&&s.push(new E(N.INVALID_INDEXES_FIELD,"An index field must be an identifier, a quoted identifier, a functional expression or a tuple of such",i.argumentList)),i=i.callee;_r(i).isOk()||s.push(new E(N.INVALID_INDEXES_FIELD,"An index field must be an identifier, a quoted identifier, a functional expression or a tuple of such",i))}),s})}validateFieldSetting(t){const n=we(t),s=n.getErrors(),r=n.getValue();for(const i in r){const o=r[i];switch(i){case"note":case"name":o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_INDEX_SETTING,`'${i}' can only appear once`,l))),o.forEach(l=>{Ge(l.value)||s.push(new E(N.INVALID_INDEX_SETTING_VALUE,`'${i}' must be a string`,l))});break;case"unique":case"pk":o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_INDEX_SETTING,`'${i}' can only appear once`,l))),o.forEach(l=>{at(l.value)||s.push(new E(N.INVALID_INDEX_SETTING_VALUE,`'${i}' must not have a value`,l))});break;case"type":o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_INDEX_SETTING,"'type' can only appear once",l))),o.forEach(l=>{Oe(l.value)||s.push(new E(N.INVALID_INDEX_SETTING_VALUE,`'type' must be "btree" or "hash"`,l))});break;default:o.forEach(l=>s.push(new E(N.UNKNOWN_INDEX_SETTING,`Unknown index setting '${i}'`,l)))}}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class EE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return!(this.declarationNode.parent instanceof ht)&&![$.Table,$.TableGroup,$.TablePartial,$.Project].includes(un(this.declarationNode.parent).unwrap_or(void 0))?[new E(N.INVALID_NOTE_CONTEXT,"A Note can only appear inside a Table, a TableGroup, a TablePartial or a Project. Sticky note can only appear at the global scope.",this.declarationNode)]:[]}validateName(t){if(!(this.declarationNode.parent instanceof ht))return t?[new E(N.UNEXPECTED_NAME,"A Note shouldn't have a name",t)]:[];if(!t)return[new E(N.INVALID_NAME,"Sticky note must have a name",this.declarationNode)];const n=Ze(t);if(!n.isOk())return[new E(N.INVALID_NAME,"Invalid name for sticky note ",this.declarationNode)];const s=n.unwrap().join("."),r=Vy(s);return this.publicSymbolTable.has(r)?[new E(N.DUPLICATE_NAME,`Sticky note "${s}" has already been defined`,t)]:(this.publicSymbolTable.set(r,this.declarationNode.symbol),[])}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A Ref shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"A Note shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return this.validateFields([t]);const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){const n=[];return t.length===0?[new E(N.EMPTY_NOTE,"A Note must have a content",this.declarationNode)]:(t.length>1&&t.slice(1).forEach(s=>n.push(new E(N.NOTE_CONTENT_REDEFINED,"A Note can only contain one string",s))),Ge(t[0].callee)||n.push(new E(N.INVALID_NOTE,"A Note content must be a quoted string",t[0])),t[0].args.length>0&&n.push(...t[0].args.map(s=>new E(N.INVALID_NOTE,"A Note can only contain one quoted string",s))),n)}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class _E{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ce?[new E(N.INVALID_PROJECT_CONTEXT,"A Project can only appear top-level",this.declarationNode)]:[]}validateName(t){return t?Ns(t)?[]:[new E(N.INVALID_NAME,"A Project's name is optional or must be an identifier or a quoted identifer",t)]:[]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A Project shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"A Project shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"A Project's body must be a block",t)];const[n,s]=xt(t.body,r=>r instanceof re);return[...n.map(r=>new E(N.INVALID_PROJECT_FIELD,"A Project can not have inline fields",r)),...this.validateSubElements(s)]}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}class TE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ht?[]:[new E(N.INVALID_REF_CONTEXT,"A Ref must appear top-level",this.declarationNode)]}validateName(t){return t?Ns(t)?[]:[new E(N.INVALID_NAME,"A Ref's name is optional or must be an identifier or a quoted identifer",t)]:[]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A Ref shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"A Ref shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return this.validateFields([t]);const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){if(t.length===0)return[new E(N.EMPTY_REF,"A Ref must have at least one field",this.declarationNode)];const n=[];return t.length>1&&n.push(...t.slice(1).map(s=>new E(N.REF_REDEFINED,"A Ref can only contain one binary relationship",s))),t.forEach(s=>{s.callee&&!xE(s.callee)&&n.push(new E(N.INVALID_REF_FIELD,"A Ref field must be a binary relationship",s.callee)),s.callee&&!gE(s.callee)&&n.push(new E(N.UNEQUAL_FIELDS_BINARY_REF,"Unequal fields in ref endpoints",s.callee));const r=[...s.args];if(ge(r)instanceof xe){const i=this.validateFieldSettings(ge(r));n.push(...i),r.pop()}else r[0]instanceof xe&&(n.push(...this.validateFieldSettings(r[0])),r.shift());r.length>0&&n.push(...r.map(i=>new E(N.INVALID_REF_FIELD,"A Ref field should only have a single binary relationship",i)))}),n}validateFieldSettings(t){const n=we(t),s=n.getErrors(),r=n.getValue();for(const i in r){const o=r[i];switch(i){case"delete":case"update":o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_REF_SETTING,`'${i}' can only appear once`,l))),o.forEach(l=>{wE(l.value)||s.push(new E(N.INVALID_REF_SETTING_VALUE,`'${i}' can only have values "cascade", "no action", "set null", "set default" or "restrict"`,l))});break;case"color":o.length>1&&s.push(...o.map(l=>new E(N.DUPLICATE_REF_SETTING,"'color' can only appear once",l))),o.forEach(l=>{ta(l.value)||s.push(new E(N.INVALID_REF_SETTING_VALUE,"'color' must be a color literal",l))});break;default:o.forEach(l=>s.push(new E(N.UNKNOWN_REF_SETTING,`Unknown ref setting '${i}'`,l)))}}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}function wE(e){if(!(Oe(e)&&e.expression.variable.kind!==w.QUOTED_STRING)&&!(e instanceof Nt))return!1;let t;if(e instanceof Nt?t=Qn(e).unwrap_or(""):t=e.expression.variable.value,t)switch(t.toLowerCase()){case"cascade":case"no action":case"set null":case"set default":case"restrict":return!0;default:return!1}return!1}class CE{constructor(t,n,s){this.declarationNode=t,this.symbolFactory=s,this.publicSymbolTable=n}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ce?[new E(N.INVALID_TABLE_CONTEXT,"Table must appear top-level",this.declarationNode)]:[]}validateName(t){return t?t instanceof Ln?[new E(N.INVALID_NAME,"Invalid array as Table name, maybe you forget to add a space between the name and the setting list?",t)]:Ad(t)?[]:[new E(N.INVALID_NAME,"A Table name must be of the form <table> or <schema>.<table>",t)]:[new E(N.NAME_NOT_FOUND,"A Table must have a name",this.declarationNode)]}validateAlias(t){return t?AE(t)?[]:[new E(N.INVALID_ALIAS,"Table aliases can only contains alphanumeric and underscore unless surrounded by double quotes",t)]:[]}validateSettingList(t){const n=we(t),s=n.getErrors(),r=n.getValue();return Bs(r,(i,o)=>{switch(o){case A.HeaderColor:i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_SETTING,"'headercolor' can only appear once",l))),i.forEach(l=>{ta(l.value)||s.push(new E(N.INVALID_TABLE_SETTING_VALUE,"'headercolor' must be a color literal",l.value||l.name))});break;case A.Note:i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_SETTING,"'note' can only appear once",l))),i.forEach(l=>{Ge(l.value)||s.push(new E(N.INVALID_TABLE_SETTING_VALUE,"'note' must be a string literal",l.value||l.name))});break;default:s.push(...i.map(l=>new E(N.UNKNOWN_TABLE_SETTING,`Unknown '${o}' setting`,l)))}}),s}registerElement(){const t=[];this.declarationNode.symbol=this.symbolFactory.create(Sd,{declaration:this.declarationNode,symbolTable:new vs});const{name:n,alias:s}=this.declarationNode,r=Ze(n);if(r.isOk()){const i=[...r.unwrap()],o=i.pop(),l=ea(i,this.publicSymbolTable,this.symbolFactory),c=yr(o);l.has(c)&&t.push(new E(N.DUPLICATE_NAME,`Table name '${o}' already exists in schema '${i.join(".")||"public"}'`,n)),l.set(c,this.declarationNode.symbol)}if(s&&Ns(s)&&!IE(s.expression.variable.value,r.unwrap_or([]))){const i=$e(s).unwrap(),o=yr(i);this.publicSymbolTable.has(o)&&t.push(new E(N.DUPLICATE_NAME,`Table name '${i}' already exists`,n)),this.publicSymbolTable.set(o,this.declarationNode.symbol)}return t}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"A Table's body must be a block",t)];const[n,s,r]=t.body.reduce((i,o)=>(o instanceof re?i[0].push(o):o instanceof kn?i[1].push(o):o instanceof ce&&i[2].push(o),i),[[],[],[]]);return[...this.validateFields(n),...this.validateInjections(s),...this.validateSubElements(r)]}validateInjections(t){return t.flatMap(n=>this.registerInjection(n))}registerInjection(t){var n,s,r;if(!((s=(n=t.partial)==null?void 0:n.variable)!=null&&s.value))return[];const i=(r=t.partial.variable)==null?void 0:r.value,o=Id(i),l=this.symbolFactory.create(Jy,{declaration:t});t.symbol=l;const c=this.declarationNode.symbol.symbolTable,d=c.get(o);return d?[new E(N.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME,`Duplicate injection ${i}`,t),new E(N.DUPLICATE_TABLE_PARTIAL_INJECTION_NAME,`Duplicate injection ${i}`,d.declaration)]:(c.set(o,l),[])}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[];n.args.length===0&&s.push(new E(N.INVALID_COLUMN,"A column must have a type",n.callee)),Oe(n.callee)||s.push(new E(N.INVALID_COLUMN_NAME,"A column name must be an identifier or a quoted identifier",n.callee)),n.args[0]&&!Pd(n.args[0])&&s.push(new E(N.INVALID_COLUMN_TYPE,"Invalid column type",n.args[0]));const r=n.args.slice(1);return s.push(...this.validateFieldSetting(r)),s.push(...this.registerField(n)),s})}registerField(t){if(t.callee&&Oe(t.callee)){const n=$e(t.callee).unwrap(),s=Qr(n),r=this.symbolFactory.create(Ai,{declaration:t});t.symbol=r;const i=this.declarationNode.symbol.symbolTable;if(i.has(s)){const o=i.get(s);return[new E(N.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,t),new E(N.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,o.declaration)]}i.set(s,r)}return[]}validateFieldSetting(t){if(!t.slice(0,-1).every(dn)||!t.slice(-1).every(c=>dn(c)||c instanceof xe))return[...t.map(c=>new E(N.INVALID_COLUMN,"These fields must be some inline settings optionally ended with a setting list",c))];if(t.length===0)return[];let n;ge(t)instanceof xe&&(n=t.pop());const s=we(n),r=s.getErrors(),i=s.getValue();t.forEach(c=>{const d=$e(c).unwrap_or("").toLowerCase();if(d!=="pk"&&d!=="unique"){r.push(new E(N.INVALID_SETTINGS,"Inline column settings can only be `pk` or `unique`",c));return}i[d]===void 0?i[d]=[c]:i[d].push(c)});const o=i[A.PK]||[],l=i[A.PrimaryKey]||[];return o.length>=1&&l.length>=1&&r.push(...[...o,...l].map(c=>new E(N.DUPLICATE_COLUMN_SETTING,"Either one of 'primary key' and 'pk' can appear",c))),Bs(i,(c,d)=>{switch(d){case A.Note:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"note can only appear once",u))),c.forEach(u=>{Ge(u.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'note' must be a quoted string",u.value||u.name))});break;case A.Ref:c.forEach(u=>{Md(u.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'ref' must be a valid unary relationship",u.value||u.name))});break;case A.PrimaryKey:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"primary key can only appear once",u))),c.forEach(u=>{at(u.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'primary key' must not have a value",u.value||u.name))});break;case A.PK:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"'pk' can only appear once",u))),c.forEach(u=>{u instanceof yt&&!at(u.value)&&r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'pk' must not have a value",u.value||u.name))});break;case A.NotNull:{c.length>1&&r.push(...c.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,"'not null' can only appear once",f)));const u=i[A.Null]||[];c.length>=1&&u.length>=1&&r.push(...[...c,...u].map(f=>new E(N.CONFLICTING_SETTING,"'not null' and 'null' can not be set at the same time",f))),c.forEach(f=>{at(f.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'not null' must not have a value",f.value||f.name))});break}case A.Null:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"'null' can only appear once",u))),c.forEach(u=>{at(u.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'null' must not have a value",u.value||u.name))});break;case A.Unique:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"'unique' can only appear once",u))),c.forEach(u=>{u instanceof yt&&!at(u.value)&&r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'unique' must not have a value",u.value||u.name))});break;case A.Increment:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"'increment' can only appear once",u))),c.forEach(u=>{u instanceof yt&&!at(u.value)&&r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'increment' must not have a value",u.value||u.name))});break;case A.Default:c.length>1&&r.push(...c.map(u=>new E(N.DUPLICATE_COLUMN_SETTING,"'default' can only appear once",u))),c.forEach(u=>{Rd(u.value)||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'default' must be an enum value, a string literal, number literal, function expression, true, false or null",u.value||u.name))});break;case A.Check:c.forEach(u=>{u.value instanceof pt||r.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'check' must be a function expression",u.value||u.name))});break;default:c.forEach(u=>r.push(new E(N.UNKNOWN_COLUMN_SETTING,`Unknown column setting '${d}'`,u)))}}),r}validateSubElements(t){const n=t.flatMap(r=>{if(r.parent=this.declarationNode,!r.type)return[];const i=Bt(r);return new i(r,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(r=>{var i;return((i=r.type)==null?void 0:i.value.toLowerCase())==="note"});return s.length>1&&n.push(...s.map(r=>new E(N.NOTE_REDEFINED,"Duplicate notes are defined",r))),n}}function IE(e,t){return t.length===1&&e===t[0]}class jE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ce?[new E(N.INVALID_TABLEGROUP_CONTEXT,"TableGroup must appear top-level",this.declarationNode)]:[]}validateName(t){return t?Ns(t)?[]:[new E(N.INVALID_NAME,"A TableGroup name must be a single identifier",t)]:[new E(N.NAME_NOT_FOUND,"A TableGroup must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A TableGroup shouldn't have an alias",t)]:[]}registerElement(){const{name:t}=this.declarationNode;this.declarationNode.symbol=this.symbolFactory.create(qy,{declaration:this.declarationNode,symbolTable:new vs});const n=Ze(t);if(n.isOk()){const s=n.unwrap(),r=s.pop(),i=ea(s,this.publicSymbolTable,this.symbolFactory),o=Si(r);if(i.has(o))return[new E(N.DUPLICATE_NAME,`TableGroup name '${r}' already exists`,t)];i.set(o,this.declarationNode.symbol)}return[]}validateSettingList(t){const n=we(t),s=n.getErrors(),r=n.getValue();return Bs(r,(i,o)=>{switch(o){case"color":i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_SETTING,"'color' can only appear once",l))),i.forEach(l=>{ta(l.value)||s.push(new E(N.INVALID_TABLE_SETTING_VALUE,"'color' must be a color literal",l.value||l.name))});break;case"note":i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_SETTING,"'note' can only appear once",l))),i.filter(l=>!Ge(l.value)).forEach(l=>{s.push(new E(N.INVALID_TABLE_SETTING_VALUE,"'note' must be a string literal",l.value||l.name))});break;default:s.push(...i.map(l=>new E(N.UNKNOWN_TABLE_SETTING,`Unknown '${o}' setting`,l)));break}}),s}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"A TableGroup's body must be a block",t)];const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{const s=[];return n.callee&&!Ze(n.callee).isOk()&&s.push(new E(N.INVALID_TABLEGROUP_FIELD,"A TableGroup field must be of the form <table> or <schema>.<table>",n.callee)),this.registerField(n),n.args.length>0&&s.push(...n.args.map(r=>new E(N.INVALID_TABLEGROUP_FIELD,"A TableGroup field should only have a single Table name",r))),s})}validateSubElements(t){const n=t.flatMap(r=>{if(r.parent=this.declarationNode,!r.type)return[];const i=Bt(r);return new i(r,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(r=>{var i;return((i=r.type)==null?void 0:i.value.toLowerCase())==="note"});return s.length>1&&n.push(...s.map(r=>new E(N.NOTE_REDEFINED,"Duplicate notes are defined",r))),n}registerField(t){if(t.callee&&Oe(t.callee)){const n=$e(t.callee).unwrap(),s=ki(n),r=this.symbolFactory.create(Yy,{declaration:t});t.symbol=r;const i=this.declarationNode.symbol.symbolTable;if(i.has(s)){const o=i.get(s);return[new E(N.DUPLICATE_TABLEGROUP_FIELD_NAME,`${n} already exists in the group`,t),new E(N.DUPLICATE_TABLEGROUP_FIELD_NAME,`${n} already exists in the group`,o.declaration)]}i.set(s,r)}return[]}}const SE=["-","+"];class kE{constructor(t,n,s){this.declarationNode=t,this.symbolFactory=s,this.publicSymbolTable=n}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.registerElement(),...this.validateBody(this.declarationNode.body)]}validateContext(){return this.declarationNode.parent instanceof ce?[new E(N.INVALID_TABLE_PARTIAL_CONTEXT,"TablePartial must appear top-level",this.declarationNode)]:[]}validateName(t){return t?Ns(t)?[]:[new E(N.INVALID_NAME,"A TablePartial name must be an identifier or a quoted identifer",t)]:[new E(N.NAME_NOT_FOUND,"A TablePartial must have a name",this.declarationNode)]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A TablePartial shouldn't have an alias",t)]:[]}validateSettingList(t){const n=we(t),s=n.getErrors(),r=n.getValue();return Bs(r,(i,o)=>{switch(o){case A.HeaderColor:i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_PARTIAL_SETTING,`'${o}' can only appear once`,l))),i.forEach(l=>{ta(l.value)||s.push(new E(N.INVALID_TABLE_PARTIAL_SETTING_VALUE,`'${o}' must be a color literal`,l.value||l.name))});break;case A.Note:i.length>1&&s.push(...i.map(l=>new E(N.DUPLICATE_TABLE_PARTIAL_SETTING,`'${o}' can only appear once`,l))),i.forEach(l=>{Ge(l.value)||s.push(new E(N.INVALID_TABLE_PARTIAL_SETTING_VALUE,`'${o}' must be a string literal`,l.value||l.name))});break;default:s.push(...i.map(l=>new E(N.UNKNOWN_TABLE_PARTIAL_SETTING,`Unknown '${o}' setting`,l)))}}),s}registerElement(){const{name:t}=this.declarationNode;this.declarationNode.symbol=this.symbolFactory.create(Qy,{declaration:this.declarationNode,symbolTable:new vs});const n=Ze(t);if(!n.isOk())return[];const s=n.unwrap(),r=s.pop(),i=ea(s,this.publicSymbolTable,this.symbolFactory),o=Li(r);return i.has(o)?[new E(N.DUPLICATE_NAME,`TablePartial name '${r}' already exists`,t)]:(i.set(o,this.declarationNode.symbol),[])}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"A TablePartial's body must be a block",t)];const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[];n.args.length===0&&s.push(new E(N.INVALID_COLUMN,"A column must have a type",n.callee)),Oe(n.callee)||s.push(new E(N.INVALID_COLUMN_NAME,"A column name must be an identifier or a quoted identifier",n.callee)),n.args[0]&&!Pd(n.args[0])&&s.push(new E(N.INVALID_COLUMN_TYPE,"Invalid column type",n.args[0]));const r=n.args.slice(1);return s.push(...this.validateFieldSetting(r),...this.registerField(n)),s})}registerField(t){if(!t.callee||!Oe(t.callee))return[];const n=$e(t.callee).unwrap(),s=Qr(n),r=this.symbolFactory.create(Ai,{declaration:t});t.symbol=r;const i=this.declarationNode.symbol.symbolTable;if(i.has(s)){const o=i.get(s);return[new E(N.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,t),new E(N.DUPLICATE_COLUMN_NAME,`Duplicate column ${n}`,o.declaration)]}return i.set(s,r),[]}validateFieldSetting(t){const n=ge(t);if(!t.slice(0,-1).every(dn)||!(dn(n)||n instanceof xe))return[...t.map(d=>new E(N.INVALID_COLUMN,"These fields must be some inline settings optionally ended with a setting list",d))];if(t.length===0)return[];let s;ge(t)instanceof xe&&(s=t.pop());const r=we(s),i=r.getErrors(),o=r.getValue();t.forEach(d=>{const u=$e(d).unwrap_or("").toLowerCase();if(u!==A.PK&&u!==A.Unique){i.push(new E(N.INVALID_SETTINGS,"Inline column settings can only be `pk` or `unique`",d));return}o[u]===void 0?o[u]=[d]:o[u].push(d)});const l=o[A.PK]||[],c=o[A.PrimaryKey]||[];return l.length>=1&&c.length>=1&&i.push(...[...l,...c].map(d=>new E(N.DUPLICATE_COLUMN_SETTING,"Either one of 'primary key' and 'pk' can appear",d))),Bs(o,(d,u)=>{switch(u){case A.Note:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{Ge(f.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must be a quoted string`,f.value||f.name))});break;case A.Ref:d.forEach(f=>{Md(f.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must be a valid unary relationship`,f.value||f.name))});break;case A.PrimaryKey:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{at(f.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,f.value||f.name))});break;case A.PK:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{f instanceof yt&&!at(f.value)&&i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,f.value||f.name))});break;case A.NotNull:{d.length>1&&i.push(...d.map(p=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,p)));const f=o[A.Null]||[];d.length>=1&&f.length>=1&&i.push(...[...d,...f].map(p=>new E(N.CONFLICTING_SETTING,"'not null' and 'null' can not be set at the same time",p))),d.forEach(p=>{at(p.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,p.value||p.name))});break}case A.Null:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{at(f.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,f.value||f.name))});break;case A.Unique:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{f instanceof yt&&!at(f.value)&&i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,f.value||f.name))});break;case A.Increment:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{f instanceof yt&&!at(f.value)&&i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must not have a value`,f.value||f.name))});break;case A.Default:d.length>1&&i.push(...d.map(f=>new E(N.DUPLICATE_COLUMN_SETTING,`'${u}' can only appear once`,f))),d.forEach(f=>{Rd(f.value)||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,`'${u}' must be a string literal, number literal, function expression, true, false or null`,f.value||f.name))});break;case A.Check:d.forEach(f=>{f.value instanceof pt||i.push(new E(N.INVALID_COLUMN_SETTING_VALUE,"'check' must be a function expression",f.value||f.name))});break;default:d.forEach(f=>i.push(new E(N.UNKNOWN_COLUMN_SETTING,`Unknown column setting '${u}'`,f)))}}),i}validateSubElements(t){const n=t.flatMap(r=>{if(r.parent=this.declarationNode,!r.type)return[];const i=Bt(r);return new i(r,this.publicSymbolTable,this.symbolFactory).validate()}),s=t.filter(r=>{var i;return((i=r.type)==null?void 0:i.value.toLowerCase())===$.Note});return s.length>1&&n.push(...s.map(r=>new E(N.NOTE_REDEFINED,"Duplicate notes are defined",r))),n}}class LE{constructor(t,n,s){this.declarationNode=t,this.publicSymbolTable=n,this.symbolFactory=s}validate(){return[...this.validateContext(),...this.validateName(this.declarationNode.name),...this.validateAlias(this.declarationNode.alias),...this.validateSettingList(this.declarationNode.attributeList),...this.validateBody(this.declarationNode.body)]}validateContext(){const t=new E(N.INVALID_CHECKS_CONTEXT,"A Checks can only appear inside a Table or a TablePartial",this.declarationNode);if(this.declarationNode.parent instanceof ht)return[t];const n=un(this.declarationNode.parent).unwrap_or(void 0);return n&&[$.Table,$.TablePartial].includes(n)?[]:[t]}validateName(t){return t?[new E(N.UNEXPECTED_NAME,"A Checks shouldn't have a name",t)]:[]}validateAlias(t){return t?[new E(N.UNEXPECTED_ALIAS,"A Checks shouldn't have an alias",t)]:[]}validateSettingList(t){return t?[new E(N.UNEXPECTED_SETTINGS,"A Checks shouldn't have a setting list",t)]:[]}validateBody(t){if(!t)return[];if(t instanceof re)return[new E(N.UNEXPECTED_SIMPLE_BODY,"A Checks must have a complex body",t)];const[n,s]=xt(t.body,r=>r instanceof re);return[...this.validateFields(n),...this.validateSubElements(s)]}validateFields(t){return t.flatMap(n=>{if(!n.callee)return[];const s=[],r=[n.callee,...n.args];return ge(r)instanceof xe&&s.push(...this.validateFieldSetting(r.pop())),(r.length>1||!(r[0]instanceof pt))&&s.push(new E(N.INVALID_CHECKS_FIELD,"A check field must be a function expression",n)),s})}validateFieldSetting(t){const n=we(t),s=n.getErrors(),r=n.getValue();for(const i in r){const o=r[i];i==="name"?(o.length>1&&o.forEach(l=>s.push(new E(N.DUPLICATE_CHECK_SETTING,`'${i}' can only appear once`,l))),o.forEach(l=>{Ge(l.value)||s.push(new E(N.INVALID_CHECK_SETTING_VALUE,`'${i}' must be a string`,l))})):o.forEach(l=>s.push(new E(N.UNKNOWN_CHECK_SETTING,`Unknown check setting '${i}'`,l)))}return s}validateSubElements(t){return t.flatMap(n=>{if(n.parent=this.declarationNode,!n.type)return[];const s=Bt(n);return new s(n,this.publicSymbolTable,this.symbolFactory).validate()})}}function Bt(e){switch(e.type.value.toLowerCase()){case $.Enum:return NE;case $.Table:return CE;case $.TableGroup:return jE;case $.Project:return _E;case $.Ref:return TE;case $.Note:return EE;case $.Indexes:return yE;case $.TablePartial:return kE;case $.Check:return LE;default:return vE}}function Ad(e){return!!Ze(e).unwrap_or(!1)}function AE(e){return Ns(e)}function Ns(e){return e instanceof We&&e.expression instanceof Ct}function ea(e,t,n){var s;e[0]==="public"&&(e=e.slice(1));let r=t;for(const i of e){let o;const l=Ci(i);if(r.has(l)){if(o=(s=r.get(l))==null?void 0:s.symbolTable,!o)throw new Error("Expect a symbol table in a schema symbol")}else{o=new vs;const c=n.create(jd,{symbolTable:o});r.set(l,c)}r=o}return r}function Dd(e){return e==="-"||e==="<>"||e===">"||e==="<"}function ta(e){var t;if(!(e instanceof We)||!(e.expression instanceof gs)||((t=e.expression.literal)==null?void 0:t.kind)!==w.COLOR_LITERAL)return!1;const n=e.expression.literal.value;if(n.length!==4&&n.length!==7||n[0]!=="#")return!1;for(let s=1;s<n.length;s+=1)if(!nE(n[s]))return!1;return!0}function at(e){return e===void 0}function Rd(e){var t;if(Ge(e)||An(e)||dn(e)&&["true","false","null"].includes(e.expression.variable.value.toLowerCase())||e instanceof ft&&SE.includes((t=e.op)==null?void 0:t.value)&&An(e.expression)||e instanceof pt)return!0;if(!e||!Di(e))return!1;const n=Wt(e).unwrap();return n.length===2||n.length===3}function An(e){var t,n,s;return e instanceof ft?((t=e.op)==null?void 0:t.value)!=="-"&&((n=e.op)==null?void 0:n.value)!=="+"?!1:An(e.expression):e instanceof We&&e.expression instanceof gs&&((s=e.expression.literal)==null?void 0:s.kind)===w.NUMERIC_LITERAL}function Md(e){var t;if(!(e instanceof ft)||!Dd((t=e.op)==null?void 0:t.value))return!1;const n=Ze(e.expression).unwrap_or(void 0);return n!==void 0&&n.length>0}function Od(e){return e instanceof Ut&&e.elementList.every(Oe)}function Pd(e){if(!(e instanceof mt||Zr(e)||e instanceof We||e instanceof Ln))return!1;if(e instanceof mt){if(e.callee===void 0||e.argumentList===void 0||!e.argumentList.elementList.every(n=>An(n)||Ge(n)||dn(n)))return!1;e=e.callee}for(;e instanceof Ln;){if(e.array===void 0||e.indexer===void 0||!e.indexer.elementList.every(n=>!n.colon&&!n.value&&An(n.name)))return!1;e=e.array}const t=Ze(e).unwrap_or(void 0);return t!==void 0&&t.length>0}function we(e){const t={},n=[];return e?(e.elementList.forEach(s=>{var r;if(!s.name)return;if(s.name instanceof We){n.push(new E(N.INVALID_SETTINGS,"A setting name must be a stream of identifiers",s.name));return}const i=(r=Qn(s.name).unwrap_or(void 0))==null?void 0:r.toLowerCase();i&&(t[i]===void 0?t[i]=[s]:t[i].push(s))}),new lt(t,n)):new lt({})}class cl{constructor(t,n){this.ast=t,this.symbolFactory=n,this.publicSchemaSymbol=this.symbolFactory.create(jd,{symbolTable:new vs}),this.ast.symbol=this.publicSchemaSymbol,this.ast.symbol.declaration=this.ast}validate(){const t=[];this.ast.body.forEach(s=>{if(s.parent=this.ast,s.type===void 0)return;const r=Bt(s),i=new r(s,this.publicSchemaSymbol.symbolTable,this.symbolFactory);t.push(...i.validate())});const n=this.ast.body.filter(s=>un(s).unwrap_or(void 0)===$.Project);return n.length>1&&n.forEach(s=>t.push(new E(N.PROJECT_REDEFINED,"Only one project can exist",s))),new lt(this.ast,t)}}class $t{constructor(t,n){this.declarationNode=t,this.errors=n}bind(){this.bindSettingList(this.declarationNode.attributeList,this.settingList),this.bindBody()}bindSettingList(t,n){t&&t.elementList.forEach(s=>{if(s.name instanceof We)return;const r=Qn(s.name).unwrap_or(void 0);if(!r)return;const i=n[r.toLowerCase()];i!=null&&i.shouldBind&&this.scanAndBind(s.value,i)})}bindBody(){const t=this.declarationNode;if(!t.body)return;const{body:n}=t;n instanceof jt?n.body.forEach(s=>{if(s instanceof ce){if(!s.type||un(this.declarationNode).unwrap_or(null)===$.TablePartial&&un(s).unwrap_or(null)===$.Indexes)return;const r=Fd(s);new r(s,this.errors).bind()}else s instanceof re?this.bindSubfield(s):this.bindPartialInjection(s)}):this.bindSubfield(n)}bindSubfield(t){const n=[t.callee,...t.args],s=ge(n);s instanceof xe&&(n.pop(),this.bindSettingList(s,this.subfield.settingList));const{argBinderRules:r}=this.subfield.arg;for(let i=0;i<Math.min(n.length,r.length);i+=1)r[i].shouldBind&&this.scanAndBind(n[i],r[i])}bindPartialInjection(t){var n;(n=this.injectionBinderRule)!=null&&n.shouldBind&&this.scanAndBind(t,this.injectionBinderRule)}scanAndBind(t,n){var s,r;if(t)if(t instanceof We){if(t.expression instanceof Ct&&(r=n.keywords)!=null&&r.includes((s=t.expression.variable)==null?void 0:s.value.toLowerCase()))return;this.bindFragments([t],n)}else t instanceof Ft?Zr(t)?this.bindFragments(Wt(t).unwrap_or([]),n):(this.scanAndBind(t.leftExpression,n),this.scanAndBind(t.rightExpression,n)):t instanceof ft?this.scanAndBind(t.expression,n):t instanceof Yr?this.scanAndBind(t.expression,n):t instanceof Ut?t.elementList.forEach(i=>this.scanAndBind(i,n)):t instanceof kn&&this.bindFragments([t],n)}bindFragments(t,n){if(t.length===0)return;const s=t.length===1&&t[0]instanceof kn,r=[...n.topSubnamesSymbolKind],i=s?-1:t.findIndex(f=>!Oe(f)),o=i!==-1&&Od(t[i])?t[i]:void 0,l=i>=0?r.pop():void 0,c=t.slice(0,i===-1?void 0:i);if(c.length===0)return;const d=[];for(;r.length&&c.length;){const f=r.pop(),p=c.pop(),x=$e(p).unwrap();d.unshift({index:lr(x,f),referrer:p})}for(;c.length;){const f=c.pop(),p=s?bE(f).unwrap():$e(f).unwrap();d.unshift({index:lr(p,n.remainingSubnamesSymbolKind),referrer:f})}const u=Ge(t[0]);return o?o.elementList.forEach(f=>this.resolveIndexStack([...d,{index:lr($e(f).unwrap(),l),referrer:f}],n,u)):this.resolveIndexStack(d,n,u)}resolveIndexStack(t,n,s){if(t.length===0)throw new Error("Unreachable - An unresolved name must have at least one name component");const[r,...i]=t,o=ll(r.index,this.declarationNode);if(o===void 0){const{kind:u,name:f}=Et(r.index).unwrap();this.logError(r.referrer,`Can not find ${u} '${f}'`,n.ignoreNameNotFound||!!n.ignoreNameNotFoundForQuotedVariable&&s);return}o.references.push(r.referrer),r.referrer.referee=o;let l=o.symbolTable,{kind:c,name:d}=Et(r.index).unwrap();for(const u of i){const{kind:f,name:p}=Et(u.index).unwrap(),x=l.get(u.index);if(!x){this.logError(u.referrer,`${c} '${d}' does not have ${f} '${p}'`,n.ignoreNameNotFound);return}if(c=f,d=p,u.referrer.referee=x,x.references.push(u.referrer),!x.symbolTable)break;l=x.symbolTable}}logError(t,n,s){s||this.errors.push(new E(N.BINDING_ERROR,n,t))}resolveInjections(t){var n;const s=(n=this.declarationNode.symbol)==null?void 0:n.symbolTable;if(!s)return;const r=new Map;s.forEach((i,o)=>{var l,c;if(!zy(o))return;const d=ll(Ky(o),this.declarationNode),u=(c=(l=d?.declaration)==null?void 0:l.symbol)==null?void 0:c.symbolTable;u&&u.forEach((f,p)=>{s.has(p)||r.set(p,{injectorFieldSymbol:f,injectorDeclaration:i.declaration})})}),r.forEach((i,o)=>{const l=tE(i.injectorFieldSymbol);if(!l)return;const c=t.create(l,i);s.set(o,c)})}}class DE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class RE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[]},settingList:{}},this.settingList={}}}class ME extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class OE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class PE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1}]},settingList:{}},this.settingList={}}}class FE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[]},settingList:{}},this.settingList={}}}class UE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class BE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1},{shouldBind:!0,topSubnamesSymbolKind:[U.Enum],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!0,ignoreNameNotFoundForQuotedVariable:!0}]},settingList:{ref:{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},default:{shouldBind:!0,topSubnamesSymbolKind:[U.Enum,U.EnumField],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,keywords:["false","true","null"],ignoreNameNotFoundForQuotedVariable:!0},check:{shouldBind:!1}}},this.settingList={},this.injectionBinderRule={shouldBind:!0,topSubnamesSymbolKind:[],remainingSubnamesSymbolKind:U.TablePartial,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}}}class $E extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!0,topSubnamesSymbolKind:[U.Table],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{}},this.settingList={}}}class VE extends $t{constructor(){super(...arguments),this.subfield={arg:{argBinderRules:[{shouldBind:!1},{shouldBind:!0,topSubnamesSymbolKind:[U.Enum],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!0,ignoreNameNotFoundForQuotedVariable:!1}]},settingList:{ref:{shouldBind:!0,topSubnamesSymbolKind:[U.Table,U.Column],remainingSubnamesSymbolKind:U.Schema,ignoreNameNotFound:!1,ignoreNameNotFoundForQuotedVariable:!1},default:{shouldBind:!1},check:{shouldBind:!1}}},this.settingList={}}}function Fd(e){switch(e.type.value.toLowerCase()){case $.Enum:return ME;case $.Table:return BE;case $.TableGroup:return $E;case $.Project:return FE;case $.Ref:return UE;case $.Note:return PE;case $.Indexes:return OE;case $.TablePartial:return VE;case $.Check:return DE;default:return RE}}class GE{constructor(t){this.ast=t,this.errors=[]}resolve(t){return this.ast.body.map(n=>{if(!n.type)return null;const s=Fd(n),r=new s(n,this.errors);return r.resolveInjections(t),r}).forEach(n=>n?.bind()),new lt(this.ast,this.errors)}}class zE{constructor(t){this.generator=t}create(t,n){return new t(n,this.generator.nextId())}}class KE{constructor(t,n){this.ast=t,this.symbolFactory=new zE(n)}analyze(){return new cl(this.ast,this.symbolFactory).validate().chain(t=>new GE(t).resolve(this.symbolFactory))}validate(){return new cl(this.ast,this.symbolFactory).validate().chain(t=>new lt(t,[]))}}function dl(e,t){const{variables:n,tupleElements:s}=$s(e).unwrap();return s?n.length===0?{schemaName:t.schemaName,tableName:t.name,fieldNames:s}:{tableName:n.pop(),schemaName:n.pop()||null,fieldNames:s}:n.length===1?{schemaName:t.schemaName,tableName:t.name,fieldNames:[n[0]]}:{fieldNames:[n.pop()],tableName:n.pop(),schemaName:n.pop()||null}}function Ud(e){switch(e){case"<":return["1","*"];case"<>":return["*","*"];case">":return["*","1"];case"-":return["1","1"];default:throw new Error("Invalid relation op")}}function z(e){return{start:{offset:e.startPos.offset,line:e.startPos.line+1,column:e.startPos.column+1},end:{offset:e.endPos.offset,line:e.endPos.line+1,column:e.endPos.column+1}}}function Tr(e){var t;const n=(t=Wt(e).unwrap_or(void 0))==null?void 0:t.pop();return n instanceof Ut?n.elementList.map(s=>s.referee):[n.referee]}function Fn(e){const t=Ze(e).unwrap();return{name:t.pop(),schemaName:t}}function Qs(e){return e.expression.literal.value}function Bd(e,t){if(Array.isArray(e)){const r=e.map(({id:o})=>o).sort().join(","),i=t.map(({id:o})=>o).sort().join(",");return r<i?`${r}-${i}`:`${i}-${r}`}const n=e.id.toString(),s=t.id.toString();return n<s?`${n}-${s}`:`${s}-${n}`}function Ri(e,t){if(Array.isArray(e)){const r=e.map(({id:o})=>o).sort(),i=t.map(({id:o})=>o).sort();return Qa(r,i).every(([o,l])=>o===l)}const n=e.id,s=t.id;return n===s}function _t(e){const t=e.split(`
`),n=t.slice(t.findIndex(i=>i.trimStart()!=="")),s=n.filter(i=>i.trimStart()),r=Math.min(...s.map(i=>i.length-i.trimStart().length));return n.map(i=>i.slice(r)).join(`
`)}function $d(e){if(e){if(Ge(e))return{value:Le(e).unwrap(),type:"string"};if(An(e))return{type:"number",value:Za(e)};if(dn(e))return{value:e.expression.variable.value.toLowerCase(),type:"boolean"};if(e instanceof pt&&e.value)return{value:e.value.value,type:"expression"};if(Di(e))return{value:Wt(e).map(ge).and_then(Xe).unwrap(),type:"string"};throw new Error("Unreachable")}}function Vd(e){let t=null;e instanceof mt&&(t=e.argumentList.elementList.map(i=>An(i)?kd(i):Ge(i)?Le(i).unwrap():Xe(i).unwrap()).join(","),e=e.callee);let n="";for(;e instanceof Ln;)n=`[${e.indexer.elementList.map(i=>i.name.expression.literal.value).join(",")}]${n}`,e=e.array;const{name:s,schemaName:r}=Fn(e);return r.length>1?new lt({schemaName:r.length===0?null:r[0],type_name:`${s}${n}${t?`(${t})`:""}`,args:t},[new E(N.UNSUPPORTED,"Nested schema is not supported",e)]):new lt({schemaName:r.length===0?null:r[0],type_name:`${s}${n}${t?`(${t})`:""}`,args:t})}class Gd{constructor(t,n){this.declarationNode=t,this.env=n,this.table={name:void 0,schemaName:void 0,alias:null,fields:[],token:void 0,indexes:[],partials:[],checks:[]},this.pkColumns=[]}interpret(){this.table.token=z(this.declarationNode),this.env.tables.set(this.declarationNode,this.table);const t=[...this.interpretName(this.declarationNode.name),...this.interpretAlias(this.declarationNode.alias),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)];return this.pkColumns.length>=2&&(this.table.indexes.push({columns:this.pkColumns.map(({name:n,token:s})=>({value:n,type:"column",token:s})),token:{start:{offset:-1,line:-1,column:-1},end:{offset:-1,line:-1,column:-1}},pk:!0}),this.pkColumns.forEach(n=>{n.pk=!1})),t}interpretName(t){const{name:n,schemaName:s}=Fn(t);return s.length>1?(this.table.name=n,this.table.schemaName=s.join("."),[new E(N.UNSUPPORTED,"Nested schema is not supported",t)]):(this.table.name=n,this.table.schemaName=s.length?s[0]:null,[])}interpretAlias(t){if(!t)return[];const n=$e(t).unwrap_or(null);return n&&(this.env.aliases.push({name:n,kind:"table",value:{tableName:this.table.name,schemaName:this.table.schemaName}}),this.table.alias=n),[]}interpretSettingList(t){var n,s,r;const i=we(t).getValue();this.table.headerColor=(n=i[A.HeaderColor])!=null&&n.length?Qs((r=(s=i[A.HeaderColor])==null?void 0:s.at(0))==null?void 0:r.value):void 0;const[o]=i[A.Note]||[];return this.table.note=o&&{value:Le(o?.value).map(_t).unwrap(),token:z(o)},[]}interpretBody(t){const[n,s]=xt(t.body,r=>r instanceof re||r instanceof kn);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;switch((s=n.type)==null?void 0:s.value.toLowerCase()){case $.Note:return this.table.note={value:Le(n.body instanceof jt?n.body.body[0].callee:n.body.callee).map(_t).unwrap(),token:z(n)},[];case $.Indexes:return this.interpretIndexes(n);case $.Check:return this.interpretChecks(n);default:return[]}})}interpretInjection(t,n){const s={order:n,token:z(t)};return s.name=t.partial.variable.value,this.table.partials.push(s),[]}interpretFields(t){var n;const s=((n=this.declarationNode.symbol)!=null&&n.symbolTable?[...this.declarationNode.symbol.symbolTable.entries()]:[]).filter(([i])=>{const o=Et(i).unwrap_or(null);return o?.kind===U.Column}).length?[]:[new E(N.EMPTY_TABLE,"A Table must have at least one column",this.declarationNode)],r=t.flatMap((i,o)=>i instanceof re?this.interpretColumn(i):this.interpretInjection(i,o));return[...s,...r]}interpretColumn(t){var n,s,r,i,o,l,c,d,u;const f=[],p={};p.name=$e(t.callee).unwrap();const x=Vd(t.args[0]);p.type=x.getValue(),f.push(...x.getErrors()),p.token=z(t),p.inline_refs=[];const b=t.args.slice(1);if(ge(b)instanceof xe){const m=we(b.pop()).getValue();p.pk=!!((n=m[A.PK])!=null&&n.length)||!!((s=m[A.PrimaryKey])!=null&&s.length),p.increment=!!((r=m[A.Increment])!=null&&r.length),p.unique=!!((i=m[A.Unique])!=null&&i.length),p.not_null=(o=m[A.NotNull])!=null&&o.length?!0:(l=m[A.Null])!=null&&l.length?!1:void 0,p.dbdefault=$d((d=(c=m[A.Default])==null?void 0:c.at(0))==null?void 0:d.value);const g=(u=m[A.Note])==null?void 0:u.at(0);p.note=g&&{value:Le(g.value).map(_t).unwrap(),token:z(g)};const T=m[A.Ref]||[];p.inline_refs=T.flatMap(v=>{const[S]=Tr(v.value.expression);if(Ri(S,t.symbol))return f.push(new E(N.SAME_ENDPOINT,"Two endpoints are the same",v)),[];const I=v.value.op,k=Ze(v.value.expression).unwrap();let C;if(k.length===1){const[j]=k;C={schemaName:this.table.schemaName,tableName:this.table.name,fieldNames:[j],relation:I.value,token:z(v)}}else if(k.length===2){const[j,R]=k;C={schemaName:null,tableName:j,fieldNames:[R],relation:I.value,token:z(v)}}else if(k.length===3){const[j,R,L]=k;C={schemaName:j,tableName:R,fieldNames:[L],relation:I.value,token:z(v)}}else{f.push(new E(N.UNSUPPORTED,"Nested schema is not supported",v));const j=k.pop(),R=k.pop();C={schemaName:k.join("."),tableName:R,fieldNames:[j],relation:I.value,token:z(v)}}const _=this.registerInlineRefToEnv(t,S,C,v);return f.push(..._),_.length===0?C:[]});const y=m[A.Check]||[];p.checks=y.map(v=>{const S=z(v),I=v.value.value.value;return{token:S,expression:I}})}return p.pk||(p.pk=b.some(m=>Xe(m).unwrap().toLowerCase()==="pk")),p.unique||(p.unique=b.some(m=>Xe(m).unwrap().toLowerCase()==="unique")),this.table.fields.push(p),p.pk&&this.pkColumns.push(p),f}interpretIndexes(t){return this.table.indexes.push(...t.body.body.map(n=>{var s,r,i,o,l,c,d;const u={columns:[]},f=n;u.token=z(f);const p=[f.callee,...f.args];if(ge(p)instanceof xe){const x=we(p.pop()).getValue();u.pk=!!((s=x[A.PK])!=null&&s.length),u.unique=!!((r=x[A.Unique])!=null&&r.length),u.name=Le((o=(i=x[A.Name])==null?void 0:i.at(0))==null?void 0:o.value).unwrap_or(void 0);const b=(l=x[A.Note])==null?void 0:l.at(0);u.note=b&&{value:Le(b.value).unwrap(),token:z(b)},u.type=Xe((d=(c=x[A.Type])==null?void 0:c.at(0))==null?void 0:d.value).unwrap_or(void 0)}return p.flatMap(x=>{if(!(x instanceof mt))return x;const b=[];for(;x instanceof mt;)b.push(x.argumentList),x=x.callee;return b.push(x),b}).forEach(x=>{const{functional:b,nonFunctional:m}=_r(x).unwrap();u.columns.push(...b.map(g=>({value:g.value.value,type:"expression",token:z(g)})),...m.map(g=>({value:$e(g).unwrap(),type:"column",token:z(g)})))}),u})),[]}interpretChecks(t){return this.table.checks.push(...t.body.body.map(n=>{var s,r;const i={},o=n;if(i.token=z(o),o.args[0]instanceof xe){const l=we(o.args[0]).getValue();i.name=Le((r=(s=l[A.Name])==null?void 0:s.at(0))==null?void 0:r.value).unwrap_or(void 0)}return i.expression=o.callee.value.value,i})),[]}registerInlineRefToEnv(t,n,s,r){const i=Bd(t.symbol,n);if(this.env.refIds[i])return[new E(N.CIRCULAR_REF,"References with same endpoints exist",r),new E(N.CIRCULAR_REF,"References with same endpoints exist",this.env.refIds[i])];const o=Ud(s.relation);return this.env.refIds[i]=r,this.env.ref.set(r,{name:null,schemaName:null,token:s.token,endpoints:[{...s,relation:o[1]},{schemaName:this.table.schemaName,tableName:this.table.name,fieldNames:[Xe(t.callee).unwrap()],token:z(t),relation:o[0]}]}),[]}}class XE{constructor(t,n){this.declarationNode=t,this.env=n,this.note={name:void 0,content:void 0,token:void 0}}interpret(){return this.note.token=z(this.declarationNode),this.env.notes.set(this.declarationNode,this.note),[...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const{name:n}=Fn(t);return this.note.name=n,[]}interpretSettingList(t){var n,s,r;const i=we(t).getValue();return this.note.headerColor=(n=i.headercolor)!=null&&n.length?Qs((r=(s=i.headercolor)==null?void 0:s.at(0))==null?void 0:r.value):void 0,[]}interpretBody(t){const[n,s]=xt(t.body,r=>r instanceof re);return n.length!==1||s.length>0?[new E(N.INVALID_NOTE,"Invalid note syntax",t)]:[...this.interpretNote(n[0])]}interpretNote(t){const n=pd(t,"callee.expression.literal.value","");return this.note.content=_t(n),[]}}class zd{constructor(t,n){this.declarationNode=t,this.env=n,this.container=this.declarationNode.parent instanceof ce?this.env.tables.get(this.declarationNode.parent):void 0,this.ref={}}interpret(){return this.ref.token=z(this.declarationNode),this.env.ref.set(this.declarationNode,this.ref),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const n=[],s=Ze(this.declarationNode.name).unwrap_or([]);return this.ref.name=s.pop()||null,s.length>1&&n.push(new E(N.UNSUPPORTED,"Nested schema is not supported",this.declarationNode.name)),this.ref.schemaName=s.join(".")||null,n}interpretBody(t){return t instanceof re?this.interpretField(t):this.interpretField(t.body[0])}interpretField(t){var n,s,r,i,o,l,c;const d=t.callee.op.value,{leftExpression:u,rightExpression:f}=t.callee,p=Tr(u),x=Tr(f);if(Ri(p,x))return[new E(N.SAME_ENDPOINT,"Two endpoints are the same",t)];const b=Bd(p,x);if(this.env.refIds[b])return[new E(N.CIRCULAR_REF,"References with same endpoints exist",this.declarationNode),new E(N.CIRCULAR_REF,"References with same endpoints exist",this.env.refIds[b])];if(t.args[0]){const g=we(t.args[0]).getValue(),T=(s=(n=g.delete)==null?void 0:n.at(0))==null?void 0:s.value;this.ref.onDelete=T instanceof Nt?Qn(T).unwrap_or(void 0):Xe(T).unwrap_or(void 0);const y=(i=(r=g.update)==null?void 0:r.at(0))==null?void 0:i.value;this.ref.onUpdate=y instanceof Nt?Qn(y).unwrap_or(void 0):Xe(y).unwrap_or(void 0),this.ref.color=(o=g.color)!=null&&o.length?Qs((c=(l=g.color)==null?void 0:l.at(0))==null?void 0:c.value):void 0}const m=Ud(d);return this.ref.endpoints=[{...dl(u,this.container),relation:m[0],token:z(u)},{...dl(f,this.container),relation:m[1],token:z(f)}],this.env.refIds[b]=this.declarationNode,[]}}class Kd{constructor(t,n){this.declarationNode=t,this.env=n,this.tableGroup={tables:[]}}interpret(){const t=[];return this.tableGroup.token=z(this.declarationNode),this.env.tableGroups.set(this.declarationNode,this.tableGroup),t.push(...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)),t}interpretName(t){const n=[],{name:s,schemaName:r}=Fn(t);return r.length>=2&&(this.tableGroup.name=s,this.tableGroup.schemaName=r.join("."),n.push(new E(N.UNSUPPORTED,"Nested schema is not supported",this.declarationNode.name))),this.tableGroup.name=s,this.tableGroup.schemaName=r[0]||null,n}interpretBody(t){const[n,s]=xt(t.body,r=>r instanceof re);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;return((s=n.type)==null?void 0:s.value.toLowerCase())==="note"&&(this.tableGroup.note={value:Le(n.body instanceof jt?n.body.body[0].callee:n.body.callee).map(_t).unwrap(),token:z(n)}),[]})}interpretFields(t){const n=[];return this.tableGroup.tables=t.map(s=>{const r=Ze(s.callee).unwrap();r.length>2&&n.push(new E(N.UNSUPPORTED,"Nested schema is not supported",s));const i=Wt(s.callee).unwrap().pop().referee.id;if(this.env.groupOfTable[i]){const o=this.env.groupOfTable[i],{schemaName:l,name:c}=this.env.tableGroups.get(o),d=l?`${l}.${c}`:c;n.push(new E(N.TABLE_REAPPEAR_IN_TABLEGROUP,`Table "${r.join(".")}" already appears in group "${d}"`,s))}else this.env.groupOfTable[i]=this.declarationNode;return{name:r.pop(),schemaName:r.join(".")}}),n}interpretSettingList(t){var n,s,r;const i=we(t).getValue();this.tableGroup.color=(n=i.color)!=null&&n.length?Qs((r=(s=i.color)==null?void 0:s.at(0))==null?void 0:r.value):void 0;const[o]=i.note||[];return this.tableGroup.note=o&&{value:Le(o?.value).map(_t).unwrap(),token:z(o)},[]}}class Xd{constructor(t,n){this.declarationNode=t,this.env=n,this.enum={values:[]}}interpret(){return this.enum.token=z(this.declarationNode),this.env.enums.set(this.declarationNode,this.enum),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){const{name:n,schemaName:s}=Fn(t);return s.length>1?(this.enum.name=n,this.enum.schemaName=s.join("."),[new E(N.UNSUPPORTED,"Nested schema is not supported",t)]):(this.enum.name=n,this.enum.schemaName=s.length?s[0]:null,[])}interpretBody(t){return t.body.flatMap(n=>{var s;const r=n,i={};i.token=z(r),i.name=Xe(r.callee).unwrap();const o=(s=we(r.args[0]).getValue().note)==null?void 0:s.at(0);return i.note=o&&{value:Le(o.value).map(_t).unwrap(),token:z(o)},this.enum.values.push(i),[]})}}class Wd{constructor(t,n){this.declarationNode=t,this.env=n,this.tablePartial={name:void 0,fields:[],token:void 0,indexes:[],checks:[]},this.pkColumns=[]}interpret(){this.tablePartial.token=z(this.declarationNode),this.env.tablePartials.set(this.declarationNode,this.tablePartial);const t=[...this.interpretName(this.declarationNode.name),...this.interpretSettingList(this.declarationNode.attributeList),...this.interpretBody(this.declarationNode.body)];return this.pkColumns.length>=2&&(this.tablePartial.indexes.push({columns:this.pkColumns.map(({name:n,token:s})=>({value:n,type:"column",token:s})),token:{start:{offset:-1,line:-1,column:-1},end:{offset:-1,line:-1,column:-1}},pk:!0}),this.pkColumns.forEach(n=>{n.pk=!1})),t}interpretName(t){const{name:n}=Fn(t);return this.tablePartial.name=n,[]}interpretSettingList(t){const n=we(t).getValue(),s=My(n[A.HeaderColor]);this.tablePartial.headerColor=s?Qs(s.value):void 0;const[r]=n[A.Note]||[];return this.tablePartial.note=r&&{value:Le(r?.value).map(_t).unwrap(),token:z(r)},[]}interpretBody(t){const[n,s]=xt(t.body,r=>r instanceof re);return[...this.interpretFields(n),...this.interpretSubElements(s)]}interpretSubElements(t){return t.flatMap(n=>{var s;switch((s=n.type)==null?void 0:s.value.toLowerCase()){case $.Note:return this.tablePartial.note={value:Le(n.body instanceof jt?n.body.body[0].callee:n.body.callee).map(_t).unwrap(),token:z(n)},[];case $.Indexes:return this.interpretIndexes(n);case $.Check:return this.interpretChecks(n);default:return[]}})}interpretFields(t){return t.flatMap(n=>this.interpretColumn(n))}interpretColumn(t){var n,s,r,i,o,l,c,d,u;const f=[],p={};p.name=$e(t.callee).unwrap();const x=Vd(t.args[0]);p.type=x.getValue(),f.push(...x.getErrors()),p.token=z(t),p.inline_refs=[];const b=t.args.slice(1);if(ge(b)instanceof xe){const m=we(b.pop()).getValue();p.pk=!!((n=m[A.PK])!=null&&n.length)||!!((s=m[A.PrimaryKey])!=null&&s.length),p.increment=!!((r=m[A.Increment])!=null&&r.length),p.unique=!!((i=m[A.Unique])!=null&&i.length),p.not_null=(o=m[A.NotNull])!=null&&o.length?!0:(l=m[A.Null])!=null&&l.length?!1:void 0,p.dbdefault=$d((d=(c=m[A.Default])==null?void 0:c.at(0))==null?void 0:d.value);const g=(u=m[A.Note])==null?void 0:u.at(0);p.note=g&&{value:Le(g.value).map(_t).unwrap(),token:z(g)};const T=m[A.Ref]||[];p.inline_refs=T.flatMap(v=>{const[S]=Tr(v.value.expression);if(Ri(S,t.symbol))return f.push(new E(N.SAME_ENDPOINT,"Two endpoints are the same",v)),[];const I=v.value.op,k=Ze(v.value.expression).unwrap();let C;if(k.length===2){const[_,j]=k;C={schemaName:null,tableName:_,fieldNames:[j],relation:I.value,token:z(v)}}else if(k.length===3){const[_,j,R]=k;C={schemaName:_,tableName:j,fieldNames:[R],relation:I.value,token:z(v)}}else{f.push(new E(N.UNSUPPORTED,"Unsupported",v));const _=k.pop(),j=k.pop();C={schemaName:k.join("."),tableName:j,fieldNames:[_],relation:I.value,token:z(v)}}return C});const y=m[A.Check]||[];p.checks=y.map(v=>{const S=z(v),I=v.value.value.value;return{token:S,expression:I}})}return p.pk||(p.pk=b.some(m=>Xe(m).unwrap().toLowerCase()==="pk")),p.unique||(p.unique=b.some(m=>Xe(m).unwrap().toLowerCase()==="unique")),this.tablePartial.fields.push(p),p.pk&&this.pkColumns.push(p),f}interpretIndexes(t){return this.tablePartial.indexes.push(...t.body.body.map(n=>{var s,r,i,o,l,c,d;const u={columns:[]},f=n;u.token=z(f);const p=[f.callee,...f.args];if(ge(p)instanceof xe){const x=we(p.pop()).getValue();u.pk=!!((s=x[A.PK])!=null&&s.length),u.unique=!!((r=x[A.Unique])!=null&&r.length),u.name=Le((o=(i=x[A.Name])==null?void 0:i.at(0))==null?void 0:o.value).unwrap_or(void 0);const b=(l=x[A.Note])==null?void 0:l.at(0);u.note=b&&{value:Le(b.value).unwrap(),token:z(b)},u.type=Xe((d=(c=x[A.Type])==null?void 0:c.at(0))==null?void 0:d.value).unwrap_or(void 0)}return p.flatMap(x=>{if(!(x instanceof mt))return x;const b=[];let m=x;for(;m instanceof mt;)b.push(m.argumentList),m=m.callee;return b.push(m),b}).forEach(x=>{const{functional:b,nonFunctional:m}=_r(x).unwrap();u.columns.push(...b.map(g=>({value:g.value.value,type:"expression",token:z(g)})),...m.map(g=>({value:$e(g).unwrap(),type:"column",token:z(g)})))}),u})),[]}interpretChecks(t){return this.tablePartial.checks.push(...t.body.body.map(n=>{var s,r;const i={},o=n;if(i.token=z(o),o.args[0]instanceof xe){const l=we(o.args[0]).getValue();i.name=Le((r=(s=l[A.Name])==null?void 0:s.at(0))==null?void 0:r.value).unwrap_or(void 0)}return i.expression=o.callee.value.value,i})),[]}}class WE{constructor(t,n){this.declarationNode=t,this.env=n,this.project={enums:[],refs:[],tableGroups:[],tables:[],tablePartials:[]}}interpret(){return this.env.project.set(this.declarationNode,this.project),this.project.token=z(this.declarationNode),[...this.interpretName(this.declarationNode.name),...this.interpretBody(this.declarationNode.body)]}interpretName(t){if(!t)return this.project.name=null,[];const{name:n}=Fn(t);return this.project.name=n,[]}interpretBody(t){return t.body.flatMap(n=>{var s;const r=n;switch((s=r.type)==null?void 0:s.value.toLowerCase()){case"table":{const i=new Gd(r,this.env).interpret();return this.project.tables.push(this.env.tables.get(r)),i}case"ref":{const i=new zd(r,this.env).interpret();return this.project.refs.push(this.env.ref.get(r)),i}case"tablegroup":{const i=new Kd(r,this.env).interpret();return this.project.tableGroups.push(this.env.tableGroups.get(r)),i}case"enum":{const i=new Xd(r,this.env).interpret();return this.project.enums.push(this.env.enums.get(r)),i}case"note":return this.project.note={value:Le(r.body instanceof jt?r.body.body[0].callee:r.body.callee).map(_t).unwrap(),token:z(r)},[];case"tablepartial":{const i=new Wd(r,this.env).interpret();return this.project.tablePartials.push(this.env.tablePartials.get(r)),i}default:return this.project[r.type.value.toLowerCase()]=Le(r.body.callee).unwrap(),[]}})}}function HE(e){return{schemas:[],tables:Array.from(e.tables.values()),notes:Array.from(e.notes.values()),refs:Array.from(e.ref.values()),enums:Array.from(e.enums.values()),tableGroups:Array.from(e.tableGroups.values()),aliases:e.aliases,project:Array.from(e.project.values())[0]||{},tablePartials:Array.from(e.tablePartials.values())}}class qE{constructor(t){this.ast=t,this.env={schema:[],tables:new Map,notes:new Map,refIds:{},ref:new Map,enums:new Map,tableGroups:new Map,groupOfTable:{},aliases:[],project:new Map,tablePartials:new Map}}interpret(){const t=this.ast.body.flatMap(n=>{switch(un(n).unwrap_or(void 0)){case $.Table:return new Gd(n,this.env).interpret();case $.Note:return new XE(n,this.env).interpret();case $.Ref:return new zd(n,this.env).interpret();case $.TableGroup:return new Kd(n,this.env).interpret();case $.TablePartial:return new Wd(n,this.env).interpret();case $.Enum:return new Xd(n,this.env).interpret();case $.Project:return new WE(n,this.env).interpret();default:return[]}});return new lt(HE(this.env),t)}}var le=(e=>(e[e.Function=1]="Function",e[e.Constructor=2]="Constructor",e[e.Field=3]="Field",e[e.Variable=4]="Variable",e[e.Class=5]="Class",e[e.Struct=6]="Struct",e[e.Interface=7]="Interface",e[e.Module=8]="Module",e[e.Property=9]="Property",e[e.Event=10]="Event",e[e.Operator=11]="Operator",e[e.Unit=12]="Unit",e[e.Value=13]="Value",e[e.Constant=14]="Constant",e[e.Enum=15]="Enum",e[e.EnumMember=16]="EnumMember",e[e.Keyword=17]="Keyword",e[e.Text=18]="Text",e[e.Color=19]="Color",e[e.File=20]="File",e[e.Reference=21]="Reference",e[e.Customcolor=22]="Customcolor",e[e.Folder=23]="Folder",e[e.TypeParameter=24]="TypeParameter",e[e.User=25]="User",e[e.Issue=26]="Issue",e[e.Snippet=27]="Snippet",e))(le||{}),ye=(e=>(e[e.None=0]="None",e[e.KeepWhitespace=1]="KeepWhitespace",e[e.InsertAsSnippet=4]="InsertAsSnippet",e))(ye||{});function Vs(e){switch(e){case U.Schema:return le.Module;case U.Table:case U.TablePartial:return le.Class;case U.Column:case U.TableGroupField:return le.Field;case U.Enum:return le.Enum;case U.EnumField:return le.EnumMember;case U.TableGroup:return le.Struct;default:return le.Text}}function wr(e,t){if(!e||Ja(e))return!1;for(const n of e.trailingTrivia){if(n.start>t)break;if(n.kind===w.NEWLINE&&n.end<=t)return!1}return!0}function Ve(){return{suggestions:[]}}function Cr(e){return{...e,suggestions:e.suggestions.map(t=>({...t,insertText:` ${t.insertText}`}))}}function na(e){return{...e,suggestions:e.suggestions.map(t=>({...t,insertText:t.insertText.split("").every(Jr)?t.insertText:`"${t.insertText}"`}))}}function Mi(e,t){return e.getOffsetAt(t)}class Hd{constructor(t,n=[]){this.compiler=t,this.triggerCharacters=n}provideCompletionItems(t,n){var s,r;const i=Mi(t,n),o=this.compiler.token.flatStream(),{token:l,index:c}=this.compiler.container.token(i),d=c===void 0?o[0]:o[c+1];if([...l?.trailingTrivia||[],...l?.leadingTrivia||[],...d?.leadingTrivia||[]].find(p=>By(p)&&Rs(i,p)))return Ve();if(c===void 0)return ml();if([w.STRING_LITERAL,w.QUOTED_STRING].includes(l.kind)&&Rs(i,l))return Ve();const u=this.compiler.container.element(i);if(this.compiler.container.scopeKind(i)===be.TOPLEVEL||u instanceof ce&&u.type&&u.type.start<=i&&u.type.end>=i)return ml();const f=[...this.compiler.container.stack(i)].reverse();for(const p of f)if(p instanceof ft)switch((s=p.op)==null?void 0:s.value){case">":case"<":case"<>":case"-":return ul(this.compiler,i,p)}else if(p instanceof Ft)switch((r=p.op)==null?void 0:r.value){case">":case"<":case"<>":case"-":return ul(this.compiler,i,p);case".":return qd(this.compiler,i,p)}else{if(p instanceof yt)return hl(this.compiler,i,p);if(p instanceof xe)return hl(this.compiler,i,p);if(p instanceof Ut)return QE(this.compiler,i);if(p instanceof kn)return YE(this.compiler,i);if(p instanceof re)return pl(this.compiler,i,p);if(p instanceof ce&&(p.bodyColon&&i>=p.bodyColon.end||p.body&&Rs(i,p.body)))return pl(this.compiler,i,void 0)}return Ve()}}function YE(e,t){const n=e.container.element(t);return ys(e,t,n,[U.TablePartial])}function ul(e,t,n){const s=e.container.scopeKind(t);if([be.REF,be.TABLE,be.TABLEPARTIAL].includes(s)){const r=ys(e,t,e.container.element(t),[U.Table,U.Schema,U.Column]);return wr(n.op,t)?Cr(r):r}return Ve()}function ys(e,t,n,s){var r;if(n===void 0)return Ve();let i=n;const o={suggestions:[]};for(;i;){if((r=i?.symbol)!=null&&r.symbolTable){const{symbol:l}=i;o.suggestions.push(...e.symbol.members(l).filter(({kind:c})=>s.includes(c)).map(({name:c,kind:d})=>({label:c,insertText:c,insertTextRules:ye.KeepWhitespace,kind:Vs(d),sortText:Vs(d).toString().padStart(2,"0"),range:void 0})))}i=i instanceof ce?i.parent:void 0}return na(o)}function QE(e,t){var n;switch(e.container.scopeKind(t)){case be.INDEXES:return Qd(e,t);case be.REF:{const s=[...e.container.stack(t)];for(;s.length>0;){const r=s.pop();if(r instanceof Ft&&((n=r.op)==null?void 0:n.value)===".")return qd(e,t,r)}}return Yd(e,t)}return Ve()}function hl(e,t,n){const{token:s}=e.container.token(t);if([w.COMMA,w.LBRACKET].includes(s?.kind)){const r=fl(e,t);return s?.kind===w.COMMA&&wr(s,t)?Cr(r):r}if(n.name&&n.name.start<=t&&n.name.end>=t)return fl(e,t);if(n.name instanceof Nt){const r=JE(e,t,Qn(n.name).unwrap_or(""));return s?.kind===w.COLON&&wr(s,t)?Cr(r):r}return Ve()}function fl(e,t){const n=e.container.element(t);if(n instanceof ht)return Ve();const s=e.container.scopeKind(t);if(n.body&&!Rs(t,n.body)){let r;switch(s){case be.TABLE:case be.TABLEPARTIAL:r=[A.HeaderColor,A.Note];break;case be.TABLEGROUP:r=[A.Color,A.Note];break;default:r=[]}return{suggestions:r.map(i=>({label:i,insertText:`${i}: `,kind:le.Field,insertTextRules:ye.KeepWhitespace,range:void 0}))}}switch(s){case be.TABLE:case be.TABLEPARTIAL:return{suggestions:[...[A.PK,A.PrimaryKey,A.Null,A.NotNull,A.Increment,A.Unique].map(r=>({label:r,insertText:r,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0})),...[A.Ref,A.Default,A.Note,A.Check].map(r=>({label:r,insertText:`${r}: `,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0}))]};case be.ENUM:return{suggestions:[...[A.Note].map(r=>({label:r,insertText:`${r}: `,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0}))]};case be.INDEXES:return{suggestions:[...[A.Unique,A.PK].map(r=>({label:r,insertText:r,insertTextRules:ye.KeepWhitespace,kind:le.Property,range:void 0})),...[A.Note,A.Name,A.Type].map(r=>({label:r,insertText:`${r}: `,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0}))]};case be.REF:return{suggestions:[A.Update,A.Delete,A.Color].map(r=>({label:r,insertText:`${r}: `,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0}))};case be.CHECKS:return{suggestions:[A.Name].map(r=>({label:r,insertText:`${r}: `,kind:le.Property,insertTextRules:ye.KeepWhitespace,range:void 0}))}}return Ve()}function JE(e,t,n){switch(n?.toLowerCase()){case"update":case"delete":return{suggestions:["cascade","set default","set null","restrict"].map(s=>({label:s,insertText:s,kind:le.Value,insertTextRules:ye.KeepWhitespace,range:void 0}))};case"type":return{suggestions:["btree","hash"].map(s=>({label:s,insertText:`${s}`,kind:le.Value,insertTextRules:ye.KeepWhitespace,range:void 0}))};case"default":return ys(e,t,e.container.element(t),[U.Schema,U.Enum])}return Ve()}function qd(e,t,n){const s=Wt(n).unwrap_or([]);if(s.pop(),s.some(i=>!Oe(i)))return Ve();const r=s.map(i=>Xe(i).unwrap());return na({suggestions:e.symbol.ofName({nameStack:r,owner:e.container.element(t)}).flatMap(({symbol:i})=>e.symbol.members(i)).map(({kind:i,name:o})=>({label:o,insertText:o,kind:Vs(i),range:void 0}))})}function pl(e,t,n){var s;switch(e.container.scopeKind(t)){case be.TABLE:case be.TABLEPARTIAL:return e_(e,t,n);case be.PROJECT:return t_(e,t,n);case be.INDEXES:return s_(e,t);case be.ENUM:return ZE(e,t,n);case be.REF:{const r=Yd(e,t);return((s=e.container.token(t).token)==null?void 0:s.kind)===w.COLON&&wr(e.container.token(t).token,t)?Cr(r):r}case be.TABLEGROUP:return n_(e);default:return Ve()}}function ml(){return{suggestions:["Table","TableGroup","Enum","Project","Ref","TablePartial"].map(e=>({label:e,insertText:e,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))}}function ZE(e,t,n){return n!=null&&n.callee&&Oi(t,n)===1?ys(e,t,e.container.element(t),[U.Schema,U.Table,U.Column]):Ve()}function e_(e,t,n){const s=["Note","indexes","checks"];if(!(n!=null&&n.callee))return{suggestions:s.map(i=>({label:i,insertText:i,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))};const r=Oi(t,n);return r===0?{suggestions:s.map(i=>({label:i,insertText:i,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))}:r===1?r_(e,t):Ve()}function t_(e,t,n){const s=["Table","TableGroup","Enum","Note","Ref","TablePartial"];return n!=null&&n.callee?Oi(t,n)===0?{suggestions:s.map(r=>({label:r,insertText:r,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))}:Ve():{suggestions:s.map(r=>({label:r,insertText:r,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))}}function Yd(e,t){return ys(e,t,e.container.element(t),[U.Schema,U.Table,U.Column])}function n_(e){return{suggestions:[...na({suggestions:[...e.parse.publicSymbolTable().entries()].flatMap(([t])=>{const n=Et(t).unwrap_or(void 0);if(n===void 0)return[];const{kind:s,name:r}=n;return s!==U.Table&&s!==U.Schema?[]:{label:r,insertText:r,insertTextRules:ye.KeepWhitespace,kind:Vs(s),range:void 0}})}).suggestions,...["Note"].map(t=>({label:t,insertText:t,insertTextRules:ye.KeepWhitespace,kind:le.Keyword,range:void 0}))]}}function s_(e,t){return Qd(e,t)}function r_(e,t){return{suggestions:[...["integer","int","tinyint","smallint","mediumint","bigint","bit","bool","binary","varbinary","logical","char","nchar","varchar","varchar2","nvarchar","nvarchar2","binary_float","binary_double","float","double","decimal","dec","real","money","smallmoney","enum","tinyblob","tinytext","blob","text","mediumblob","mediumtext","longblob","longtext","ntext","set","inet6","uuid","image","date","time","datetime","datetime2","timestamp","year","smalldatetime","datetimeoffset","XML","sql_variant","uniqueidentifier","CURSOR","BFILE","CLOB","NCLOB","RAW"].map(n=>({label:n,insertText:n,insertTextRules:ye.KeepWhitespace,kind:le.TypeParameter,sortText:le.TypeParameter.toString().padStart(2,"0"),range:void 0})),...ys(e,t,e.container.element(t),[U.Enum,U.Schema]).suggestions]}}function Qd(e,t){const n=e.container.element(t),s=n?.parent;if(!(s?.symbol instanceof Sd))return Ve();const{symbolTable:r}=s.symbol;return na({suggestions:[...r.entries()].flatMap(([i])=>{const o=Et(i).unwrap_or(void 0);if(o===void 0)return[];const{name:l}=o;return{label:l,insertText:l,insertTextRules:ye.KeepWhitespace,kind:Vs(U.Column),range:void 0}})})}function Oi(e,t){if(!t.callee)return-1;const n=[t.callee,...t.args],s=n.findIndex(r=>e<=r.end);return s===-1?n.length:s}class Jd{constructor(t){this.compiler=t}provideDefinition(t,n){var s,r;const{uri:i}=t,o=Mi(t,n),l=[...this.compiler.container.stack(o)];for(;l.length!==0;){const c=l.pop();if(!(c!=null&&c.referee))continue;let d;if((s=c.referee)!=null&&s.declaration&&[Tn.PRIMARY_EXPRESSION,Tn.VARIABLE,Tn.PARTIAL_INJECTION].includes(c?.kind)?{declaration:d}=c.referee:(r=c.referee)!=null&&r.injectorDeclaration&&(d=c.referee.injectorDeclaration),d){const{startPos:u,endPos:f}=d;return[{range:{startColumn:u.column+1,startLineNumber:u.line+1,endColumn:f.column+1,endLineNumber:f.line+1},uri:i}]}}return[]}}class Zd{constructor(t){this.compiler=t}provideReferences(t,n){const{uri:s}=t,r=Mi(t,n),i=[...this.compiler.container.stack(r)];for(;i.length!==0;){const o=i.pop();if(o&&[Tn.ELEMENT_DECLARATION,Tn.FUNCTION_APPLICATION,Tn.PRIMARY_EXPRESSION].includes(o?.kind)){const{symbol:l}=o;if(l!=null&&l.references.length)return l.references.map(({startPos:c,endPos:d})=>({range:{startColumn:c.column+1,startLineNumber:c.line+1,endColumn:d.column+1,endLineNumber:d.line+1},uri:s}))}}return[]}}const a_=Object.freeze(Object.defineProperty({__proto__:null,CompletionItemInsertTextRule:ye,CompletionItemKind:le,DBMLCompletionItemProvider:Hd,DBMLDefinitionProvider:Jd,DBMLReferencesProvider:Zd},Symbol.toStringTag,{value:"Module"}));var be=(e=>(e[e.TABLE=0]="TABLE",e[e.ENUM=1]="ENUM",e[e.TABLEGROUP=2]="TABLEGROUP",e[e.INDEXES=3]="INDEXES",e[e.NOTE=4]="NOTE",e[e.REF=5]="REF",e[e.PROJECT=6]="PROJECT",e[e.CUSTOM=7]="CUSTOM",e[e.TOPLEVEL=8]="TOPLEVEL",e[e.TABLEPARTIAL=9]="TABLEPARTIAL",e[e.CHECKS=10]="CHECKS",e))(be||{});class i_{constructor(){this.source="",this.cache=new Array(16).fill(null),this.nodeIdGenerator=new $y,this.symbolIdGenerator=new Xy,this.token={invalidStream:this.createQuery(6,()=>this.parse.tokens().filter(Ld)),flatStream:this.createQuery(7,()=>this.parse.tokens().flatMap(t=>[...t.leadingInvalid,t,...t.trailingInvalid]))},this.parse={source:()=>this.source,_:this.createQuery(0,()=>{const t=new oE(this.source).lex().chain(n=>new dE(n,this.nodeIdGenerator).parse()).chain(({ast:n,tokens:s})=>new KE(n,this.symbolIdGenerator).analyze().map(()=>({ast:n,tokens:s})));return t.getErrors().length>0?t:t.chain(({ast:n,tokens:s})=>new qE(n).interpret().map(r=>({ast:n,tokens:s,rawDb:r})))}),ast:this.createQuery(1,()=>this.parse._().getValue().ast),errors:this.createQuery(2,()=>this.parse._().getErrors()),tokens:this.createQuery(4,()=>this.parse._().getValue().tokens),rawDb:this.createQuery(3,()=>this.parse._().getValue().rawDb),publicSymbolTable:this.createQuery(5,()=>this.parse._().getValue().ast.symbol.symbolTable)},this.container={stack:this.createQuery(10,t=>{const n=this.token.flatStream(),{index:s,token:r}=this.container.token(t),i=s===void 0?-1:Ry(n,d=>!d.isInvalid,s);if(i===-1)return[this.parse.ast()];const o=n[i].start;let l=this.parse.ast();const c=[l];for(;;){const d=iE(l).find(u=>Rs(o,u));if(d===void 0||d instanceof ot)break;c.push(d),l=d}if(r?.kind===w.COLON)return c;for(;c.length>0;){let d=!1;const u=ge(c);if(u instanceof re){const f=this.parse.source();for(let p=u.end;p<t;p+=1)f[p]===`
`&&(c.pop(),d=!0)}else u instanceof ft||u instanceof Ft?this.container.token(t).token!==u.op&&(c.pop(),d=!0):u instanceof xe?u.listCloseBracket&&u.end<=t&&(c.pop(),d=!0):u instanceof Ut?u.tupleCloseParen&&u.end<=t&&(c.pop(),d=!0):u instanceof jt?u.blockCloseBrace&&u.end<=t&&(c.pop(),d=!0):u instanceof Nt||u.end<t&&(c.pop(),d=!0);if(d){const f=ge(c);f instanceof ce&&f.end<=t&&c.pop()}if(!d)break}return c}),token:this.createQuery(11,t=>{const n=this.token.flatStream().findIndex(s=>s.start>=t);return n===void 0?{token:void 0,index:void 0}:n<=0?{token:void 0,index:void 0}:{token:this.token.flatStream()[n-1],index:n-1}}),element:this.createQuery(12,t=>{const n=this.container.stack(t);for(let s=n.length-1;s>=0;s-=1)if(n[s]instanceof ce)return n[s];return this.parse.ast()}),scope:this.createQuery(14,t=>{var n,s;return(s=(n=this.container.element(t))==null?void 0:n.symbol)==null?void 0:s.symbolTable}),scopeKind:this.createQuery(15,t=>{var n;if(this.container.element(t)instanceof ht)return 8;switch((n=this.container.element(t).type)==null?void 0:n.value.toLowerCase()){case"table":return 0;case"enum":return 1;case"ref":return 5;case"tablegroup":return 2;case"indexes":return 3;case"note":return 4;case"project":return 6;case"tablepartial":return 9;case"checks":return 10;default:return 7}})},this.symbol={ofName:this.createQuery(8,({nameStack:t,owner:n=this.parse.ast()})=>{var s;if(t.length===0)return[];const r=[];for(let i=n;i;i=i instanceof ce?i.parent:void 0){if(!((s=i.symbol)!=null&&s.symbolTable))continue;const{symbolTable:o}=i.symbol;let l=[o],c=[];for(const d of t)c=l.flatMap(u=>eE(d).flatMap(f=>{const p=u.get(f),x=Et(f).unwrap_or(void 0);return!p||!x?[]:{...x,symbol:p}})),l=c.flatMap(u=>u.symbol.symbolTable?u.symbol.symbolTable:[]);r.push(...c)}return r},({nameStack:t,owner:n})=>`${t.join(".")}@${n.id}`),members:this.createQuery(9,t=>t.symbolTable?[...t.symbolTable.entries()].map(([n,s])=>({...Et(n).unwrap(),symbol:s})):[])}}createQuery(t,n,s){return r=>{const i=this.cache[t],o=r&&s?s(r):r;if(i!==null){if(!(i instanceof Map))return i;if(i.has(o))return i.get(o)}const l=n(r);return r!==void 0?i instanceof Map?i.set(o,l):(this.cache[t]=new Map,this.cache[t].set(o,l)):this.cache[t]=l,l}}setSource(t){this.source=t,this.cache=new Array(16).fill(null),this.nodeIdGenerator.reset(),this.symbolIdGenerator.reset()}initMonacoServices(){return{definitionProvider:new Jd(this),referenceProvider:new Zd(this),autocompletionProvider:new Hd(this)}}}const o_=[" ","[",":",".",">","<","-"];function l_(e,t=""){const n=new i_;t&&n.setSource(t);const s=new a_.DBMLCompletionItemProvider(n,o_),r=e.languages.registerCompletionItemProvider("dbml",s);return{dispose:()=>r.dispose(),updateSource:i=>{n.setSource(i)}}}const c_=e=>e==="dark"?"dbml-dark":"dbml-light",d_=()=>{const{currentDiagram:e,updateDiagramData:t,databaseType:n,readonly:s}=se(),{effectiveTheme:r}=Or(),{toast:i}=Dh(),[o,l]=h.useState("inline"),[c,d]=h.useState(!0),[u,f]=h.useState(""),[p,x]=h.useState(""),b=h.useRef(!0),[m,g]=h.useState(!1),T=h.useRef(),y=h.useRef(),v=h.useRef(),S=h.useCallback((q,Z)=>{T.current=q,y.current=q.createDecorationsCollection(),ee.current&&ee.current.dispose();const fe=q.onDidAttemptReadOnlyEdit(()=>{Re.current&&clearTimeout(Re.current),g(!1),requestAnimationFrame(()=>{g(!0),Re.current=setTimeout(()=>{g(!1)},600)})});ee.current=fe,v.current?.dispose(),v.current=l_(Z,q.getValue())},[]),I=h.useMemo(()=>o==="inline"?p:u,[o,p,u]),k=h.useCallback(()=>{l(q=>q==="inline"?"standard":"inline")},[]),[C,_]=h.useState(!1),[j,R]=h.useState(""),L=h.useRef(j),{calculateDiff:X,originalDiagram:P,resetDiff:F,hasDiff:Q,newDiagram:J}=Rh(),{loadDiagramFromData:te}=se(),[je,me]=h.useState(),[qe,Ye]=h.useState(),{t:he}=ie(),{hideLoader:De,showLoader:Se}=vf(),Re=h.useRef(),ee=h.useRef(),V=h.useRef(e),Y=h.useRef(P);h.useEffect(()=>{V.current=e},[e]),h.useEffect(()=>{Y.current=P},[P]),h.useEffect(()=>{if(C)return;let q=!1;const Z=new Set;if(e.tables?.forEach(fe=>{fe.fields.forEach(Qe=>{Qe.name===""&&(q=!0,Z.add(fe.name))})}),q){const fe=Array.from(Z).join(", ");Ye(`Some fields had empty names in tables: [${fe}] and were excluded from the DBML export.`)}},[e.tables,he,C]),h.useEffect(()=>{if(C){d(!1);return}me(void 0),Hi(y.current);const q=async()=>{d(!0);const Z=Dx(e);Z.error&&i({title:"DBML Export Error",description:`Could not generate DBML: ${Z.error.substring(0,100)}${Z.error.length>100?"...":""}`,variant:"destructive"}),f(Z.standardDbml),x(Z.inlineDbml),d(!1)};setTimeout(()=>q(),0)},[e,i,C]),h.useEffect(()=>{!c&&I&&!C&&(R(I),L.current=I)},[I,c,C]);const oe=h.useCallback(async q=>{Hi(y.current),me(void 0);try{const Z=await Nf(q,{databaseType:n}),fe=Y.current??V.current,Qe={...fe,tables:Z.tables,relationships:Z.relationships,customTypes:Z.customTypes},Ht=Kx({sourceDiagram:fe,targetDiagram:Qe});Y.current&&(F(),te(Y.current)),X({diagram:fe,newDiagram:Ht,options:{summaryOnly:!0}})}catch(Z){const fe=yf(Z);fe&&(Ef({error:fe,model:T.current?.getModel(),editorDecorationsCollection:y.current}),me(he("import_dbml_dialog.error.description")+` (1 error found - in line ${fe.line})`))}},[he,F,te,X,n]),{run:B}=kp(oe,{wait:1e3});h.useEffect(()=>{!C||!j||j!==L.current&&(L.current=j,B(j))},[j,C,B]);const W=h.useCallback(async()=>{j&&J&&(Se(),await t(J,{forceUpdateStorage:!0}),F(),R(j),_(!1),L.current=j,De())},[j,t,J,F,Se,De]),H=h.useCallback(()=>{j&&P&&(te(P),_(!1),F(),R(I),L.current=I)},[j,te,P,F,I]);return h.useEffect(()=>{v.current?.updateSource(j)},[j]),h.useEffect(()=>(b.current=!0,()=>{b.current=!1,Re.current&&clearTimeout(Re.current),ee.current&&(ee.current.dispose(),ee.current=void 0),v.current&&(v.current.dispose(),v.current=void 0)}),[]),h.useEffect(()=>{const q=H;return()=>{setTimeout(()=>{b.current||q()},0)}},[H]),a.jsxs(a.Fragment,{children:[a.jsx(_f,{code:j,loading:c,actionsTooltipSide:"right",className:"my-0.5",allowCopy:!C,actions:C&&Q?[{label:"Accept Changes",icon:Dn,onClick:W,className:"h-7 items-center gap-1.5 rounded-md border border-green-200 bg-green-50 px-2.5 py-1.5 text-xs font-medium text-green-600 shadow-sm hover:bg-green-100 dark:border-green-800 dark:bg-green-800 dark:text-green-200 dark:hover:bg-green-700"},{label:"Undo Changes",icon:pp,onClick:H,className:"h-7 items-center gap-1.5 rounded-md border border-red-200 bg-red-50 px-2.5 py-1.5 text-xs font-medium text-red-600 shadow-sm hover:bg-red-100 dark:border-red-800 dark:bg-red-800 dark:text-red-200 dark:hover:bg-red-700"}]:C&&!Q?[{label:"View",icon:cp,onClick:()=>{F(),_(q=>!q)}}]:[{label:`Show ${o==="inline"?"Standard":"Inline"} Refs`,icon:Ml,onClick:k},...s?[]:[{label:"Edit",icon:ns,onClick:()=>_(q=>!q),className:m?"dbml-edit-button-emphasis":void 0}]],editorProps:{height:"100%",defaultLanguage:"dbml",beforeMount:Tf,theme:c_(r),onMount:S,options:{wordWrap:"off",mouseWheelZoom:!1,readOnly:!C,autoClosingBrackets:"always",autoClosingQuotes:"always",autoSurround:"languageDefined"},onChange:q=>{R(q??"")}}}),qe?a.jsx("div",{className:"my-2 rounded-md border border-blue-200 bg-blue-50 p-3 dark:border-blue-900/50 dark:bg-blue-950/20",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(pr,{className:"mt-0.5 size-4 shrink-0 text-blue-600 dark:text-blue-400"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Warning"}),a.jsx("p",{className:"mt-0.5 text-xs text-blue-700 dark:text-blue-300",children:qe})]}),a.jsx("button",{onClick:()=>Ye(void 0),className:"rounded p-0.5 text-blue-600 hover:bg-blue-100 dark:text-blue-400 dark:hover:bg-blue-900/50","aria-label":"Close warning",children:a.jsx(Rn,{className:"size-3.5"})})]})}):null,je?a.jsx("div",{className:"my-2 rounded-md border border-orange-200 bg-orange-50 p-3 dark:border-orange-900/50 dark:bg-orange-950/20",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(pr,{className:"mt-0.5 size-4 shrink-0 text-orange-600 dark:text-orange-400"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-orange-800 dark:text-orange-200",children:"Syntax Error"}),a.jsx("p",{className:"mt-0.5 text-xs text-orange-700 dark:text-orange-300",children:je||he("import_dbml_dialog.error.description")})]})]})}):null]})},u_=()=>a.jsx("section",{className:"flex flex-1 flex-col overflow-hidden px-2","data-vaul-no-drag":!0,children:a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(d_,{})})}),h_=({relationship:e})=>{const{updateRelationship:t,removeRelationship:n,readonly:s}=se(),{deleteElements:r}=Ar(),{t:i}=ie(),{focusOnRelationship:o}=Rr(),[l,c]=D.useState(!1),[d,u]=D.useState(e.name),f=D.useRef(null),p=h.useCallback(()=>{l&&(d.trim()&&d!==e.name&&t(e.id,{name:d.trim()}),c(!1))},[d,e.id,t,l,e.name]);zs(f,p),cn("Enter",p);const x=T=>{T.stopPropagation(),c(!0)},b=h.useCallback(T=>{T.stopPropagation(),o(e.id,e.sourceTableId,e.targetTableId)},[o,e.id,e.sourceTableId,e.targetTableId]),m=h.useCallback(()=>{n(e.id),r({edges:[{id:e.id}]})},[e.id,n,r]),g=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-40",children:[a.jsx(Zn,{children:i("side_panel.refs_section.relationship.relationship_actions.title")}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:m,className:"flex justify-between !text-red-700",children:[i("side_panel.refs_section.relationship.relationship_actions.delete_relationship"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})})]})]}),[m,i]);return a.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[a.jsx("div",{className:"flex min-w-0 flex-1",children:l?a.jsx(Ie,{ref:f,autoFocus:!0,type:"text",placeholder:e.name,value:d,onClick:T=>T.stopPropagation(),onChange:T=>u(T.target.value),className:"h-7 w-full focus-visible:ring-0"}):a.jsx("div",{className:"truncate",children:e.name})}),a.jsx("div",{className:"flex flex-row-reverse items-center",children:l?a.jsx(Ae,{onClick:p,children:a.jsx(Dn,{})}):a.jsxs(a.Fragment,{children:[s?null:a.jsx("div",{children:g()}),a.jsxs("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:[s?null:a.jsx(Ae,{onClick:x,children:a.jsx(ns,{})}),a.jsx(Ae,{onClick:b,children:a.jsx(Ks,{})})]})]})})]})},f_=({relationship:e})=>{const{getTable:t,getField:n,updateRelationship:s,removeRelationship:r,readonly:i}=se(),{deleteElements:o}=Ar(),{t:l}=ie(),c=h.useMemo(()=>Pf({sourceCardinality:e.sourceCardinality,targetCardinality:e.targetCardinality}),[e.sourceCardinality,e.targetCardinality]),d=h.useCallback(g=>{g==="one_to_one"?s(e.id,{sourceCardinality:"one",targetCardinality:"one"}):g==="one_to_many"&&s(e.id,{sourceCardinality:"one",targetCardinality:"many"})},[e.id,s]),u=h.useCallback(()=>{e.sourceCardinality===e.targetCardinality?s(e.id,{sourceSchema:e.targetSchema,targetSchema:e.sourceSchema,sourceTableId:e.targetTableId,targetTableId:e.sourceTableId,sourceFieldId:e.targetFieldId,targetFieldId:e.sourceFieldId,sourceCardinality:e.targetCardinality,targetCardinality:e.sourceCardinality}):e.sourceCardinality==="many"?s(e.id,{sourceCardinality:"one",targetCardinality:"many"}):s(e.id,{sourceSchema:e.targetSchema,targetSchema:e.sourceSchema,sourceTableId:e.targetTableId,targetTableId:e.sourceTableId,sourceFieldId:e.targetFieldId,targetFieldId:e.sourceFieldId})},[e,s]),f=t(e.targetTableId),p=n(e.targetTableId,e.targetFieldId),x=t(e.sourceTableId),b=n(e.sourceTableId,e.sourceFieldId),m=h.useCallback(()=>{r(e.id),o({edges:[{id:e.id}]})},[e.id,r,o]);return a.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1 py-2",children:[a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex items-center justify-between gap-1 text-xs",children:[a.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Ll,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.primary")})]}),a.jsxs(Ee,{children:[a.jsx(_e,{children:a.jsxs("div",{className:"truncate text-left text-sm",children:[x?.schema?`${x.schema}.`:"",x?.name,"(",b?.name,")"]})}),a.jsxs(Te,{children:[x?.schema?`${x.schema}.`:"",x?.name,"(",b?.name,")"]})]})]}),a.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Al,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.foreign")})]}),a.jsxs(Ee,{children:[a.jsx(_e,{children:a.jsxs("div",{className:"truncate text-left text-sm",children:[f?.schema?`${f.schema}.`:"",f?.name,"(",p?.name,")"]})}),a.jsxs(Te,{children:[f?.schema?`${f.schema}.`:"",f?.name,"(",p?.name,")"]})]})]})]}),a.jsxs("div",{className:"flex flex-col gap-2 text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center justify-between",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Gf,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:l("side_panel.refs_section.relationship.cardinality")})]}),!i&&a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx(K,{variant:"ghost",size:"sm",className:"size-7 p-0 text-sky-600 hover:bg-sky-50 hover:text-sky-700",onClick:u,children:a.jsx(Ml,{className:"!size-3.5"})})}),a.jsx(Te,{children:l("side_panel.refs_section.relationship.switch_tables")})]})]}),a.jsxs(Xs,{value:c,onValueChange:d,disabled:i,children:[a.jsx(as,{className:"h-8",children:a.jsx(Ws,{})}),a.jsx(is,{children:a.jsxs(Ms,{children:[a.jsx(Ke,{value:"one_to_one",children:l("relationship_type.one_to_one")}),a.jsx(Ke,{value:"one_to_many",children:l("relationship_type.one_to_many")})]})})]})]})]}),i?null:a.jsx("div",{className:"flex flex-1 items-center justify-center pt-2",children:a.jsxs(K,{variant:"ghost",className:"h-8 p-2 text-xs",onClick:m,children:[a.jsx(bt,{className:"mr-1 size-3.5 text-red-700"}),a.jsx("div",{className:"text-red-700",children:l("side_panel.refs_section.relationship.delete_relationship")})]})})]})},eu=D.forwardRef(({relationship:e},t)=>a.jsxs(rn,{value:e.id,className:"rounded-md",ref:t,children:[a.jsx(an,{asChild:!0,className:"w-full rounded-md px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",children:a.jsx(h_,{relationship:e})}),a.jsx(on,{className:"p-1 pb-0",children:a.jsx(f_,{relationship:e})})]}));eu.displayName="RelationshipListItem";const p_=({dependency:e})=>{const{removeDependency:t,getTable:n}=se(),{fitView:s,deleteElements:r,setEdges:i}=Ar(),{t:o}=ie(),{hideSidePanel:l}=et(),{isMd:c}=oi("md"),d=h.useMemo(()=>{const x=n(e.tableId),b=n(e.dependentTableId);return!x||!b?"":`${b.name} -> ${x.name}`},[e.tableId,e.dependentTableId,n]),u=h.useCallback(x=>{x.stopPropagation(),i(b=>b.map(m=>m.id==e.id?{...m,selected:!0}:{...m,selected:!1})),s({duration:500,maxZoom:1,minZoom:1,nodes:[{id:e.tableId},{id:e.dependentTableId}]}),c||l()},[s,e.tableId,e.dependentTableId,i,e.id,c,l]),f=h.useCallback(()=>{t(e.id),r({edges:[{id:e.id}]})},[e.id,t,r]),p=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-40",children:[a.jsx(Zn,{children:o("side_panel.refs_section.dependency.dependency_actions.title")}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:f,className:"flex justify-between !text-red-700",children:[o("side_panel.refs_section.dependency.dependency_actions.delete_dependency"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})})]})]}),[f,o]);return a.jsxs("div",{className:"group flex h-11 flex-1 items-center justify-between gap-1 overflow-hidden",children:[a.jsx("div",{className:"flex min-w-0 flex-1",children:a.jsx("div",{className:"truncate",children:d})}),a.jsxs("div",{className:"flex flex-row-reverse items-center",children:[a.jsx("div",{children:p()}),a.jsx("div",{className:"flex flex-row-reverse md:hidden md:group-hover:flex",children:a.jsx(Ae,{onClick:u,children:a.jsx(Ks,{})})})]})]})},m_=({dependency:e})=>{const{getTable:t,removeDependency:n}=se(),{deleteElements:s}=Ar(),{t:r}=ie(),i=t(e.tableId),o=t(e.dependentTableId),l=h.useCallback(()=>{n(e.id),s({edges:[{id:e.id}]})},[e.id,n,s]);return a.jsxs("div",{className:"my-1 flex flex-col rounded-b-md px-1",children:[a.jsx("div",{className:"flex flex-col gap-6",children:a.jsxs("div",{className:"flex items-center justify-between gap-1 text-xs",children:[a.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Al,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:r("side_panel.refs_section.dependency.dependent_table")})]}),a.jsxs(Ee,{children:[a.jsx(_e,{children:a.jsx("div",{className:"truncate text-left text-sm	",children:o?.name})}),a.jsx(Te,{children:o?.name})]})]}),a.jsxs("div",{className:"flex basis-1/2 flex-col gap-2 overflow-hidden text-xs",children:[a.jsxs("div",{className:"flex flex-row items-center gap-1",children:[a.jsx(Ll,{className:"size-4 text-subtitle"}),a.jsx("div",{className:"font-bold text-subtitle",children:r("side_panel.refs_section.dependency.table")})]}),a.jsxs(Ee,{children:[a.jsx(_e,{children:a.jsx("div",{className:"truncate text-left text-sm",children:i?.name})}),a.jsx(Te,{children:i?.name})]})]})]})}),a.jsx("div",{className:"flex flex-1 items-center justify-center pt-2",children:a.jsxs(K,{variant:"ghost",className:"h-8 p-2 text-xs",onClick:l,children:[a.jsx(bt,{className:"mr-1 size-3.5 text-red-700"}),a.jsx("div",{className:"text-red-700",children:r("side_panel.refs_section.dependency.delete_dependency")})]})})]})},tu=D.forwardRef(({dependency:e},t)=>a.jsxs(rn,{value:e.id,className:"rounded-md",ref:t,children:[a.jsx(an,{asChild:!0,className:"w-full rounded-md px-2 py-0 hover:bg-accent hover:no-underline data-[state=open]:rounded-b-none",children:a.jsx(p_,{dependency:e})}),a.jsx(on,{className:"p-1 pb-0",children:a.jsx(m_,{dependency:e})})]}));tu.displayName="DependencyListItem";const b_=({refs:e})=>{const{openRefFromSidebar:t,openedRefInSidebar:n}=et(),s=D.useRef(null),{t:r}=ie(),i=e.reduce((p,x)=>(p[x.id]=D.createRef(),p),{}),o=h.useCallback(p=>i[p]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[i]),l=h.useCallback(()=>{n&&s.current!==n&&(s.current=n,o(n))},[o,n]),c=h.useMemo(()=>e.filter(p=>p.type==="relationship").length,[e]),d=D.useMemo(()=>`${c} ${r("side_panel.refs_section.relationships")}`,[c,r]),u=h.useMemo(()=>e.filter(p=>p.type==="dependency").length,[e]),f=D.useMemo(()=>`${u} ${r("side_panel.refs_section.dependencies")}`,[u,r]);return a.jsxs(Dr,{type:"single",collapsible:!0,className:"flex w-full flex-col gap-1",value:n,onValueChange:t,onAnimationEnd:l,children:[c>0?a.jsx(Je,{className:"mt-2 px-2 text-xs font-medium text-muted-foreground",children:d}):null,e.filter(p=>p.type==="relationship").map(p=>a.jsx(eu,{relationship:p.relationship,ref:i[p.id]},p.id)),u>0?a.jsx(Je,{className:"mt-2 px-2 text-xs font-medium text-muted-foreground",children:f}):null,e.filter(p=>p.type==="dependency").map(p=>a.jsx(tu,{dependency:p.dependency,ref:i[p.id]},p.id))]})},x_=()=>{const{relationships:e,dependencies:t,databaseType:n,getTable:s,readonly:r}=se(),{filter:i}=Ir(),[o,l]=D.useState(""),{closeAllRefsInSidebar:c}=et(),{t:d}=ie(),{openCreateRelationshipDialog:u}=Jn(),{showDBViews:f}=di(),p=D.useRef(null),x=h.useMemo(()=>{const g=e.map(y=>({id:y.id,type:"relationship",relationship:y})),T=f?t.map(y=>({id:y.id,type:"dependency",dependency:y})):[];return[...g,...T]},[e,t,f]),b=h.useMemo(()=>{const g=y=>{if(!o?.trim?.())return!0;const v=o.toLowerCase();if(y.type==="relationship")return y.relationship.name.toLowerCase().includes(v);{const S=y.dependency,I=s(S.tableId)?.name??"",k=s(S.dependentTableId)?.name??"";return I.toLowerCase().includes(v)||k.toLowerCase().includes(v)}},T=y=>{if(y.type==="relationship"){const v=y.relationship;return Mh({tableA:{id:v.sourceTableId,schema:v.sourceSchema},tableB:{id:v.targetTableId,schema:v.targetSchema},filter:i,options:{defaultSchema:wn[n]}})}else{const v=y.dependency;return Oh({tableA:{id:v.tableId,schema:v.schema},tableB:{id:v.dependentTableId,schema:v.dependentSchema},filter:i,options:{defaultSchema:wn[n]}})}};return x.filter(T).filter(g).sort((y,v)=>{if(y.type!==v.type)return y.type==="relationship"?-1:1;if(y.type==="relationship"){const S=y.relationship,I=v.relationship;return S.name.localeCompare(I.name)}else{const S=y.dependency,I=v.dependency,k=s(S.dependentTableId),C=s(S.tableId),_=s(I.dependentTableId),j=s(I.tableId);return`${k?.name}${C?.name}`.localeCompare(`${_?.name}${j?.name}`)}})},[x,o,i,n,s]),m=h.useCallback(async()=>{l(""),u()},[u,l]);return a.jsxs("section",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 py-1",children:[a.jsx("div",{children:a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("span",{children:a.jsx(K,{variant:"ghost",className:"size-8 p-0",onClick:c,children:a.jsx(ap,{className:"size-4"})})})}),a.jsx(Te,{children:d("side_panel.refs_section.collapse")})]})}),a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{ref:p,type:"text",placeholder:d("side_panel.refs_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:g=>l(g.target.value)})}),r?null:a.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:m,children:[a.jsx(Ol,{className:"h-4"}),d("side_panel.refs_section.add_relationship")]})]}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(Gs,{className:"h-full",children:x.length===0?a.jsx(bs,{title:d("side_panel.refs_section.empty_state.title"),description:d("side_panel.refs_section.empty_state.description"),className:"mt-20",secondaryAction:r?void 0:{label:d("side_panel.refs_section.add_relationship"),onClick:m}}):a.jsx(b_,{refs:b})})})]})},nu=D.forwardRef(({area:e},t)=>{const{updateArea:n,removeArea:s,readonly:r}=se(),{t:i}=ie(),{focusOnArea:o}=Rr(),[l,c]=D.useState(!1),[d,u]=D.useState(e.name),f=D.useRef(null),{attributes:p,listeners:x,setNodeRef:b,transform:m,transition:g}=vn({id:e.id}),T=gl(t,b),y={transform:Ot.Translate.toString(m),transition:g},v=h.useCallback(()=>{l&&(d.trim()&&n(e.id,{name:d.trim()}),c(!1))},[d,e.id,n,l]),S=h.useCallback(()=>{c(!1),u(e.name)},[e.name]),I=h.useCallback(R=>{R.stopPropagation(),c(!0)},[]),k=h.useCallback(()=>{s(e.id)},[e.id,s]),C=h.useCallback(R=>{n(e.id,{color:R})},[e.id,n]),_=h.useCallback(R=>{R.stopPropagation(),o(e.id)},[o,e.id]);zs(f,v),cn("Enter",v),cn("Escape",S);const j=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-fit min-w-40",children:[a.jsx(Zn,{children:i("side_panel.areas_section.area.area_actions.title")}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{className:"flex justify-between gap-4",onClick:R=>{R.stopPropagation(),I(R)},children:[i("side_panel.areas_section.area.area_actions.edit_name"),a.jsx(ns,{className:"size-3.5"})]})}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:k,className:"flex justify-between !text-red-700",children:[i("side_panel.areas_section.area.area_actions.delete_area"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})})]})]}),[I,k,i]);return a.jsx("div",{className:"w-full rounded-md border border-border hover:bg-accent/5",ref:T,style:{...y,borderLeftWidth:"6px",borderLeftColor:e.color},...p,children:a.jsxs("div",{className:"group flex h-11 items-center justify-between gap-1 overflow-hidden p-2",children:[r?null:a.jsx("div",{className:"flex cursor-move items-center justify-center",...x,children:a.jsx(ts,{className:"size-4 text-muted-foreground"})}),a.jsx("div",{className:"flex min-w-0 flex-1",children:l?a.jsx(Ie,{ref:f,autoFocus:!0,type:"text",placeholder:e.name,value:d,onClick:R=>R.stopPropagation(),onChange:R=>u(R.target.value),className:"h-7 w-full focus-visible:ring-0"}):r?a.jsx("div",{className:"truncate px-2 py-0.5 text-sm font-medium",children:e.name}):a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("div",{onDoubleClick:I,className:"text-editable truncate px-2 py-0.5 text-sm font-medium",children:e.name})}),a.jsx(Te,{children:i("tool_tips.double_click_to_edit")})]})}),a.jsx("div",{className:"flex items-center gap-1",children:l?a.jsx(Ae,{onClick:v,children:a.jsx(Dn,{})}):a.jsxs("div",{className:"flex flex-row-reverse items-center gap-1",children:[r?null:j(),a.jsx(li,{color:e.color,onChange:C,disabled:r}),a.jsx("div",{className:"hidden md:group-hover:flex",children:a.jsx(Ae,{onClick:_,children:a.jsx(Ks,{})})})]})})]})})});nu.displayName="AreaListItem";const g_=({areas:e})=>{const{updateArea:t}=se(),{openedAreaInSidebar:n}=et(),s=D.useRef(null),r=h.useMemo(()=>e.reduce((d,u)=>(d[u.id]=D.createRef(),d),{}),[e]),i=h.useCallback(d=>r[d]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[r]),o=ds(cs(xn)),l=d=>{const{active:u,over:f}=d;if(u?.id!==f?.id&&f&&u){const p=e.findIndex(m=>m.id===u.id),x=e.findIndex(m=>m.id===f.id);gn(e,p,x).forEach((m,g)=>{t(m.id,{order:g})})}},c=h.useCallback(()=>{n&&s.current!==n&&(s.current=n,i(n))},[i,n]);return D.useEffect(()=>{c()},[n,c]),a.jsx("div",{className:"flex w-full flex-col gap-1",children:a.jsx(fs,{sensors:o,collisionDetection:us,onDragEnd:l,children:a.jsx(ms,{items:e,strategy:ps,children:e.sort((d,u)=>d.order&&u.order===void 0?-1:d.order===void 0&&u.order?1:d.order!==void 0&&u.order!==void 0?d.order-u.order:d.name.localeCompare(u.name)).map(d=>a.jsx(nu,{area:d,ref:r[d.id]},d.id))})})})},v_=()=>{const{createArea:e,areas:t,readonly:n}=se(),s=ii(),{t:r}=ie(),{openAreaFromSidebar:i}=et(),[o,l]=D.useState(""),c=D.useRef(null),d=h.useMemo(()=>{const x=b=>!o?.trim?.()||b.name.toLowerCase().includes(o.toLowerCase());return t.filter(x)},[t,o]),u=h.useCallback(async()=>{const b=-s.x/s.zoom+80/s.zoom,m=-s.y/s.zoom+80/s.zoom,g=await e({x:b,y:m});i&&i(g.id)},[e,i,s.x,s.y,s.zoom]),f=h.useCallback(async()=>{l(""),u()},[u,l]),p=h.useCallback(()=>{l("")},[]);return a.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 pb-1",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{ref:c,type:"text",placeholder:r("side_panel.areas_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:x=>l(x.target.value)})}),n?null:a.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:f,children:[a.jsx(jr,{className:"h-4"}),r("side_panel.areas_section.add_area")]})]}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(Gs,{className:"h-full",children:t.length===0?a.jsx(bs,{title:r("side_panel.areas_section.empty_state.title"),description:r("side_panel.areas_section.empty_state.description"),className:"mt-20",secondaryAction:n?void 0:{label:r("side_panel.areas_section.add_area"),onClick:f}}):o&&d.length===0?a.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:r("side_panel.areas_section.no_results")}),a.jsxs(K,{variant:"outline",size:"sm",onClick:p,className:"gap-1",children:[a.jsx(Rn,{className:"size-3.5"}),r("side_panel.areas_section.clear")]})]}):a.jsx(g_,{areas:d})})})]})},su=D.forwardRef(({note:e},t)=>{const{updateNote:n,removeNote:s,readonly:r}=se(),{t:i}=ie(),{focusOnNote:o}=Rr(),{attributes:l,listeners:c,setNodeRef:d,transform:u,transition:f}=vn({id:e.id}),p=gl(t,d),x={transform:Ot.Translate.toString(u),transition:f},b=h.useCallback(()=>{s(e.id)},[e.id,s]),m=h.useCallback(y=>{n(e.id,{color:y})},[e.id,n]),g=h.useCallback(y=>{y.stopPropagation(),o(e.id)},[o,e.id]),T=h.useCallback(()=>a.jsxs(hn,{children:[a.jsx(fn,{children:a.jsx(Ae,{children:a.jsx(ss,{})})}),a.jsxs(pn,{className:"w-fit min-w-40",children:[a.jsx(Zn,{children:i("side_panel.notes_section.note.note_actions.title")}),a.jsx(At,{}),a.jsx(Dt,{children:a.jsxs(it,{onClick:b,className:"flex justify-between !text-red-700",children:[i("side_panel.notes_section.note.note_actions.delete_note"),a.jsx(bt,{className:"size-3.5 text-red-700"})]})})]})]}),[b,i]);return a.jsx("div",{className:"w-full rounded-md border border-border hover:bg-accent/5",ref:p,style:{...x,borderLeftWidth:"6px",borderLeftColor:e.color},...l,children:a.jsxs("div",{className:"group flex min-h-11 items-center justify-between gap-1 overflow-hidden p-2",children:[r?null:a.jsx("div",{className:"flex cursor-move items-center justify-center",...c,children:a.jsx(ts,{className:"size-4 text-muted-foreground"})}),a.jsx("div",{className:"flex min-w-0 flex-1",children:a.jsx("div",{className:"truncate px-2 py-0.5 text-sm",children:e.content||a.jsx("span",{className:"italic text-muted-foreground",children:i("side_panel.notes_section.note.empty_note")})})}),a.jsx("div",{className:"flex items-center gap-1",children:a.jsxs("div",{className:"flex flex-row-reverse items-center gap-1",children:[r?null:T(),a.jsx(li,{color:e.color,onChange:m,disabled:r}),a.jsx("div",{className:"hidden md:group-hover:flex",children:a.jsx(Ae,{onClick:g,children:a.jsx(Ks,{})})})]})})]})})});su.displayName="NoteListItem";const N_=({notes:e})=>{const{updateNote:t}=se(),{openedNoteInSidebar:n}=et(),s=D.useRef(null),r=h.useMemo(()=>e.reduce((d,u)=>(d[u.id]=D.createRef(),d),{}),[e]),i=h.useCallback(d=>r[d]?.current?.scrollIntoView({behavior:"smooth",block:"start"}),[r]),o=ds(cs(xn)),l=d=>{const{active:u,over:f}=d;if(u?.id!==f?.id&&f&&u){const p=e.findIndex(m=>m.id===u.id),x=e.findIndex(m=>m.id===f.id);gn(e,p,x).forEach((m,g)=>{t(m.id,{order:g})})}},c=h.useCallback(()=>{n&&s.current!==n&&(s.current=n,i(n))},[i,n]);return D.useEffect(()=>{c()},[n,c]),a.jsx("div",{className:"flex w-full flex-col gap-1",children:a.jsx(fs,{sensors:o,collisionDetection:us,onDragEnd:l,children:a.jsx(ms,{items:e,strategy:ps,children:e.sort((d,u)=>d.order&&u.order===void 0?-1:d.order===void 0&&u.order?1:d.order!==void 0&&u.order!==void 0?d.order-u.order:d.content.localeCompare(u.content)).map(d=>a.jsx(su,{note:d,ref:r[d.id]},d.id))})})})},y_=()=>{const{createNote:e,notes:t,readonly:n}=se(),s=ii(),{t:r}=ie(),{openNoteFromSidebar:i}=et(),[o,l]=D.useState(""),c=D.useRef(null),d=h.useMemo(()=>{const x=b=>!o?.trim?.()||b.content.toLowerCase().includes(o.toLowerCase());return t.filter(x)},[t,o]),u=h.useCallback(async()=>{const b=-s.x/s.zoom+80/s.zoom,m=-s.y/s.zoom+80/s.zoom,g=await e({x:b,y:m});i&&i(g.id)},[e,i,s.x,s.y,s.zoom]),f=h.useCallback(async()=>{l(""),u()},[u,l]),p=h.useCallback(()=>{l("")},[]);return a.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden px-2",children:[a.jsxs("div",{className:"flex items-center justify-between gap-4 pb-1",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Ie,{ref:c,type:"text",placeholder:r("side_panel.notes_section.filter"),className:"h-8 w-full focus-visible:ring-0",value:o,onChange:x=>l(x.target.value)})}),n?null:a.jsxs(K,{variant:"secondary",className:"h-8 p-2 text-xs",onClick:f,children:[a.jsx(Pl,{className:"h-4"}),r("side_panel.notes_section.add_note")]})]}),a.jsx("div",{className:"flex flex-1 flex-col overflow-hidden",children:a.jsx(Gs,{className:"h-full",children:t.length===0?a.jsx(bs,{title:r("side_panel.notes_section.empty_state.title"),description:r("side_panel.notes_section.empty_state.description"),className:"mt-20",secondaryAction:n?void 0:{label:r("side_panel.notes_section.add_note"),onClick:f}}):o&&d.length===0?a.jsxs("div",{className:"mt-10 flex flex-col items-center gap-2",children:[a.jsx("div",{className:"text-sm text-muted-foreground",children:r("side_panel.notes_section.no_results")}),a.jsxs(K,{variant:"outline",size:"sm",onClick:p,className:"gap-1",children:[a.jsx(Rn,{className:"size-3.5"}),r("side_panel.notes_section.clear")]})]}):a.jsx(N_,{notes:d})})})]})},E_=()=>{const{t:e}=ie(),{selectedVisualsTab:t,selectVisualsTab:n}=et();return a.jsx("section",{className:"flex flex-1 flex-col overflow-hidden","data-vaul-no-drag":!0,children:a.jsxs(wf,{value:t,onValueChange:s=>n(s),className:"flex flex-1 flex-col overflow-hidden",children:[a.jsxs("div",{className:"px-2 pt-2",children:[a.jsxs(Cf,{className:"grid h-auto w-full grid-cols-2 gap-1 rounded-xl border bg-background p-1",children:[a.jsxs(qi,{value:"areas",className:"gap-1.5 rounded-lg px-3 py-1 text-sm font-medium transition-all data-[state=active]:bg-sky-600 data-[state=active]:text-white data-[state=inactive]:text-muted-foreground data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-muted/50 data-[state=inactive]:hover:text-foreground dark:data-[state=active]:bg-sky-500",children:[a.jsx(jr,{className:"size-3.5"}),e("side_panel.visuals_section.tabs.areas")]}),a.jsxs(qi,{value:"notes",className:"gap-1.5 rounded-lg px-3 py-1 text-sm font-medium transition-all data-[state=active]:bg-sky-600 data-[state=active]:text-white data-[state=inactive]:text-muted-foreground data-[state=active]:shadow-sm data-[state=inactive]:hover:bg-muted/50 data-[state=inactive]:hover:text-foreground dark:data-[state=active]:bg-sky-500",children:[a.jsx(Pl,{className:"size-3.5"}),e("side_panel.visuals_section.tabs.notes")]})]}),a.jsx(Rt,{orientation:"horizontal",className:"my-2"})]}),a.jsx(Yi,{value:"areas",className:"mt-0 flex flex-1 flex-col overflow-hidden data-[state=inactive]:hidden",children:a.jsx(v_,{})}),a.jsx(Yi,{value:"notes",className:"mt-0 flex flex-1 flex-col overflow-hidden data-[state=inactive]:hidden",children:a.jsx(y_,{})})]})})},ST=()=>{const{t:e}=ie(),{databaseType:t}=se(),{selectSidebarSection:n,selectedSidebarSection:s}=et(),{isMd:r}=oi("md");return a.jsxs("aside",{className:"flex h-full flex-col overflow-hidden",children:[r?null:a.jsx("div",{className:"flex justify-center border-b pt-0.5",children:a.jsxs(Xs,{value:s,onValueChange:i=>n(i),children:[a.jsxs(as,{className:"rounded-none border-none font-semibold shadow-none hover:bg-secondary hover:underline focus:border-transparent focus:ring-0",children:[a.jsx(Ws,{}),a.jsx("div",{className:"flex flex-1 justify-end px-2 text-xs font-normal text-muted-foreground",children:e("side_panel.view_all_options")})]}),a.jsx(is,{children:a.jsxs(Ms,{children:[a.jsx(Ke,{value:"tables",children:e("side_panel.tables_section.tables")}),a.jsx(Ke,{value:"refs",children:e("side_panel.refs_section.refs")}),a.jsx(Ke,{value:"areas",children:e("side_panel.areas_section.areas")}),a.jsx(Ke,{value:"visuals",children:e("side_panel.visuals_section.visuals")}),vl(t)?a.jsx(Ke,{value:"customTypes",children:e("side_panel.custom_types_section.custom_types")}):null]})})]})}),s==="tables"?a.jsx(lx,{}):s==="dbml"?a.jsx(u_,{}):s==="refs"?a.jsx(x_,{}):s==="visuals"?a.jsx(E_,{}):a.jsx(mx,{})]})},ja=768;function __(){const[e,t]=h.useState(void 0);return h.useEffect(()=>{const n=window.matchMedia(`(max-width: ${ja-1}px)`),s=()=>{t(window.innerWidth<ja)};return n.addEventListener("change",s),t(window.innerWidth<ja),()=>n.removeEventListener("change",s)},[]),!!e}const T_=Ph,w_=Fh,ru=h.forwardRef(({className:e,...t},n)=>a.jsx(jl,{className:M("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));ru.displayName=jl.displayName;const C_=ci("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),au=h.forwardRef(({side:e="right",className:t,children:n,...s},r)=>a.jsxs(w_,{children:[a.jsx(ru,{}),a.jsxs(wl,{ref:r,className:M(C_({side:e}),t),...s,children:[a.jsxs(Uh,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[a.jsx(Bh,{className:"size-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]}),n]})]}));au.displayName=wl.displayName;const iu=({className:e,...t})=>a.jsx("div",{className:M("flex flex-col space-y-2 text-center sm:text-left",e),...t});iu.displayName="SheetHeader";const ou=h.forwardRef(({className:e,...t},n)=>a.jsx(Cl,{ref:n,className:M("text-lg font-semibold text-foreground",e),...t}));ou.displayName=Cl.displayName;const lu=h.forwardRef(({className:e,...t},n)=>a.jsx(Il,{ref:n,className:M("text-sm text-muted-foreground",e),...t}));lu.displayName=Il.displayName;const sa=()=>{const e=D.useContext(cu);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e},I_="sidebar_state",j_=3600*24*7,S_="16rem",k_="18rem",L_="3rem",A_="4rem",D_="b",cu=h.createContext(null),R_=h.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:n,className:s,style:r,children:i,...o},l)=>{const c=__(),[d,u]=h.useState(!1),[f,p]=h.useState(e),x=t??f,b=h.useCallback(y=>{const v=typeof y=="function"?y(x):y;n?n(v):p(v),document.cookie=`${I_}=${v}; path=/; max-age=${j_}`},[n,x]),m=h.useCallback(()=>c?u(y=>!y):b(y=>!y),[c,b,u]);h.useEffect(()=>{const y=v=>{v.key===D_&&(v.metaKey||v.ctrlKey)&&(v.preventDefault(),m())};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[m]);const g=x?"expanded":"collapsed",T=h.useMemo(()=>({state:g,open:x,setOpen:b,isMobile:c,openMobile:d,setOpenMobile:u,toggleSidebar:m}),[g,x,b,c,d,u,m]);return a.jsx(cu.Provider,{value:T,children:a.jsx(gh,{delayDuration:0,children:a.jsx("div",{style:{"--sidebar-width":S_,"--sidebar-width-icon":L_,"--sidebar-width-icon-extended":A_,...r},className:M("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",s),ref:l,...o,children:i})})})});R_.displayName="SidebarProvider";const du=h.forwardRef(({side:e="left",variant:t="sidebar",collapsible:n="offcanvas",className:s,children:r,...i},o)=>{const{isMobile:l,state:c,openMobile:d,setOpenMobile:u}=sa();return n==="none"?a.jsx("div",{className:M("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",s),ref:o,...i,children:r}):l?a.jsx(T_,{open:d,onOpenChange:u,...i,children:a.jsxs(au,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":k_},side:e,children:[a.jsxs(iu,{className:"sr-only",children:[a.jsx(ou,{children:"Sidebar"}),a.jsx(lu,{children:"Displays the mobile sidebar."})]}),a.jsx("div",{className:"flex size-full flex-col",children:r})]})}):a.jsxs("div",{ref:o,className:"group peer hidden text-sidebar-foreground md:block","data-state":c,"data-collapsible":c==="collapsed"?n:"","data-variant":t,"data-side":e,children:[a.jsx("div",{className:M("relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))] group-data-[collapsible=icon-extended]:w-[calc(var(--sidebar-width-icon-extended)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[collapsible=icon-extended]:w-[--sidebar-width-icon-extended]")}),a.jsx("div",{className:M("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)] group-data-[collapsible=icon-extended]:w-[calc(var(--sidebar-width-icon-extended)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[collapsible=icon-extended]:w-[--sidebar-width-icon-extended] group-data-[side=left]:border-r group-data-[side=right]:border-l",s),...i,children:a.jsx("div",{"data-sidebar":"sidebar",className:"flex size-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:r})})]})});du.displayName="Sidebar";const M_=h.forwardRef(({className:e,onClick:t,...n},s)=>{const{toggleSidebar:r}=sa();return a.jsxs(K,{ref:s,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:M("h-7 w-7",e),onClick:i=>{t?.(i),r()},...n,children:[a.jsx($h,{}),a.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});M_.displayName="SidebarTrigger";const O_=h.forwardRef(({className:e,...t},n)=>{const{toggleSidebar:s}=sa();return a.jsx("button",{ref:n,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:s,title:"Toggle Sidebar",className:M("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});O_.displayName="SidebarRail";const P_=h.forwardRef(({className:e,...t},n)=>a.jsx("main",{ref:n,className:M("relative flex w-full flex-1 flex-col bg-background","md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));P_.displayName="SidebarInset";const F_=h.forwardRef(({className:e,...t},n)=>a.jsx(Ie,{ref:n,"data-sidebar":"input",className:M("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));F_.displayName="SidebarInput";const uu=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"header",className:M("flex flex-col gap-2 p-2",e),...t}));uu.displayName="SidebarHeader";const hu=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"footer",className:M("flex flex-col gap-2 p-2",e),...t}));hu.displayName="SidebarFooter";const U_=h.forwardRef(({className:e,...t},n)=>a.jsx(Rt,{ref:n,"data-sidebar":"separator",className:M("mx-2 w-auto bg-sidebar-border",e),...t}));U_.displayName="SidebarSeparator";const fu=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"content",className:M("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden group-data-[collapsible=icon-extended]:overflow-hidden",e),...t}));fu.displayName="SidebarContent";const pu=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"group",className:M("relative flex w-full min-w-0 flex-col p-2",e),...t}));pu.displayName="SidebarGroup";const B_=h.forwardRef(({className:e,asChild:t=!1,...n},s)=>{const r=t?es:"div";return a.jsx(r,{ref:s,"data-sidebar":"group-label",className:M("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0","group-data-[collapsible=icon-extended]:-mt-8 group-data-[collapsible=icon-extended]:opacity-0",e),...n})});B_.displayName="SidebarGroupLabel";const $_=h.forwardRef(({className:e,asChild:t=!1,...n},s)=>{const r=t?es:"button";return a.jsx(r,{ref:s,"data-sidebar":"group-action",className:M("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",e),...n})});$_.displayName="SidebarGroupAction";const mu=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"group-content",className:M("w-full text-sm",e),...t}));mu.displayName="SidebarGroupContent";const dr=h.forwardRef(({className:e,...t},n)=>a.jsx("ul",{ref:n,"data-sidebar":"menu",className:M("flex w-full min-w-0 flex-col gap-1",e),...t}));dr.displayName="SidebarMenu";const ur=h.forwardRef(({className:e,...t},n)=>a.jsx("li",{ref:n,"data-sidebar":"menu-item",className:M("group/menu-item relative",e),...t}));ur.displayName="SidebarMenuItem";const V_=ci("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon-extended]:h-auto group-data-[collapsible=icon-extended]:flex-col group-data-[collapsible=icon-extended]:gap-1 group-data-[collapsible=icon-extended]:p-2 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate group-data-[collapsible=icon-extended]:[&>span]:w-full group-data-[collapsible=icon-extended]:[&>span]:text-center group-data-[collapsible=icon-extended]:[&>span]:text-[10px] group-data-[collapsible=icon-extended]:[&>span]:leading-tight [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),hr=h.forwardRef(({asChild:e=!1,isActive:t=!1,variant:n="default",size:s="default",tooltip:r,className:i,...o},l)=>{const c=e?es:"button",{isMobile:d,state:u}=sa(),f=a.jsx(c,{ref:l,"data-sidebar":"menu-button","data-size":s,"data-active":t,className:M(V_({variant:n,size:s}),i),...o});return r?(typeof r=="string"&&(r={children:r}),a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:f}),a.jsx(Te,{side:"right",align:"center",hidden:u!=="collapsed"||d,...r})]})):f});hr.displayName="SidebarMenuButton";const G_=h.forwardRef(({className:e,asChild:t=!1,showOnHover:n=!1,...s},r)=>{const i=t?es:"button";return a.jsx(i,{ref:r,"data-sidebar":"menu-action",className:M("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",n&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...s})});G_.displayName="SidebarMenuAction";const z_=h.forwardRef(({className:e,...t},n)=>a.jsx("div",{ref:n,"data-sidebar":"menu-badge",className:M("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));z_.displayName="SidebarMenuBadge";const K_=h.forwardRef(({className:e,showIcon:t=!1,...n},s)=>{const r=h.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return a.jsxs("div",{ref:s,"data-sidebar":"menu-skeleton",className:M("flex h-8 items-center gap-2 rounded-md px-2",e),...n,children:[t&&a.jsx(Qi,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),a.jsx(Qi,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":r}})]})});K_.displayName="SidebarMenuSkeleton";const X_=h.forwardRef(({className:e,...t},n)=>a.jsx("ul",{ref:n,"data-sidebar":"menu-sub",className:M("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));X_.displayName="SidebarMenuSub";const W_=h.forwardRef(({...e},t)=>a.jsx("li",{ref:t,...e}));W_.displayName="SidebarMenuSubItem";const H_=h.forwardRef(({asChild:e=!1,size:t="md",isActive:n,className:s,...r},i)=>{const o=e?es:"a";return a.jsx(o,{ref:i,"data-sidebar":"menu-sub-button","data-size":t,"data-active":n,className:M("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden group-data-[collapsible=icon-extended]:hidden",s),...r})});H_.displayName="SidebarMenuSubButton";const kT=()=>{const{selectSidebarSection:e,selectedSidebarSection:t,showSidePanel:n,selectVisualsTab:s}=et(),{t:r}=ie(),{isMd:i}=oi("md"),{effectiveTheme:o}=Or(),{databaseType:l}=se(),{openCreateDiagramDialog:c,openOpenDiagramDialog:d}=Jn(),u=h.useMemo(()=>[{title:r("editor_sidebar.new_diagram"),icon:Lt,onClick:()=>{c()},active:!1},{title:r("editor_sidebar.browse"),icon:Zf,onClick:()=>{d()},active:!1}],[r,c,d]),f=h.useMemo(()=>[{title:r("editor_sidebar.tables"),icon:Tl,onClick:()=>{n(),e("tables")},active:t==="tables"},{title:"DBML",icon:Wf,onClick:()=>{n(),e("dbml")},active:t==="dbml"},{title:r("editor_sidebar.refs"),icon:Ol,onClick:()=>{n(),e("refs")},active:t==="refs"},...vl(l)?[{title:r("editor_sidebar.custom_types"),icon:Qf,onClick:()=>{n(),e("customTypes")},active:t==="customTypes"}]:[],{title:r("editor_sidebar.visuals"),icon:jr,onClick:()=>{n(),e("visuals"),s("areas")},active:t==="visuals"}],[e,t,r,n,l,s]),p=h.useMemo(()=>[{title:"Discord",icon:Vh,onClick:()=>window.open("https://discord.gg/QeFwyWSKwC","_blank"),active:!1},{title:"Twitter",icon:Gh,onClick:()=>window.open("https://x.com/intent/follow?screen_name=jonathanfishner","_blank"),active:!1},{title:"Docs",icon:Uf,onClick:()=>window.open("https://docs.chartdb.io","_blank"),active:!1}],[]);return a.jsxs(du,{side:"left",collapsible:"icon-extended",variant:"sidebar",className:"relative h-full",children:[i?null:a.jsx(uu,{children:a.jsx("a",{href:"https://chartdb.io",className:"cursor-pointer",rel:"noreferrer",children:a.jsx("img",{src:o==="light"?Rf:Mf,alt:"chartDB",className:"h-4 max-w-fit"})})}),a.jsx(fu,{children:a.jsx(pu,{children:a.jsxs(mu,{children:[a.jsx(dr,{children:u.map(x=>a.jsx(ur,{children:a.jsx(hr,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:x.active,asChild:!0,children:a.jsxs("button",{onClick:x.onClick,children:[a.jsx(x.icon,{}),a.jsx("span",{children:x.title.split(" ").map((b,m)=>a.jsx("div",{children:b},m))})]})})},x.title))}),a.jsx(Rt,{className:"my-2"}),a.jsx(dr,{children:f.map(x=>a.jsx(ur,{children:a.jsx(hr,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:x.active,asChild:!0,children:a.jsxs("button",{onClick:x.onClick,children:[a.jsx(x.icon,{}),a.jsx("span",{children:x.title.split(" ").map((b,m)=>a.jsx("div",{children:b},m))})]})})},x.title))})]})})}),a.jsx(hu,{children:a.jsx(dr,{children:p.map(x=>a.jsxs(ur,{children:[x.badge&&a.jsx("span",{className:"absolute -right-1 -top-1 rounded-full bg-pink-500 px-[3px] py-px text-[8px] font-semibold text-white",children:x.badge}),a.jsx(hr,{className:"justify-center space-y-0.5 !px-0 hover:bg-gray-200 data-[active=true]:bg-gray-100 data-[active=true]:text-pink-600 data-[active=true]:hover:bg-pink-100 dark:hover:bg-gray-800 dark:data-[active=true]:bg-gray-900 dark:data-[active=true]:text-pink-400 dark:data-[active=true]:hover:bg-pink-950",isActive:x.active,asChild:!0,children:a.jsxs("button",{onClick:x.onClick,children:[a.jsx(x.icon,{}),a.jsx("span",{children:x.title})]})})]},x.title))})})]})},LT=()=>{const{diagramName:e,updateDiagramName:t,currentDiagram:n}=se(),{t:s}=ie(),[r,i]=h.useState(!1),[o,l]=D.useState(e),c=D.useRef(null),{openOpenDiagramDialog:d}=Jn();h.useEffect(()=>{l(e)},[e]);const u=h.useCallback(()=>{o.trim()&&t(o.trim()),i(!1)},[o,t]);zs(c,u),cn("Enter",u),h.useEffect(()=>{if(r){const p=setTimeout(()=>{c.current&&(c.current.focus(),c.current.select())},50);return()=>clearTimeout(p)}},[r]);const f=h.useCallback(p=>{p.stopPropagation(),l(e),i(!0)},[e]);return a.jsx("div",{className:"group",children:a.jsxs("div",{className:M("flex flex-1 flex-row items-center justify-center px-2 py-1 whitespace-nowrap",{"text-editable":!r}),children:[a.jsx(If,{databaseType:n.databaseType,databaseEdition:n.databaseEdition,onClick:p=>{p.stopPropagation(),d({canClose:!0})}}),a.jsx("div",{className:"flex flex-row items-center gap-1",children:r?a.jsxs(a.Fragment,{children:[a.jsx(Ie,{ref:c,autoFocus:!0,type:"text",placeholder:e,value:o,onClick:p=>p.stopPropagation(),onChange:p=>l(p.target.value),className:"h-7 max-w-[300px] focus-visible:ring-0",style:{width:`${o.length*8+30}px`}}),a.jsx(K,{variant:"ghost",className:"ml-1 flex size-7 p-2 text-slate-500 hover:bg-primary-foreground hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300",onClick:u,children:a.jsx(Dn,{})})]}):a.jsxs(a.Fragment,{children:[a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx("h1",{className:M(Sf(),"group-hover:underline max-w-[300px] truncate"),onDoubleClick:p=>{f(p)},children:e})}),a.jsx(Te,{children:s("tool_tips.double_click_to_edit")})]}),a.jsx(K,{variant:"ghost",className:"ml-1 hidden size-5 p-0 hover:bg-background/50 group-hover:flex",onClick:f,children:a.jsx(ns,{strokeWidth:"1.5",className:"!size-3.5 text-slate-600 dark:text-slate-400"})})]})})]})})},AT=()=>{const{t:e,i18n:t}=ie(),[n,s]=h.useState(!1),r=vh.map(l=>({label:l.nativeName,value:l.code,description:`(${l.name})`})),i=h.useCallback(l=>{t.changeLanguage(l),s(!1)},[t]),o=h.useMemo(()=>t.languages.map(l=>r.find(c=>c.value===l)).find(l=>l!==void 0)?.value,[t,r]);return a.jsxs(hn,{open:n,onOpenChange:s,children:[a.jsxs(Ee,{children:[a.jsx(_e,{asChild:!0,children:a.jsx(fn,{asChild:!0,children:a.jsxs("div",{className:M(La({variant:"outline",size:"icon"}),"size-6 rounded-full md:size-8 cursor-pointer"),children:[a.jsx(tp,{className:"size-3.5 md:size-4"}),a.jsx("span",{className:"sr-only",children:"Change language"})]})})}),a.jsx(Te,{children:e("language_select.change_language")})]}),a.jsx(pn,{className:"w-56",children:a.jsx("div",{className:"p-2",children:a.jsx(ai,{className:"flex h-8 min-h-8 w-full",options:r,value:o,onChange:i})})})]})};var Js="Menubar",[ti,q_,Y_]=yl(Js),[bu]=xl(Js,[Y_,Sl]),ze=zh(),xu=Sl(),[Q_,Pi]=bu(Js),gu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,value:s,onValueChange:r,defaultValue:i,loop:o=!0,dir:l,...c}=e,d=Nl(l),u=xu(n),[f,p]=fr({prop:s,onChange:r,defaultProp:i??"",caller:Js}),[x,b]=h.useState(null);return a.jsx(Q_,{scope:n,value:f,onMenuOpen:h.useCallback(m=>{p(m),b(m)},[p]),onMenuClose:h.useCallback(()=>p(""),[p]),onMenuToggle:h.useCallback(m=>{p(g=>g?"":m),b(m)},[p]),dir:d,loop:o,children:a.jsx(ti.Provider,{scope:n,children:a.jsx(ti.Slot,{scope:n,children:a.jsx(Wh,{asChild:!0,...u,orientation:"horizontal",loop:o,dir:d,currentTabStopId:x,onCurrentTabStopIdChange:b,children:a.jsx(He.div,{role:"menubar",...c,ref:t})})})})})});gu.displayName=Js;var Fi="MenubarMenu",[J_,vu]=bu(Fi),Nu=e=>{const{__scopeMenubar:t,value:n,...s}=e,r=Hn(),i=n||r||"LEGACY_REACT_AUTO_VALUE",o=Pi(Fi,t),l=ze(t),c=h.useRef(null),d=h.useRef(!1),u=o.value===i;return h.useEffect(()=>{u||(d.current=!1)},[u]),a.jsx(J_,{scope:t,value:i,triggerId:Hn(),triggerRef:c,contentId:Hn(),wasKeyboardTriggerOpenRef:d,children:a.jsx(Kh,{...l,open:u,onOpenChange:f=>{f||o.onMenuClose()},modal:!1,dir:o.dir,...s})})};Nu.displayName=Fi;var ni="MenubarTrigger",yu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,disabled:s=!1,...r}=e,i=xu(n),o=ze(n),l=Pi(ni,n),c=vu(ni,n),d=h.useRef(null),u=It(t,d,c.triggerRef),[f,p]=h.useState(!1),x=l.value===c.value;return a.jsx(ti.ItemSlot,{scope:n,value:c.value,disabled:s,children:a.jsx(Hh,{asChild:!0,...i,focusable:!s,tabStopId:c.value,children:a.jsx(qh,{asChild:!0,...o,children:a.jsx(He.button,{type:"button",role:"menuitem",id:c.triggerId,"aria-haspopup":"menu","aria-expanded":x,"aria-controls":x?c.contentId:void 0,"data-highlighted":f?"":void 0,"data-state":x?"open":"closed","data-disabled":s?"":void 0,disabled:s,...r,ref:u,onPointerDown:de(e.onPointerDown,b=>{!s&&b.button===0&&b.ctrlKey===!1&&(l.onMenuOpen(c.value),x||b.preventDefault())}),onPointerEnter:de(e.onPointerEnter,()=>{l.value&&!x&&(l.onMenuOpen(c.value),d.current?.focus())}),onKeyDown:de(e.onKeyDown,b=>{s||(["Enter"," "].includes(b.key)&&l.onMenuToggle(c.value),b.key==="ArrowDown"&&l.onMenuOpen(c.value),["Enter"," ","ArrowDown"].includes(b.key)&&(c.wasKeyboardTriggerOpenRef.current=!0,b.preventDefault()))}),onFocus:de(e.onFocus,()=>p(!0)),onBlur:de(e.onBlur,()=>p(!1))})})})})});yu.displayName=ni;var Z_="MenubarPortal",Eu=e=>{const{__scopeMenubar:t,...n}=e,s=ze(t);return a.jsx(Yh,{...s,...n})};Eu.displayName=Z_;var si="MenubarContent",_u=h.forwardRef((e,t)=>{const{__scopeMenubar:n,align:s="start",...r}=e,i=ze(n),o=Pi(si,n),l=vu(si,n),c=q_(n),d=h.useRef(!1);return a.jsx(Qh,{id:l.contentId,"aria-labelledby":l.triggerId,"data-radix-menubar-content":"",...i,...r,ref:t,align:s,onCloseAutoFocus:de(e.onCloseAutoFocus,u=>{!o.value&&!d.current&&l.triggerRef.current?.focus(),d.current=!1,u.preventDefault()}),onFocusOutside:de(e.onFocusOutside,u=>{const f=u.target;c().some(x=>x.ref.current?.contains(f))&&u.preventDefault()}),onInteractOutside:de(e.onInteractOutside,()=>{d.current=!0}),onEntryFocus:u=>{l.wasKeyboardTriggerOpenRef.current||u.preventDefault()},onKeyDown:de(e.onKeyDown,u=>{if(["ArrowRight","ArrowLeft"].includes(u.key)){const f=u.target,p=f.hasAttribute("data-radix-menubar-subtrigger"),x=f.closest("[data-radix-menubar-content]")!==u.currentTarget,m=(o.dir==="rtl"?"ArrowRight":"ArrowLeft")===u.key;if(!m&&p||x&&m)return;let y=c().filter(I=>!I.disabled).map(I=>I.value);m&&y.reverse();const v=y.indexOf(l.value);y=o.loop?pT(y,v+1):y.slice(v+1);const[S]=y;S&&o.onMenuOpen(S)}},{checkForDefaultPrevented:!1}),style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});_u.displayName=si;var eT="MenubarGroup",tT=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(rf,{...r,...s,ref:t})});tT.displayName=eT;var nT="MenubarLabel",Tu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(af,{...r,...s,ref:t})});Tu.displayName=nT;var sT="MenubarItem",wu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(Jh,{...r,...s,ref:t})});wu.displayName=sT;var rT="MenubarCheckboxItem",Cu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(nf,{...r,...s,ref:t})});Cu.displayName=rT;var aT="MenubarRadioGroup",iT=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(of,{...r,...s,ref:t})});iT.displayName=aT;var oT="MenubarRadioItem",Iu=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(lf,{...r,...s,ref:t})});Iu.displayName=oT;var lT="MenubarItemIndicator",ju=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(sf,{...r,...s,ref:t})});ju.displayName=lT;var cT="MenubarSeparator",Su=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(Zh,{...r,...s,ref:t})});Su.displayName=cT;var dT="MenubarArrow",uT=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(cf,{...r,...s,ref:t})});uT.displayName=dT;var ku="MenubarSub",Lu=e=>{const{__scopeMenubar:t,children:n,open:s,onOpenChange:r,defaultOpen:i}=e,o=ze(t),[l,c]=fr({prop:s,defaultProp:i??!1,onChange:r,caller:ku});return a.jsx(Xh,{...o,open:l,onOpenChange:c,children:n})};Lu.displayName=ku;var hT="MenubarSubTrigger",Au=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(ef,{"data-radix-menubar-subtrigger":"",...r,...s,ref:t})});Au.displayName=hT;var fT="MenubarSubContent",Du=h.forwardRef((e,t)=>{const{__scopeMenubar:n,...s}=e,r=ze(n);return a.jsx(tf,{...r,"data-radix-menubar-content":"",...s,ref:t,style:{...e.style,"--radix-menubar-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-menubar-content-available-width":"var(--radix-popper-available-width)","--radix-menubar-content-available-height":"var(--radix-popper-available-height)","--radix-menubar-trigger-width":"var(--radix-popper-anchor-width)","--radix-menubar-trigger-height":"var(--radix-popper-anchor-height)"}})});Du.displayName=fT;function pT(e,t){return e.map((n,s)=>e[(t+s)%e.length])}var Ru=gu,mT=Nu,Mu=yu,bT=Eu,Ou=_u,Pu=Tu,Fu=wu,Uu=Cu,Bu=Iu,$u=ju,Vu=Su,xT=Lu,Gu=Au,zu=Du;const Is=mT,Kn=xT,Ku=D.forwardRef(({className:e,...t},n)=>a.jsx(Ru,{ref:n,className:M("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",e),...t}));Ku.displayName=Ru.displayName;const Xn=D.forwardRef(({className:e,...t},n)=>a.jsx(Mu,{ref:n,className:M("flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...t}));Xn.displayName=Mu.displayName;const yn=D.forwardRef(({className:e,inset:t,children:n,...s},r)=>a.jsxs(Gu,{ref:r,className:M("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",t&&"pl-8",e),...s,children:[n,a.jsx(df,{className:"ml-auto size-4"})]}));yn.displayName=Gu.displayName;const En=D.forwardRef(({className:e,...t},n)=>a.jsx(zu,{ref:n,className:M("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));En.displayName=zu.displayName;const Wn=D.forwardRef(({className:e,align:t="start",alignOffset:n=-4,sideOffset:s=8,...r},i)=>a.jsx(bT,{children:a.jsx(Ou,{ref:i,align:t,alignOffset:n,sideOffset:s,className:M("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Wn.displayName=Ou.displayName;const ae=D.forwardRef(({className:e,inset:t,...n},s)=>a.jsx(Fu,{ref:s,className:M("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...n}));ae.displayName=Fu.displayName;const en=D.forwardRef(({className:e,children:t,checked:n,...s},r)=>a.jsxs(Uu,{ref:r,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:n,...s,children:[a.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:a.jsx($u,{children:a.jsx(El,{className:"size-4"})})}),t]}));en.displayName=Uu.displayName;const gT=D.forwardRef(({className:e,children:t,...n},s)=>a.jsxs(Bu,{ref:s,className:M("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...n,children:[a.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:a.jsx($u,{children:a.jsx(uf,{className:"size-4 fill-current"})})}),t]}));gT.displayName=Bu.displayName;const vT=D.forwardRef(({className:e,inset:t,...n},s)=>a.jsx(Pu,{ref:s,className:M("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));vT.displayName=Pu.displayName;const gt=D.forwardRef(({className:e,...t},n)=>a.jsx(Vu,{ref:n,className:M("-mx-1 my-1 h-px bg-muted",e),...t}));gt.displayName=Vu.displayName;const dt=({className:e,...t})=>a.jsx("span",{className:M("ml-auto text-xs tracking-widest text-muted-foreground",e),...t});dt.displayname="MenubarShortcut";const DT=()=>{const{clearDiagramData:e,deleteDiagram:t,updateDiagramUpdatedAt:n,databaseType:s}=se(),{openCreateDiagramDialog:r,openOpenDiagramDialog:i,openExportSQLDialog:o,openImportDatabaseDialog:l,openExportImageDialog:c,openExportDiagramDialog:d,openImportDiagramDialog:u}=Jn(),{showAlert:f}=hf(),{setTheme:p,theme:x}=Or(),{hideSidePanel:b,isSidePanelShowed:m,showSidePanel:g}=et(),{scrollAction:T,setScrollAction:y,setShowCardinality:v,showCardinality:S,setShowFieldAttributes:I,showFieldAttributes:k,setShowMiniMapOnCanvas:C,showMiniMapOnCanvas:_,showDBViews:j,setShowDBViews:R}=di(),{t:L}=ie(),{redo:X,undo:P,hasRedo:F,hasUndo:Q}=ff(),{exportImage:J}=jf(),te=Nh(),je=h.useCallback(()=>{t(),te("/")},[t,te]),me=()=>{r()},qe=()=>{i()},Ye=h.useCallback(()=>{J("svg",{scale:1,transparent:!0,includePatternBG:!1})},[J]),he=h.useCallback(()=>{c({format:"png"})},[c]),De=h.useCallback(()=>{c({format:"jpeg"})},[c]),Se=h.useCallback(()=>{window.open("https://docs.chartdb.io","_blank")},[]),Re=h.useCallback(()=>{window.open("https://discord.gg/QeFwyWSKwC","_blank")},[]),ee=h.useCallback(H=>{if(H===Ne.GENERIC){o({targetDatabaseType:Ne.GENERIC});return}o({targetDatabaseType:H})},[o]),V=h.useCallback(()=>{m?b():g()},[m,g,b]),Y=h.useCallback(()=>{v(!S)},[S,v]),oe=h.useCallback(()=>{I(!k)},[k,I]),B=h.useCallback(()=>{C(!_)},[_,C]),W="âœ¨";return a.jsxs(Ku,{className:"h-8 border-none py-2 shadow-none md:h-10 md:py-0",children:[a.jsxs(Is,{children:[a.jsx(Xn,{children:L("menu.actions.actions")}),a.jsxs(Wn,{children:[a.jsx(ae,{onClick:me,children:L("menu.actions.new")}),a.jsxs(ae,{onClick:qe,children:[L("menu.actions.browse"),a.jsx(dt,{children:Vn[Gn.OPEN_DIAGRAM].keyCombinationLabel})]}),a.jsxs(ae,{onClick:n,children:[L("menu.actions.save"),a.jsx(dt,{children:Vn[Gn.SAVE_DIAGRAM].keyCombinationLabel})]}),a.jsx(gt,{}),a.jsxs(Kn,{children:[a.jsx(yn,{children:L("menu.actions.import")}),a.jsxs(En,{children:[a.jsx(ae,{onClick:u,children:".json"}),a.jsx(gt,{}),a.jsx(ae,{onClick:()=>l({databaseType:s,importMethods:["ddl","dbml"],initialImportMethod:"ddl"}),children:"SQL"}),a.jsx(ae,{onClick:()=>l({databaseType:s,importMethods:["ddl","dbml"],initialImportMethod:"dbml"}),children:"DBML"})]})]}),a.jsx(gt,{}),a.jsxs(Kn,{children:[a.jsx(yn,{children:L("menu.actions.export_sql")}),a.jsxs(En,{children:[s===Ne.GENERIC?a.jsx(ae,{onClick:()=>ee(Ne.GENERIC),children:Nn.generic}):null,s!==Ne.GENERIC?a.jsx(ae,{onClick:()=>ee(s),children:Nn[s]}):null,s!==Ne.POSTGRESQL?a.jsxs(ae,{onClick:()=>ee(Ne.POSTGRESQL),children:[Nn.postgresql,a.jsx(dt,{className:"text-base",children:W})]}):null,s!==Ne.MYSQL?a.jsxs(ae,{onClick:()=>ee(Ne.MYSQL),children:[Nn.mysql,a.jsx(dt,{className:"text-base",children:W})]}):null,s!==Ne.SQL_SERVER?a.jsxs(ae,{onClick:()=>ee(Ne.SQL_SERVER),children:[Nn.sql_server,a.jsx(dt,{className:"text-base",children:W})]}):null,s!==Ne.MARIADB?a.jsxs(ae,{onClick:()=>ee(Ne.MARIADB),children:[Nn.mariadb,a.jsx(dt,{className:"text-base",children:W})]}):null,s!==Ne.SQLITE?a.jsxs(ae,{onClick:()=>ee(Ne.SQLITE),children:[Nn.sqlite,a.jsx(dt,{className:"text-base",children:W})]}):null]})]}),a.jsxs(Kn,{children:[a.jsx(yn,{children:L("menu.actions.export_as")}),a.jsxs(En,{children:[a.jsx(ae,{onClick:he,children:"PNG"}),a.jsx(ae,{onClick:De,children:"JPG"}),a.jsx(ae,{onClick:Ye,children:"SVG"}),a.jsx(gt,{}),a.jsx(ae,{onClick:d,children:"JSON"})]})]}),a.jsx(gt,{}),a.jsx(ae,{onClick:()=>f({title:L("delete_diagram_alert.title"),description:L("delete_diagram_alert.description"),actionLabel:L("delete_diagram_alert.delete"),closeLabel:L("delete_diagram_alert.cancel"),onAction:je}),children:L("menu.actions.delete_diagram")})]})]}),a.jsxs(Is,{children:[a.jsx(Xn,{children:L("menu.edit.edit")}),a.jsxs(Wn,{children:[a.jsxs(ae,{onClick:P,disabled:!Q,children:[L("menu.edit.undo"),a.jsx(dt,{children:Vn[Gn.UNDO].keyCombinationLabel})]}),a.jsxs(ae,{onClick:X,disabled:!F,children:[L("menu.edit.redo"),a.jsx(dt,{children:Vn[Gn.REDO].keyCombinationLabel})]}),a.jsx(gt,{}),a.jsx(ae,{onClick:()=>f({title:L("clear_diagram_alert.title"),description:L("clear_diagram_alert.description"),actionLabel:L("clear_diagram_alert.clear"),closeLabel:L("clear_diagram_alert.cancel"),onAction:e}),children:L("menu.edit.clear")})]})]}),a.jsxs(Is,{children:[a.jsx(Xn,{children:L("menu.view.view")}),a.jsxs(Wn,{children:[a.jsxs(ae,{onClick:V,children:[L(m?"menu.view.hide_sidebar":"menu.view.show_sidebar"),a.jsx(dt,{children:Vn[Gn.TOGGLE_SIDE_PANEL].keyCombinationLabel})]}),a.jsx(gt,{}),a.jsx(ae,{onClick:Y,children:L(S?"menu.view.hide_cardinality":"menu.view.show_cardinality")}),a.jsx(ae,{onClick:oe,children:L(k?"menu.view.hide_field_attributes":"menu.view.show_field_attributes")}),a.jsx(ae,{onClick:B,children:L(_?"menu.view.hide_minimap":"menu.view.show_minimap")}),a.jsx(gt,{}),a.jsxs(Kn,{children:[a.jsx(yn,{children:L("menu.view.zoom_on_scroll")}),a.jsxs(En,{children:[a.jsx(en,{checked:T==="zoom",onClick:()=>y("zoom"),children:L("zoom.on")}),a.jsx(en,{checked:T==="pan",onClick:()=>y("pan"),children:L("zoom.off")})]})]}),a.jsx(gt,{}),a.jsxs(Kn,{children:[a.jsx(yn,{children:L("menu.view.show_views")}),a.jsxs(En,{children:[a.jsx(en,{checked:j,onClick:()=>R(!0),children:L("on")}),a.jsx(en,{checked:!j,onClick:()=>R(!1),children:L("off")})]})]}),a.jsx(gt,{}),a.jsxs(Kn,{children:[a.jsxs(yn,{className:"flex items-center gap-1",children:[a.jsx("span",{children:L("menu.view.theme")}),a.jsx("div",{className:"flex-1"}),a.jsx(dt,{children:Vn[Gn.TOGGLE_THEME].keyCombinationLabel})]}),a.jsxs(En,{children:[a.jsx(en,{checked:x==="system",onClick:()=>p("system"),children:L("theme.system")}),a.jsx(en,{checked:x==="light",onClick:()=>p("light"),children:L("theme.light")}),a.jsx(en,{checked:x==="dark",onClick:()=>p("dark"),children:L("theme.dark")})]})]})]})]}),a.jsxs(Is,{children:[a.jsx(Xn,{children:L("menu.backup.backup")}),a.jsxs(Wn,{children:[a.jsx(ae,{onClick:d,children:L("menu.backup.export_diagram")}),a.jsx(ae,{onClick:u,children:L("menu.backup.restore_diagram")})]})]}),a.jsxs(Is,{children:[a.jsx(Xn,{children:L("menu.help.help")}),a.jsxs(Wn,{children:[a.jsx(ae,{onClick:Se,children:L("menu.help.docs_website")}),a.jsx(ae,{onClick:Re,children:L("menu.help.join_discord")})]})]})]})};export{LT as D,kT as E,AT as L,DT as M,R_ as S,ST as a,sa as u};
